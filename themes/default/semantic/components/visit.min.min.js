/*!
 * # Semantic UI 2.0.0 - Visit
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Copyright 2015 Contributors
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;(function(h,e,f,g){h.visit=h.fn.visit=function(a){var c=h.isFunction(this)?h(e):h(this),o=c.selector||"",q=new Date().getTime(),d=[],n=arguments[0],r=(typeof n=="string"),b=[].slice.call(arguments,1),p;c.each(function(){var l=(h.isPlainObject(a))?h.extend(true,{},h.fn.visit.settings,a):h.extend({},h.fn.visit.settings),B=l.error,k=l.namespace,x="."+k,i=k+"-module",A=h(this),y=h(),j=this,z=A.data(i),m;m={initialize:function(){if(l.count){m.store(l.key.count,l.count)}else{if(l.id){m.add.id(l.id)}else{if(l.increment&&r!=="increment"){m.increment()}}}m.add.display(A);m.instantiate()},instantiate:function(){m.verbose("Storing instance of visit module",m);z=m;A.data(i,m)},destroy:function(){m.verbose("Destroying instance");A.removeData(i)},increment:function(t){var s=m.get.count(),u=+(s)+1;if(t){m.add.id(t)}else{if(u>l.limit&&!l.surpass){u=l.limit}m.debug("Incrementing visits",u);m.store(l.key.count,u)}},decrement:function(t){var s=m.get.count(),u=+(s)-1;if(t){m.remove.id(t)}else{m.debug("Removing visit");m.store(l.key.count,u)}},get:{count:function(){return +(m.retrieve(l.key.count))||0},idCount:function(s){s=s||m.get.ids();return s.length},ids:function(t){var s=[];t=t||m.retrieve(l.key.ids);if(typeof t==="string"){s=t.split(l.delimiter)}m.verbose("Found visited ID list",s);return s},storageOptions:function(t){var s={};if(l.expires){s.expires=l.expires}if(l.domain){s.domain=l.domain}if(l.path){s.path=l.path}return s}},has:{visited:function(t,u){var s=false;u=u||m.get.ids();if(t!==g&&u){h.each(u,function(v,w){if(w==t){s=true}})}return s}},set:{count:function(s){m.store(l.key.count,s)},ids:function(s){m.store(l.key.ids,s)}},reset:function(){m.store(l.key.count,0);m.store(l.key.ids,null)},add:{id:function(t){var u=m.retrieve(l.key.ids),s=(u===g||u==="")?t:u+l.delimiter+t;if(m.has.visited(t)){m.debug("Unique content already visited, not adding visit",t,u)}else{if(t===g){m.debug("ID is not defined")}else{m.debug("Adding visit to unique content",t);m.store(l.key.ids,s)}}m.set.count(m.get.idCount())},display:function(s){var t=h(s);if(t.length>0&&!h.isWindow(t[0])){m.debug("Updating visit count for element",t);y=(y.length>0)?y.add(t):t}}},remove:{id:function(t){var u=m.get.ids(),s=[];if(t!==g&&u!==g){m.debug("Removing visit to unique content",t,u);h.each(u,function(v,w){if(w!==t){s.push(w)}});s=s.join(l.delimiter);m.store(l.key.ids,s)}m.set.count(m.get.idCount())}},check:{limit:function(s){s=s||m.get.count();if(l.limit){if(s>=l.limit){m.debug("Pages viewed exceeded limit, firing callback",s,l.limit);l.onLimit.call(j,s)}m.debug("Limit not reached",s,l.limit);l.onChange.call(j,s)}m.update.display(s)}},update:{display:function(s){s=s||m.get.count();if(y.length>0){m.debug("Updating displayed view count",y);y.html(s)}}},store:function(u,t){var s=m.get.storageOptions(t);if(l.storageMethod=="localstorage"&&e.localStorage!==g){e.localStorage.setItem(u,t);m.debug("Value stored using local storage",u,t)}else{if(h.cookie!==g){h.cookie(u,t,s);m.debug("Value stored using cookie",u,t,s)}else{m.error(B.noCookieStorage);return}}if(u==l.key.count){m.check.limit(t)}},retrieve:function(s,u){var t;if(l.storageMethod=="localstorage"&&e.localStorage!==g){t=e.localStorage.getItem(s)}else{if(h.cookie!==g){t=h.cookie(s)}else{m.error(B.noCookieStorage)}}if(t=="undefined"||t=="null"||t===g||t===null){t=g}return t},setting:function(s,t){if(h.isPlainObject(s)){h.extend(true,l,s)}else{if(t!==g){l[s]=t}else{return l[s]}}},internal:function(s,t){m.debug("Changing internal",s,t);if(t!==g){if(h.isPlainObject(s)){h.extend(true,m,s)}else{m[s]=t}}else{return m[s]}},debug:function(){if(l.debug){if(l.performance){m.performance.log(arguments)}else{m.debug=Function.prototype.bind.call(console.info,console,l.name+":");m.debug.apply(console,arguments)}}},verbose:function(){if(l.verbose&&l.debug){if(l.performance){m.performance.log(arguments)}else{m.verbose=Function.prototype.bind.call(console.info,console,l.name+":");m.verbose.apply(console,arguments)}}},error:function(){m.error=Function.prototype.bind.call(console.error,console,l.name+":");m.error.apply(console,arguments)},performance:{log:function(u){var v,t,s;if(l.performance){v=new Date().getTime();s=q||v;t=v-s;q=v;d.push({Name:u[0],Arguments:[].slice.call(u,1)||"",Element:j,"Execution Time":t})}clearTimeout(m.performance.timer);m.performance.timer=setTimeout(m.performance.display,500)},display:function(){var t=l.name+":",s=0;q=false;clearTimeout(m.performance.timer);h.each(d,function(v,u){s+=u["Execution Time"]});t+=" "+s+"ms";if(o){t+=" '"+o+"'"}if(c.length>1){t+=" ("+c.length+")"}if((console.group!==g||console.table!==g)&&d.length>0){console.groupCollapsed(t);if(console.table){console.table(d)}else{h.each(d,function(v,u){console.log(u.Name+": "+u["Execution Time"]+"ms")})}console.groupEnd()}d=[]}},invoke:function(w,F,t){var v=z,u,E,s;F=F||b;t=j||t;if(typeof w=="string"&&v!==g){w=w.split(/[\. ]/);u=w.length-1;h.each(w,function(C,D){var H=(C!=u)?D+w[C+1].charAt(0).toUpperCase()+w[C+1].slice(1):w;if(h.isPlainObject(v[H])&&(C!=u)){v=v[H]}else{if(v[H]!==g){E=v[H];return false}else{if(h.isPlainObject(v[D])&&(C!=u)){v=v[D]}else{if(v[D]!==g){E=v[D];return false}else{return false}}}}})}if(h.isFunction(E)){s=E.apply(t,F)}else{if(E!==g){s=E}}if(h.isArray(p)){p.push(s)}else{if(p!==g){p=[p,s]}else{if(s!==g){p=s}}}return E}};if(r){if(z===g){m.initialize()}m.invoke(n)}else{if(z!==g){z.invoke("destroy")}m.initialize()}});return(p!==g)?p:this};h.fn.visit.settings={name:"Visit",debug:false,verbose:false,performance:true,namespace:"visit",increment:false,surpass:false,count:false,limit:false,delimiter:"&",storageMethod:"localstorage",key:{count:"visit-count",ids:"visit-ids"},expires:30,domain:false,path:"/",onLimit:function(){},onChange:function(){},error:{method:"The method you called is not defined",missingPersist:"Using the persist setting requires the inclusion of PersistJS",noCookieStorage:"The default storage cookie requires $.cookie to be included."}}})(jQuery,window,document);