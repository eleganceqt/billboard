/*!
 * # Semantic UI 2.4.1 - Search
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;(function(h,e,f,g){e=(typeof e!="undefined"&&e.Math==Math)?e:(typeof self!="undefined"&&self.Math==Math)?self:Function("return this")();h.fn.search=function(a){var c=h(this),o=c.selector||"",q=new Date().getTime(),d=[],n=arguments[0],r=(typeof n=="string"),b=[].slice.call(arguments,1),p;h(this).each(function(){var K=(h.isPlainObject(a))?h.extend(true,{},h.fn.search.settings,a):h.extend({},h.fn.search.settings),V=K.className,L=K.metadata,O=K.regExp,i=K.fields,P=K.selector,S=K.error,J=K.namespace,U="."+J,k=J+"-module",R=h(this),Q=R.find(P.prompt),N=R.find(P.searchButton),T=R.find(P.results),j=R.find(P.result),m=R.find(P.category),W=this,I=R.data(k),l=false,M=false,X;X={initialize:function(){X.verbose("Initializing module");X.get.settings();X.determine.searchFields();X.bind.events();X.set.type();X.create.results();X.instantiate()},instantiate:function(){X.verbose("Storing instance of module",X);I=X;R.data(k,X)},destroy:function(){X.verbose("Destroying instance");R.off(U).removeData(k)},refresh:function(){X.debug("Refreshing selector cache");Q=R.find(P.prompt);N=R.find(P.searchButton);m=R.find(P.category);T=R.find(P.results);j=R.find(P.result)},refreshResults:function(){T=R.find(P.results);j=R.find(P.result)},bind:{events:function(){X.verbose("Binding events to search");if(K.automatic){R.on(X.get.inputEvent()+U,P.prompt,X.event.input);Q.attr("autocomplete","off")}R.on("focus"+U,P.prompt,X.event.focus).on("blur"+U,P.prompt,X.event.blur).on("keydown"+U,P.prompt,X.handleKeyboard).on("click"+U,P.searchButton,X.query).on("mousedown"+U,P.results,X.event.result.mousedown).on("mouseup"+U,P.results,X.event.result.mouseup).on("click"+U,P.result,X.event.result.click)}},determine:{searchFields:function(){if(a&&a.searchFields!==g){K.searchFields=a.searchFields}}},event:{input:function(){if(K.searchDelay){clearTimeout(X.timer);X.timer=setTimeout(function(){if(X.is.focused()){X.query()}},K.searchDelay)}else{X.query()}},focus:function(){X.set.focus();if(K.searchOnFocus&&X.has.minimumCharacters()){X.query(function(){if(X.can.show()){X.showResults()}})}},blur:function(u){var t=(f.activeElement===this),s=function(){X.cancel.query();X.remove.focus();X.timer=setTimeout(X.hideResults,K.hideDelay)};if(t){return}M=false;if(X.resultsClicked){X.debug("Determining if user action caused search to close");R.one("click.close"+U,P.results,function(v){if(X.is.inMessage(v)||l){Q.focus();return}l=false;if(!X.is.animating()&&!X.is.hidden()){s()}})}else{X.debug("Input blurred without user action, closing results");s()}},result:{mousedown:function(){X.resultsClicked=true},mouseup:function(){X.resultsClicked=false},click:function(C){X.debug("Search result selected");var y=h(this),v=y.find(P.title).eq(0),w=y.is("a[href]")?y:y.find("a[href]").eq(0),B=w.attr("href")||false,x=w.attr("target")||false,u=v.html(),t=(v.length>0)?v.text():false,z=X.get.results(),s=y.data(L.result)||X.get.result(t,z),A;if(h.isFunction(K.onSelect)){if(K.onSelect.call(W,s,z)===false){X.debug("Custom onSelect callback cancelled default select action");l=true;return}}X.hideResults();if(t){X.set.value(t)}if(B){X.verbose("Opening search link found in result",w);if(x=="_blank"||C.ctrlKey){e.open(B)}else{e.location.href=(B)}}}}},handleKeyboard:function(B){var y=R.find(P.result),A=R.find(P.category),w=y.filter("."+V.active),x=y.index(w),v=y.length,z=w.length>0,s=B.which,t={backspace:8,enter:13,escape:27,upArrow:38,downArrow:40},u;if(s==t.escape){X.verbose("Escape key pressed, blurring search field");X.hideResults();M=true}if(X.is.visible()){if(s==t.enter){X.verbose("Enter key pressed, selecting active result");if(y.filter("."+V.active).length>0){X.event.result.click.call(y.filter("."+V.active),B);B.preventDefault();return false}}else{if(s==t.upArrow&&z){X.verbose("Up key pressed, changing active result");u=(x-1<0)?x:x-1;A.removeClass(V.active);y.removeClass(V.active).eq(u).addClass(V.active).closest(A).addClass(V.active);B.preventDefault()}else{if(s==t.downArrow){X.verbose("Down key pressed, changing active result");u=(x+1>=v)?x:x+1;A.removeClass(V.active);y.removeClass(V.active).eq(u).addClass(V.active).closest(A).addClass(V.active);B.preventDefault()}}}}else{if(s==t.enter){X.verbose("Enter key pressed, executing query");X.query();X.set.buttonPressed();Q.one("keyup",X.remove.buttonFocus)}}},setup:{api:function(v,s){var u={debug:K.debug,on:false,cache:K.cache,action:"search",urlData:{query:v},onSuccess:function(w){X.parse.response.call(W,w,v);s()},onFailure:function(){X.displayMessage(S.serverError);s()},onAbort:function(w){},onError:X.error},t;h.extend(true,u,K.apiSettings);X.verbose("Setting up API request",u);R.api(u)}},can:{useAPI:function(){return h.fn.api!==g},show:function(){return X.is.focused()&&!X.is.visible()&&!X.is.empty()},transition:function(){return K.transition&&h.fn.transition!==g&&R.transition("is supported")}},is:{animating:function(){return T.hasClass(V.animating)},hidden:function(){return T.hasClass(V.hidden)},inMessage:function(s){if(!s.target){return}var t=h(s.target),u=h.contains(f.documentElement,s.target);return(u&&t.closest(P.message).length>0)},empty:function(){return(T.html()==="")},visible:function(){return(T.filter(":visible").length>0)},focused:function(){return(Q.filter(":focus").length>0)}},get:{settings:function(){if(h.isPlainObject(a)&&a.searchFullText){K.fullTextSearch=a.searchFullText;X.error(K.error.oldSearchSyntax,W)}},inputEvent:function(){var t=Q[0],s=(t!==g&&t.oninput!==g)?"input":(t!==g&&t.onpropertychange!==g)?"propertychange":"keyup";return s},value:function(){return Q.val()},results:function(){var s=R.data(L.results);return s},result:function(s,t){var u=["title","id"],v=false;s=(s!==g)?s:X.get.value();t=(t!==g)?t:X.get.results();if(K.type==="category"){X.debug("Finding result that matches",s);h.each(t,function(x,w){if(h.isArray(w.results)){v=X.search.object(s,w.results,u)[0];if(v){return false}}})}else{X.debug("Finding result in results object",s);v=X.search.object(s,t,u)[0]}return v||false}},select:{firstResult:function(){X.verbose("Selecting first result");j.first().addClass(V.active)}},set:{focus:function(){R.addClass(V.focus)},loading:function(){R.addClass(V.loading)},value:function(s){X.verbose("Setting search input value",s);Q.val(s)},type:function(s){s=s||K.type;if(K.type=="category"){R.addClass(K.type)}},buttonPressed:function(){N.addClass(V.pressed)}},remove:{loading:function(){R.removeClass(V.loading)},focus:function(){R.removeClass(V.focus)},buttonPressed:function(){N.removeClass(V.pressed)}},query:function(s){s=h.isFunction(s)?s:function(){};var t=X.get.value(),u=X.read.cache(t);s=s||function(){};if(X.has.minimumCharacters()){if(u){X.debug("Reading result from cache",t);X.save.results(u.results);X.addResults(u.html);X.inject.id(u.results);s()}else{X.debug("Querying for",t);if(h.isPlainObject(K.source)||h.isArray(K.source)){X.search.local(t);s()}else{if(X.can.useAPI()){X.search.remote(t,s)}else{X.error(S.source);s()}}}K.onSearchQuery.call(W,t)}else{X.hideResults()}},search:{local:function(u){var t=X.search.object(u,K.content),s;X.set.loading();X.save.results(t);X.debug("Returned full local search results",t);if(K.maxResults>0){X.debug("Using specified max results",t);t=t.slice(0,K.maxResults)}if(K.type=="category"){t=X.create.categoryResults(t)}s=X.generateResults({results:t});X.remove.loading();X.addResults(s);X.inject.id(t);X.write.cache(u,{html:s,results:t})},remote:function(t,s){s=h.isFunction(s)?s:function(){};if(R.api("is loading")){R.api("abort")}X.setup.api(t,s);R.api("query")},object:function(y,A,w){var x=[],u=[],t=[],v=y.toString().replace(O.escape,"\\$&"),s=new RegExp(O.beginsWith+v,"i"),z=function(B,E){var F=(h.inArray(E,x)==-1),C=(h.inArray(E,t)==-1),D=(h.inArray(E,u)==-1);if(F&&C&&D){B.push(E)}};A=A||K.source;w=(w!==g)?w:K.searchFields;if(!h.isArray(w)){w=[w]}if(A===g||A===false){X.error(S.source);return[]}h.each(w,function(C,B){h.each(A,function(F,E){var D=(typeof E[B]=="string");if(D){if(E[B].search(s)!==-1){z(x,E)}else{if(K.fullTextSearch==="exact"&&X.exactSearch(y,E[B])){z(u,E)}else{if(K.fullTextSearch==true&&X.fuzzySearch(y,E[B])){z(t,E)}}}}})});h.merge(u,t);h.merge(x,u);return x}},exactSearch:function(s,t){s=s.toLowerCase();t=t.toLowerCase();if(t.indexOf(s)>-1){return true}return false},fuzzySearch:function(y,t){var w=t.length,u=y.length;if(typeof y!=="string"){return false}y=y.toLowerCase();t=t.toLowerCase();if(u>w){return false}if(u===w){return(y===t)}search:for(var x=0,v=0;x<u;x++){var s=y.charCodeAt(x);while(v<w){if(t.charCodeAt(v++)===s){continue search}}return false}return true},parse:{response:function(t,u){var s=X.generateResults(t);X.verbose("Parsing server response",t);if(t!==g){if(u!==g&&t[i.results]!==g){X.addResults(s);X.inject.id(t[i.results]);X.write.cache(u,{html:s,results:t[i.results]});X.save.results(t[i.results])}}}},cancel:{query:function(){if(X.can.useAPI()){R.api("abort")}}},has:{minimumCharacters:function(){var t=X.get.value(),s=t.length;return(s>=K.minCharacters)},results:function(){if(T.length===0){return false}var s=T.html();return s!=""}},clear:{cache:function(s){var t=R.data(L.cache);if(!s){X.debug("Clearing cache",s);R.removeData(L.cache)}else{if(s&&t&&t[s]){X.debug("Removing value from cache",s);delete t[s];R.data(L.cache,t)}}}},read:{cache:function(s){var t=R.data(L.cache);if(K.cache){X.verbose("Checking cache for generated html for query",s);return(typeof t=="object")&&(t[s]!==g)?t[s]:false}return false}},create:{categoryResults:function(t){var s={};h.each(t,function(u,v){if(!v.category){return}if(s[v.category]===g){X.verbose("Creating new category of results",v.category);s[v.category]={name:v.category,results:[v]}}else{s[v.category].results.push(v)}});return s},id:function(v,s){var w=(v+1),t=(s+1),y,u,x;if(s!==g){u=String.fromCharCode(97+s);x=u+w;X.verbose("Creating category result id",x)}else{x=w;X.verbose("Creating result id",x)}return x},results:function(){if(T.length===0){T=h("<div />").addClass(V.results).appendTo(R)}}},inject:{result:function(u,v,s){X.verbose("Injecting result into results");var t=(s!==g)?T.children().eq(s).children(P.results).first().children(P.result).eq(v):T.children(P.result).eq(v);X.verbose("Injecting results metadata",t);t.data(L.result,u)},id:function(t){X.debug("Injecting unique ids into results");var s=0,u=0;if(K.type==="category"){h.each(t,function(v,w){u=0;h.each(w.results,function(y,x){var z=w.results[y];if(z.id===g){z.id=X.create.id(u,s)}X.inject.result(z,u,s);u++});s++})}else{h.each(t,function(x,w){var v=t[x];if(v.id===g){v.id=X.create.id(u)}X.inject.result(v,u);u++})}return t}},save:{results:function(s){X.verbose("Saving current search results to metadata",s);R.data(L.results,s)}},write:{cache:function(t,s){var u=(R.data(L.cache)!==g)?R.data(L.cache):{};if(K.cache){X.verbose("Writing generated html to cache",t,s);u[t]=s;R.data(L.cache,u)}}},addResults:function(s){if(h.isFunction(K.onResultsAdd)){if(K.onResultsAdd.call(T,s)===false){X.debug("onResultsAdd callback cancelled default action");return false}}if(s){T.html(s);X.refreshResults();if(K.selectFirstResult){X.select.firstResult()}X.showResults()}else{X.hideResults(function(){T.empty()})}},showResults:function(s){s=h.isFunction(s)?s:function(){};if(M){return}if(!X.is.visible()&&X.has.results()){if(X.can.transition()){X.debug("Showing results with css animations");T.transition({animation:K.transition+" in",debug:K.debug,verbose:K.verbose,duration:K.duration,onComplete:function(){s()},queue:true})}else{X.debug("Showing results with javascript");T.stop().fadeIn(K.duration,K.easing)}K.onResultsOpen.call(T)}},hideResults:function(s){s=h.isFunction(s)?s:function(){};if(X.is.visible()){if(X.can.transition()){X.debug("Hiding results with css animations");T.transition({animation:K.transition+" out",debug:K.debug,verbose:K.verbose,duration:K.duration,onComplete:function(){s()},queue:true})}else{X.debug("Hiding results with javascript");T.stop().fadeOut(K.duration,K.easing)}K.onResultsClose.call(T)}},generateResults:function(v){X.debug("Generating html from response",v);var w=K.templates[K.type],s=(h.isPlainObject(v[i.results])&&!h.isEmptyObject(v[i.results])),t=(h.isArray(v[i.results])&&v[i.results].length>0),u="";if(s||t){if(K.maxResults>0){if(s){if(K.type=="standard"){X.error(S.maxResults)}}else{v[i.results]=v[i.results].slice(0,K.maxResults)}}if(h.isFunction(w)){u=w(v,i)}else{X.error(S.noTemplate,false)}}else{if(K.showNoResults){u=X.displayMessage(S.noResults,"empty")}}K.onResults.call(W,v);return u},displayMessage:function(s,t){t=t||"standard";X.debug("Displaying message",s,t);X.addResults(K.templates.message(s,t));return K.templates.message(s,t)},setting:function(t,s){if(h.isPlainObject(t)){h.extend(true,K,t)}else{if(s!==g){K[t]=s}else{return K[t]}}},internal:function(t,s){if(h.isPlainObject(t)){h.extend(true,X,t)}else{if(s!==g){X[t]=s}else{return X[t]}}},debug:function(){if(!K.silent&&K.debug){if(K.performance){X.performance.log(arguments)}else{X.debug=Function.prototype.bind.call(console.info,console,K.name+":");X.debug.apply(console,arguments)}}},verbose:function(){if(!K.silent&&K.verbose&&K.debug){if(K.performance){X.performance.log(arguments)}else{X.verbose=Function.prototype.bind.call(console.info,console,K.name+":");X.verbose.apply(console,arguments)}}},error:function(){if(!K.silent){X.error=Function.prototype.bind.call(console.error,console,K.name+":");X.error.apply(console,arguments)}},performance:{log:function(t){var u,s,v;if(K.performance){u=new Date().getTime();v=q||u;s=u-v;q=u;d.push({Name:t[0],Arguments:[].slice.call(t,1)||"",Element:W,"Execution Time":s})}clearTimeout(X.performance.timer);X.performance.timer=setTimeout(X.performance.display,500)},display:function(){var s=K.name+":",t=0;q=false;clearTimeout(X.performance.timer);h.each(d,function(v,u){t+=u["Execution Time"]});s+=" "+t+"ms";if(o){s+=" '"+o+"'"}if(c.length>1){s+=" ("+c.length+")"}if((console.group!==g||console.table!==g)&&d.length>0){console.groupCollapsed(s);if(console.table){console.table(d)}else{h.each(d,function(v,u){console.log(u.Name+": "+u["Execution Time"]+"ms")})}console.groupEnd()}d=[]}},invoke:function(x,u,s){var t=I,w,y,v;u=u||b;s=W||s;if(typeof x=="string"&&t!==g){x=x.split(/[\. ]/);w=x.length-1;h.each(x,function(z,A){var B=(z!=w)?A+x[z+1].charAt(0).toUpperCase()+x[z+1].slice(1):x;if(h.isPlainObject(t[B])&&(z!=w)){t=t[B]}else{if(t[B]!==g){y=t[B];return false}else{if(h.isPlainObject(t[A])&&(z!=w)){t=t[A]}else{if(t[A]!==g){y=t[A];return false}else{return false}}}}})}if(h.isFunction(y)){v=y.apply(s,u)}else{if(y!==g){v=y}}if(h.isArray(p)){p.push(v)}else{if(p!==g){p=[p,v]}else{if(v!==g){p=v}}}return y}};if(r){if(I===g){X.initialize()}X.invoke(n)}else{if(I!==g){I.invoke("destroy")}X.initialize()}});return(p!==g)?p:this};h.fn.search.settings={name:"Search",namespace:"search",silent:false,debug:false,verbose:false,performance:true,type:"standard",minCharacters:1,selectFirstResult:false,apiSettings:false,source:false,searchOnFocus:true,searchFields:["title","description"],displayField:"",fullTextSearch:"exact",automatic:true,hideDelay:0,searchDelay:200,maxResults:7,cache:true,showNoResults:true,transition:"scale",duration:200,easing:"easeOutExpo",onSelect:false,onResultsAdd:false,onSearchQuery:function(a){},onResults:function(a){},onResultsOpen:function(){},onResultsClose:function(){},className:{animating:"animating",active:"active",empty:"empty",focus:"focus",hidden:"hidden",loading:"loading",results:"results",pressed:"down"},error:{source:"Cannot search. No source used, and Semantic API module was not included",noResults:"Your search returned no results",logging:"Error in debug logging, exiting.",noEndpoint:"No search endpoint was specified",noTemplate:"A valid template name was not specified.",oldSearchSyntax:"searchFullText setting has been renamed fullTextSearch for consistency, please adjust your settings.",serverError:"There was an issue querying the server.",maxResults:"Results must be an array to use maxResults setting",method:"The method you called is not defined."},metadata:{cache:"cache",results:"results",result:"result"},regExp:{escape:/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,beginsWith:"(?:s|^)"},fields:{categories:"results",categoryName:"name",categoryResults:"results",description:"description",image:"image",price:"price",results:"results",title:"title",url:"url",action:"action",actionText:"text",actionURL:"url"},selector:{prompt:".prompt",searchButton:".search.button",results:".results",message:".results > .message",category:".category",result:".result",title:".title, .name"},templates:{escape:function(d){var b=/[&<>"'`]/g,a=/[&<>"'`]/,c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},j=function(i){return c[i]};if(a.test(d)){return d.replace(b,j)}return d},message:function(a,b){var c="";if(a!==g&&b!==g){c+='<div class="message '+b+'">';if(b=="empty"){c+='<div class="header">No Results</div class="header"><div class="description">'+a+'</div class="description">'}else{c+=' <div class="description">'+a+"</div>"}c+="</div>"}return c},category:function(c,d){var b="",a=h.fn.search.settings.templates.escape;if(c[d.categoryResults]!==g){h.each(c[d.categoryResults],function(l,k){if(k[d.results]!==g&&k.results.length>0){b+='<div class="category">';if(k[d.categoryName]!==g){b+='<div class="name">'+k[d.categoryName]+"</div>"}b+='<div class="results">';h.each(k.results,function(i,j){if(j[d.url]){b+='<a class="result" href="'+j[d.url]+'">'}else{b+='<a class="result">'}if(j[d.image]!==g){b+='<div class="image"> <img src="'+j[d.image]+'"></div>'}b+='<div class="content">';if(j[d.price]!==g){b+='<div class="price">'+j[d.price]+"</div>"}if(j[d.title]!==g){b+='<div class="title">'+j[d.title]+"</div>"}if(j[d.description]!==g){b+='<div class="description">'+j[d.description]+"</div>"}b+="</div>";b+="</a>"});b+="</div>";b+="</div>"}});if(c[d.action]){b+='<a href="'+c[d.action][d.actionURL]+'" class="action">'+c[d.action][d.actionText]+"</a>"}return b}return false},standard:function(b,c){var a="";if(b[c.results]!==g){h.each(b[c.results],function(d,j){if(j[c.url]){a+='<a class="result" href="'+j[c.url]+'">'}else{a+='<a class="result">'}if(j[c.image]!==g){a+='<div class="image"> <img src="'+j[c.image]+'"></div>'}a+='<div class="content">';if(j[c.price]!==g){a+='<div class="price">'+j[c.price]+"</div>"}if(j[c.title]!==g){a+='<div class="title">'+j[c.title]+"</div>"}if(j[c.description]!==g){a+='<div class="description">'+j[c.description]+"</div>"}a+="</div>";a+="</a>"});if(b[c.action]){a+='<a href="'+b[c.action][c.actionURL]+'" class="action">'+b[c.action][c.actionText]+"</a>"}return a}return false}}}})(jQuery,window,document);