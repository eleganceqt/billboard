/*!
 * # Semantic UI 2.0.0 - Visit
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Copyright 2015 Contributors
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;(function(c,b,a,d){c.visit=c.fn.visit=function(m){var k=c.isFunction(this)?c(b):c(this),h=k.selector||"",f=new Date().getTime(),j=[],i=arguments[0],e=(typeof i=="string"),l=[].slice.call(arguments,1),g;k.each(function(){var o=(c.isPlainObject(m))?c.extend(true,{},c.fn.visit.settings,m):c.extend({},c.fn.visit.settings),s=o.error,p=o.namespace,w="."+p,r=p+"-module",t=c(this),v=c(),q=this,u=t.data(r),n;n={initialize:function(){if(o.count){n.store(o.key.count,o.count)}else{if(o.id){n.add.id(o.id)}else{if(o.increment&&e!=="increment"){n.increment()}}}n.add.display(t);n.instantiate()},instantiate:function(){n.verbose("Storing instance of visit module",n);u=n;t.data(r,n)},destroy:function(){n.verbose("Destroying instance");t.removeData(r)},increment:function(z){var x=n.get.count(),y=+(x)+1;if(z){n.add.id(z)}else{if(y>o.limit&&!o.surpass){y=o.limit}n.debug("Incrementing visits",y);n.store(o.key.count,y)}},decrement:function(z){var x=n.get.count(),y=+(x)-1;if(z){n.remove.id(z)}else{n.debug("Removing visit");n.store(o.key.count,y)}},get:{count:function(){return +(n.retrieve(o.key.count))||0},idCount:function(x){x=x||n.get.ids();return x.length},ids:function(y){var x=[];y=y||n.retrieve(o.key.ids);if(typeof y==="string"){x=y.split(o.delimiter)}n.verbose("Found visited ID list",x);return x},storageOptions:function(y){var x={};if(o.expires){x.expires=o.expires}if(o.domain){x.domain=o.domain}if(o.path){x.path=o.path}return x}},has:{visited:function(z,y){var x=false;y=y||n.get.ids();if(z!==d&&y){c.each(y,function(A,B){if(B==z){x=true}})}return x}},set:{count:function(x){n.store(o.key.count,x)},ids:function(x){n.store(o.key.ids,x)}},reset:function(){n.store(o.key.count,0);n.store(o.key.ids,null)},add:{id:function(z){var y=n.retrieve(o.key.ids),x=(y===d||y==="")?z:y+o.delimiter+z;if(n.has.visited(z)){n.debug("Unique content already visited, not adding visit",z,y)}else{if(z===d){n.debug("ID is not defined")}else{n.debug("Adding visit to unique content",z);n.store(o.key.ids,x)}}n.set.count(n.get.idCount())},display:function(x){var y=c(x);if(y.length>0&&!c.isWindow(y[0])){n.debug("Updating visit count for element",y);v=(v.length>0)?v.add(y):y}}},remove:{id:function(z){var y=n.get.ids(),x=[];if(z!==d&&y!==d){n.debug("Removing visit to unique content",z,y);c.each(y,function(A,B){if(B!==z){x.push(B)}});x=x.join(o.delimiter);n.store(o.key.ids,x)}n.set.count(n.get.idCount())}},check:{limit:function(x){x=x||n.get.count();if(o.limit){if(x>=o.limit){n.debug("Pages viewed exceeded limit, firing callback",x,o.limit);o.onLimit.call(q,x)}n.debug("Limit not reached",x,o.limit);o.onChange.call(q,x)}n.update.display(x)}},update:{display:function(x){x=x||n.get.count();if(v.length>0){n.debug("Updating displayed view count",v);v.html(x)}}},store:function(y,z){var x=n.get.storageOptions(z);if(o.storageMethod=="localstorage"&&b.localStorage!==d){b.localStorage.setItem(y,z);n.debug("Value stored using local storage",y,z)}else{if(c.cookie!==d){c.cookie(y,z,x);n.debug("Value stored using cookie",y,z,x)}else{n.error(s.noCookieStorage);return}}if(y==o.key.count){n.check.limit(z)}},retrieve:function(x,y){var z;if(o.storageMethod=="localstorage"&&b.localStorage!==d){z=b.localStorage.getItem(x)}else{if(c.cookie!==d){z=c.cookie(x)}else{n.error(s.noCookieStorage)}}if(z=="undefined"||z=="null"||z===d||z===null){z=d}return z},setting:function(x,y){if(c.isPlainObject(x)){c.extend(true,o,x)}else{if(y!==d){o[x]=y}else{return o[x]}}},internal:function(x,y){n.debug("Changing internal",x,y);if(y!==d){if(c.isPlainObject(x)){c.extend(true,n,x)}else{n[x]=y}}else{return n[x]}},debug:function(){if(o.debug){if(o.performance){n.performance.log(arguments)}else{n.debug=Function.prototype.bind.call(console.info,console,o.name+":");n.debug.apply(console,arguments)}}},verbose:function(){if(o.verbose&&o.debug){if(o.performance){n.performance.log(arguments)}else{n.verbose=Function.prototype.bind.call(console.info,console,o.name+":");n.verbose.apply(console,arguments)}}},error:function(){n.error=Function.prototype.bind.call(console.error,console,o.name+":");n.error.apply(console,arguments)},performance:{log:function(z){var y,A,x;if(o.performance){y=new Date().getTime();x=f||y;A=y-x;f=y;j.push({Name:z[0],Arguments:[].slice.call(z,1)||"",Element:q,"Execution Time":A})}clearTimeout(n.performance.timer);n.performance.timer=setTimeout(n.performance.display,500)},display:function(){var y=o.name+":",x=0;f=false;clearTimeout(n.performance.timer);c.each(j,function(z,A){x+=A["Execution Time"]});y+=" "+x+"ms";if(h){y+=" '"+h+"'"}if(k.length>1){y+=" ("+k.length+")"}if((console.group!==d||console.table!==d)&&j.length>0){console.groupCollapsed(y);if(console.table){console.table(j)}else{c.each(j,function(z,A){console.log(A.Name+": "+A["Execution Time"]+"ms")})}console.groupEnd()}j=[]}},invoke:function(C,y,A){var z=u,D,B,x;y=y||l;A=q||A;if(typeof C=="string"&&z!==d){C=C.split(/[\. ]/);D=C.length-1;c.each(C,function(G,F){var E=(G!=D)?F+C[G+1].charAt(0).toUpperCase()+C[G+1].slice(1):C;if(c.isPlainObject(z[E])&&(G!=D)){z=z[E]}else{if(z[E]!==d){B=z[E];return false}else{if(c.isPlainObject(z[F])&&(G!=D)){z=z[F]}else{if(z[F]!==d){B=z[F];return false}else{return false}}}}})}if(c.isFunction(B)){x=B.apply(A,y)}else{if(B!==d){x=B}}if(c.isArray(g)){g.push(x)}else{if(g!==d){g=[g,x]}else{if(x!==d){g=x}}}return B}};if(e){if(u===d){n.initialize()}n.invoke(i)}else{if(u!==d){u.invoke("destroy")}n.initialize()}});return(g!==d)?g:this};c.fn.visit.settings={name:"Visit",debug:false,verbose:false,performance:true,namespace:"visit",increment:false,surpass:false,count:false,limit:false,delimiter:"&",storageMethod:"localstorage",key:{count:"visit-count",ids:"visit-ids"},expires:30,domain:false,path:"/",onLimit:function(){},onChange:function(){},error:{method:"The method you called is not defined",missingPersist:"Using the persist setting requires the inclusion of PersistJS",noCookieStorage:"The default storage cookie requires $.cookie to be included."}}})(jQuery,window,document);