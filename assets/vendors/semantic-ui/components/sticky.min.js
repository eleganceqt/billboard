/*!
 * # Fomantic-UI - Sticky
 * http://github.com/fomantic/Fomantic-UI/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;(function(c,b,a,d){c.isFunction=c.isFunction||function(e){return typeof e==="function"&&typeof e.nodeType!=="number"};b=(typeof b!="undefined"&&b.Math==Math)?b:(typeof self!="undefined"&&self.Math==Math)?self:Function("return this")();c.fn.sticky=function(m){var k=c(this),h=k.selector||"",f=new Date().getTime(),j=[],i=arguments[0],e=(typeof i=="string"),l=[].slice.call(arguments,1),g;k.each(function(){var p=(c.isPlainObject(m))?c.extend(true,{},c.fn.sticky.settings,m):c.extend({},c.fn.sticky.settings),y=p.className,q=p.namespace,z=p.error,D="."+q,u="module-"+q,A=c(this),o=c(b),r=c(p.scrollContext),C,v,B=A.data(u),x=b.requestAnimationFrame||b.mozRequestAnimationFrame||b.webkitRequestAnimationFrame||b.msRequestAnimationFrame||function(E){setTimeout(E,0)},t=this,s,w,n;n={initialize:function(){n.determineContainer();n.determineContext();n.verbose("Initializing sticky",p,C);n.save.positions();n.checkErrors();n.bind.events();if(p.observeChanges){n.observeChanges()}n.instantiate()},instantiate:function(){n.verbose("Storing instance of module",n);B=n;A.data(u,n)},destroy:function(){n.verbose("Destroying previous instance");n.reset();if(s){s.disconnect()}if(w){w.disconnect()}o.off("load"+D,n.event.load).off("resize"+D,n.event.resize);r.off("scrollchange"+D,n.event.scrollchange);A.removeData(u)},observeChanges:function(){if("MutationObserver" in b){s=new MutationObserver(n.event.documentChanged);w=new MutationObserver(n.event.changed);s.observe(a,{childList:true,subtree:true});w.observe(t,{childList:true,subtree:true});w.observe(v[0],{childList:true,subtree:true});n.debug("Setting up mutation observer",w)}},determineContainer:function(){if(p.container){C=c(p.container)}else{C=A.offsetParent()}},determineContext:function(){if(p.context){v=c(p.context)}else{v=C}if(v.length===0){n.error(z.invalidContext,p.context,A);return}},checkErrors:function(){if(n.is.hidden()){n.error(z.visible,A)}if(n.cache.element.height>n.cache.context.height){n.reset();n.error(z.elementSize,A);return}},bind:{events:function(){o.on("load"+D,n.event.load).on("resize"+D,n.event.resize);r.off("scroll"+D).on("scroll"+D,n.event.scroll).on("scrollchange"+D,n.event.scrollchange)}},event:{changed:function(E){clearTimeout(n.timer);n.timer=setTimeout(function(){n.verbose("DOM tree modified, updating sticky menu",E);n.refresh()},100)},documentChanged:function(E){[].forEach.call(E,function(F){if(F.removedNodes){[].forEach.call(F.removedNodes,function(G){if(G==t||c(G).find(t).length>0){n.debug("Element removed from DOM, tearing down events");n.destroy()}})}})},load:function(){n.verbose("Page contents finished loading");x(n.refresh)},resize:function(){n.verbose("Window resized");x(n.refresh)},scroll:function(){x(function(){r.triggerHandler("scrollchange"+D,r.scrollTop())})},scrollchange:function(F,E){n.stick(E);p.onScroll.call(t)}},refresh:function(E){n.reset();if(!p.context){n.determineContext()}if(E){n.determineContainer()}n.save.positions();n.stick();p.onReposition.call(t)},supports:{sticky:function(){var E=c("<div/>");E.addClass(y.supported);return(E.css("position").match("sticky"))}},save:{lastScroll:function(E){n.lastScroll=E},elementScroll:function(E){n.elementScroll=E},positions:function(){var G={height:r.height()},F={margin:{top:parseInt(A.css("margin-top"),10),bottom:parseInt(A.css("margin-bottom"),10)},offset:A.offset(),width:A.outerWidth(),height:A.outerHeight()},E={offset:v.offset(),height:v.outerHeight()};if(!n.is.standardScroll()){n.debug("Non-standard scroll. Removing scroll offset from element offset");G.top=r.scrollTop();G.left=r.scrollLeft();F.offset.top+=G.top;E.offset.top+=G.top;F.offset.left+=G.left;E.offset.left+=G.left}n.cache={fits:((F.height+p.offset)<=G.height),sameHeight:(F.height==E.height),scrollContext:{height:G.height},element:{margin:F.margin,top:F.offset.top-F.margin.top,left:F.offset.left,width:F.width,height:F.height,bottom:F.offset.top+F.height},context:{top:E.offset.top,height:E.height,bottom:E.offset.top+E.height}};n.set.containerSize();n.stick();n.debug("Caching element positions",n.cache)}},get:{direction:function(E){var F="down";E=E||r.scrollTop();if(n.lastScroll!==d){if(n.lastScroll<E){F="down"}else{if(n.lastScroll>E){F="up"}}}return F},scrollChange:function(E){E=E||r.scrollTop();return(n.lastScroll)?(E-n.lastScroll):0},currentElementScroll:function(){if(n.elementScroll){return n.elementScroll}return(n.is.top())?Math.abs(parseInt(A.css("top"),10))||0:Math.abs(parseInt(A.css("bottom"),10))||0},elementScroll:function(E){E=E||r.scrollTop();var F=n.cache.element,J=n.cache.scrollContext,K=n.get.scrollChange(E),H=(F.height-J.height+p.offset),G=n.get.currentElementScroll(),I=(G+K);if(n.cache.fits||I<0){G=0}else{if(I>H){G=H}else{G=I}}return G}},remove:{lastScroll:function(){delete n.lastScroll},elementScroll:function(E){delete n.elementScroll},minimumSize:function(){C.css("min-height","")},offset:function(){A.css("margin-top","")}},set:{offset:function(){n.verbose("Setting offset on element",p.offset);A.css("margin-top",p.offset)},containerSize:function(){var E=C.get(0).tagName;if(E==="HTML"||E=="body"){n.determineContainer()}else{if(Math.abs(C.outerHeight()-n.cache.context.height)>p.jitter){n.debug("Context has padding, specifying exact height for container",n.cache.context.height);C.css({height:n.cache.context.height})}}},minimumSize:function(){var E=n.cache.element;C.css("min-height",E.height)},scroll:function(E){n.debug("Setting scroll on element",E);if(n.elementScroll==E){return}if(n.is.top()){A.css("bottom","").css("top",-E)}if(n.is.bottom()){A.css("top","").css("bottom",E)}},size:function(){if(n.cache.element.height!==0&&n.cache.element.width!==0){t.style.setProperty("width",n.cache.element.width+"px","important");t.style.setProperty("height",n.cache.element.height+"px","important")}}},is:{standardScroll:function(){return(r[0]==b)},top:function(){return A.hasClass(y.top)},bottom:function(){return A.hasClass(y.bottom)},initialPosition:function(){return(!n.is.fixed()&&!n.is.bound())},hidden:function(){return(!A.is(":visible"))},bound:function(){return A.hasClass(y.bound)},fixed:function(){return A.hasClass(y.fixed)}},stick:function(O){var N=O||r.scrollTop(),E=n.cache,P=E.fits,M=E.sameHeight,J=E.element,H=E.scrollContext,F=E.context,I=(n.is.bottom()&&p.pushing)?p.bottomOffset:p.offset,O={top:N+I,bottom:N+I+H.height},K=(P)?0:n.get.elementScroll(O.top),G=!P,L=(J.height!==0);if(L&&!M){if(n.is.initialPosition()){if(O.top>=F.bottom){n.debug("Initial element position is bottom of container");n.bindBottom()}else{if(O.top>J.top){if((J.height+O.top-K)>=F.bottom){n.debug("Initial element position is bottom of container");n.bindBottom()}else{n.debug("Initial element position is fixed");n.fixTop()}}}}else{if(n.is.fixed()){if(n.is.top()){if(O.top<=J.top){n.debug("Fixed element reached top of container");n.setInitialPosition()}else{if((J.height+O.top-K)>=F.bottom){n.debug("Fixed element reached bottom of container");n.bindBottom()}else{if(G){n.set.scroll(K);n.save.lastScroll(O.top);n.save.elementScroll(K)}}}}else{if(n.is.bottom()){if((O.bottom-J.height)<=J.top){n.debug("Bottom fixed rail has reached top of container");n.setInitialPosition()}else{if(O.bottom>=F.bottom){n.debug("Bottom fixed rail has reached bottom of container");n.bindBottom()}else{if(G){n.set.scroll(K);n.save.lastScroll(O.top);n.save.elementScroll(K)}}}}}}else{if(n.is.bottom()){if(O.top<=J.top){n.debug("Jumped from bottom fixed to top fixed, most likely used home/end button");n.setInitialPosition()}else{if(p.pushing){if(n.is.bound()&&O.bottom<=F.bottom){n.debug("Fixing bottom attached element to bottom of browser.");n.fixBottom()}}else{if(n.is.bound()&&(O.top<=F.bottom-J.height)){n.debug("Fixing bottom attached element to top of browser.");n.fixTop()}}}}}}}},bindTop:function(){n.debug("Binding element to top of parent container");n.remove.offset();A.css({left:"",top:"",marginBottom:""}).removeClass(y.fixed).removeClass(y.bottom).addClass(y.bound).addClass(y.top);p.onTop.call(t);p.onUnstick.call(t)},bindBottom:function(){n.debug("Binding element to bottom of parent container");n.remove.offset();A.css({left:"",top:""}).removeClass(y.fixed).removeClass(y.top).addClass(y.bound).addClass(y.bottom);p.onBottom.call(t);p.onUnstick.call(t)},setInitialPosition:function(){n.debug("Returning to initial position");n.unfix();n.unbind()},fixTop:function(){n.debug("Fixing element to top of page");if(p.setSize){n.set.size()}n.set.minimumSize();n.set.offset();A.css({left:n.cache.element.left,bottom:"",marginBottom:""}).removeClass(y.bound).removeClass(y.bottom).addClass(y.fixed).addClass(y.top);p.onStick.call(t)},fixBottom:function(){n.debug("Sticking element to bottom of page");if(p.setSize){n.set.size()}n.set.minimumSize();n.set.offset();A.css({left:n.cache.element.left,bottom:"",marginBottom:""}).removeClass(y.bound).removeClass(y.top).addClass(y.fixed).addClass(y.bottom);p.onStick.call(t)},unbind:function(){if(n.is.bound()){n.debug("Removing container bound position on element");n.remove.offset();A.removeClass(y.bound).removeClass(y.top).removeClass(y.bottom)}},unfix:function(){if(n.is.fixed()){n.debug("Removing fixed position on element");n.remove.minimumSize();n.remove.offset();A.removeClass(y.fixed).removeClass(y.top).removeClass(y.bottom);p.onUnstick.call(t)}},reset:function(){n.debug("Resetting elements position");n.unbind();n.unfix();n.resetCSS();n.remove.offset();n.remove.lastScroll()},resetCSS:function(){A.css({width:"",height:""});C.css({height:""})},setting:function(E,F){if(c.isPlainObject(E)){c.extend(true,p,E)}else{if(F!==d){p[E]=F}else{return p[E]}}},internal:function(E,F){if(c.isPlainObject(E)){c.extend(true,n,E)}else{if(F!==d){n[E]=F}else{return n[E]}}},debug:function(){if(!p.silent&&p.debug){if(p.performance){n.performance.log(arguments)}else{n.debug=Function.prototype.bind.call(console.info,console,p.name+":");n.debug.apply(console,arguments)}}},verbose:function(){if(!p.silent&&p.verbose&&p.debug){if(p.performance){n.performance.log(arguments)}else{n.verbose=Function.prototype.bind.call(console.info,console,p.name+":");n.verbose.apply(console,arguments)}}},error:function(){if(!p.silent){n.error=Function.prototype.bind.call(console.error,console,p.name+":");n.error.apply(console,arguments)}},performance:{log:function(G){var F,H,E;if(p.performance){F=new Date().getTime();E=f||F;H=F-E;f=F;j.push({Name:G[0],Arguments:[].slice.call(G,1)||"",Element:t,"Execution Time":H})}clearTimeout(n.performance.timer);n.performance.timer=setTimeout(n.performance.display,0)},display:function(){var F=p.name+":",E=0;f=false;clearTimeout(n.performance.timer);c.each(j,function(G,H){E+=H["Execution Time"]});F+=" "+E+"ms";if(h){F+=" '"+h+"'"}if((console.group!==d||console.table!==d)&&j.length>0){console.groupCollapsed(F);if(console.table){console.table(j)}else{c.each(j,function(G,H){console.log(H.Name+": "+H["Execution Time"]+"ms")})}console.groupEnd()}j=[]}},invoke:function(J,F,H){var G=B,K,I,E;F=F||l;H=t||H;if(typeof J=="string"&&G!==d){J=J.split(/[\. ]/);K=J.length-1;c.each(J,function(N,M){var L=(N!=K)?M+J[N+1].charAt(0).toUpperCase()+J[N+1].slice(1):J;if(c.isPlainObject(G[L])&&(N!=K)){G=G[L]}else{if(G[L]!==d){I=G[L];return false}else{if(c.isPlainObject(G[M])&&(N!=K)){G=G[M]}else{if(G[M]!==d){I=G[M];return false}else{return false}}}}})}if(c.isFunction(I)){E=I.apply(H,F)}else{if(I!==d){E=I}}if(Array.isArray(g)){g.push(E)}else{if(g!==d){g=[g,E]}else{if(E!==d){g=E}}}return I}};if(e){if(B===d){n.initialize()}n.invoke(i)}else{if(B!==d){B.invoke("destroy")}n.initialize()}});return(g!==d)?g:this};c.fn.sticky.settings={name:"Sticky",namespace:"sticky",silent:false,debug:false,verbose:true,performance:true,pushing:false,context:false,container:false,scrollContext:b,offset:0,bottomOffset:0,jitter:5,setSize:true,observeChanges:false,onReposition:function(){},onScroll:function(){},onStick:function(){},onUnstick:function(){},onTop:function(){},onBottom:function(){},error:{container:"Sticky element must be inside a relative container",visible:"Element is hidden, you must call refresh after element becomes visible. Use silent setting to surpress this warning in production.",method:"The method you called is not defined.",invalidContext:"Context specified does not exist",elementSize:"Sticky element is larger than its container, cannot create sticky."},className:{bound:"bound",fixed:"fixed",supported:"native",top:"top",bottom:"bottom"}}})(jQuery,window,document);