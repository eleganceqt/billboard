/*!
 * # Fomantic-UI - State
 * http://github.com/fomantic/Fomantic-UI/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;(function(c,b,a,d){c.isFunction=c.isFunction||function(e){return typeof e==="function"&&typeof e.nodeType!=="number"};b=(typeof b!="undefined"&&b.Math==Math)?b:(typeof self!="undefined"&&self.Math==Math)?self:Function("return this")();c.fn.state=function(m){var k=c(this),h=k.selector||"",f=new Date().getTime(),j=[],i=arguments[0],e=(typeof i=="string"),l=[].slice.call(arguments,1),g;k.each(function(){var o=(c.isPlainObject(m))?c.extend(true,{},c.fn.state.settings,m):c.extend({},c.fn.state.settings),t=o.error,v=o.metadata,s=o.className,p=o.namespace,y=o.states,x=o.text,z="."+p,r=p+"-module",u=c(this),q=this,w=u.data(r),n;n={initialize:function(){n.verbose("Initializing module");if(o.automatic){n.add.defaults()}if(o.context&&h!==""){c(o.context).on(h,"mouseenter"+z,n.change.text).on(h,"mouseleave"+z,n.reset.text).on(h,"click"+z,n.toggle.state)}else{u.on("mouseenter"+z,n.change.text).on("mouseleave"+z,n.reset.text).on("click"+z,n.toggle.state)}n.instantiate()},instantiate:function(){n.verbose("Storing instance of module",n);w=n;u.data(r,n)},destroy:function(){n.verbose("Destroying previous module",w);u.off(z).removeData(r)},refresh:function(){n.verbose("Refreshing selector cache");u=c(q)},add:{defaults:function(){var A=m&&c.isPlainObject(m.states)?m.states:{};c.each(o.defaults,function(C,B){if(n.is[C]!==d&&n.is[C]()){n.verbose("Adding default states",C,q);c.extend(o.states,B,A)}})}},is:{active:function(){return u.hasClass(s.active)},loading:function(){return u.hasClass(s.loading)},inactive:function(){return !(u.hasClass(s.active))},state:function(A){if(s[A]===d){return false}return u.hasClass(s[A])},enabled:function(){return !(u.is(o.filter.active))},disabled:function(){return(u.is(o.filter.active))},textEnabled:function(){return !(u.is(o.filter.text))},button:function(){return u.is(".button:not(a, .submit)")},input:function(){return u.is("input")},progress:function(){return u.is(".ui.progress")}},allow:function(A){n.debug("Now allowing state",A);y[A]=true},disallow:function(A){n.debug("No longer allowing",A);y[A]=false},allows:function(A){return y[A]||false},enable:function(){u.removeClass(s.disabled)},disable:function(){u.addClass(s.disabled)},setState:function(A){if(n.allows(A)){u.addClass(s[A])}},removeState:function(A){if(n.allows(A)){u.removeClass(s[A])}},toggle:{state:function(){var A,B;if(n.allows("active")&&n.is.enabled()){n.refresh();if(c.fn.api!==d){A=u.api("get request");B=u.api("was cancelled");if(B){n.debug("API Request cancelled by beforesend");o.activateTest=function(){return false};o.deactivateTest=function(){return false}}else{if(A){n.listenTo(A);return}}}n.change.state()}}},listenTo:function(A){n.debug("API request detected, waiting for state signal",A);if(A){if(x.loading){n.update.text(x.loading)}c.when(A).then(function(){if(A.state()=="resolved"){n.debug("API request succeeded");o.activateTest=function(){return true};o.deactivateTest=function(){return true}}else{n.debug("API request failed");o.activateTest=function(){return false};o.deactivateTest=function(){return false}}n.change.state()})}},change:{state:function(){n.debug("Determining state change direction");if(n.is.inactive()){n.activate()}else{n.deactivate()}if(o.sync){n.sync()}o.onChange.call(q)},text:function(){if(n.is.textEnabled()){if(n.is.disabled()){n.verbose("Changing text to disabled text",x.hover);n.update.text(x.disabled)}else{if(n.is.active()){if(x.hover){n.verbose("Changing text to hover text",x.hover);n.update.text(x.hover)}else{if(x.deactivate){n.verbose("Changing text to deactivating text",x.deactivate);n.update.text(x.deactivate)}}}else{if(x.hover){n.verbose("Changing text to hover text",x.hover);n.update.text(x.hover)}else{if(x.activate){n.verbose("Changing text to activating text",x.activate);n.update.text(x.activate)}}}}}}},activate:function(){if(o.activateTest.call(q)){n.debug("Setting state to active");u.addClass(s.active);n.update.text(x.active);o.onActivate.call(q)}},deactivate:function(){if(o.deactivateTest.call(q)){n.debug("Setting state to inactive");u.removeClass(s.active);n.update.text(x.inactive);o.onDeactivate.call(q)}},sync:function(){n.verbose("Syncing other buttons to current state");if(n.is.active()){k.not(u).state("activate")}else{k.not(u).state("deactivate")}},get:{text:function(){return(o.selector.text)?u.find(o.selector.text).text():u.html()},textFor:function(A){return x[A]||false}},flash:{text:function(C,B,D){var A=n.get.text();n.debug("Flashing text message",C,B);C=C||o.text.flash;B=B||o.flashDuration;D=D||function(){};n.update.text(C);setTimeout(function(){n.update.text(A);D.call(q)},B)}},reset:{text:function(){var A=x.active||u.data(v.storedText),B=x.inactive||u.data(v.storedText);if(n.is.textEnabled()){if(n.is.active()&&A){n.verbose("Resetting active text",A);n.update.text(A)}else{if(B){n.verbose("Resetting inactive text",A);n.update.text(B)}}}}},update:{text:function(B){var A=n.get.text();if(B&&B!==A){n.debug("Updating text",B);if(o.selector.text){u.data(v.storedText,B).find(o.selector.text).text(B)}else{u.data(v.storedText,B).html(B)}}else{n.debug("Text is already set, ignoring update",B)}}},setting:function(A,B){n.debug("Changing setting",A,B);if(c.isPlainObject(A)){c.extend(true,o,A)}else{if(B!==d){if(c.isPlainObject(o[A])){c.extend(true,o[A],B)}else{o[A]=B}}else{return o[A]}}},internal:function(A,B){if(c.isPlainObject(A)){c.extend(true,n,A)}else{if(B!==d){n[A]=B}else{return n[A]}}},debug:function(){if(!o.silent&&o.debug){if(o.performance){n.performance.log(arguments)}else{n.debug=Function.prototype.bind.call(console.info,console,o.name+":");n.debug.apply(console,arguments)}}},verbose:function(){if(!o.silent&&o.verbose&&o.debug){if(o.performance){n.performance.log(arguments)}else{n.verbose=Function.prototype.bind.call(console.info,console,o.name+":");n.verbose.apply(console,arguments)}}},error:function(){if(!o.silent){n.error=Function.prototype.bind.call(console.error,console,o.name+":");n.error.apply(console,arguments)}},performance:{log:function(C){var B,D,A;if(o.performance){B=new Date().getTime();A=f||B;D=B-A;f=B;j.push({Name:C[0],Arguments:[].slice.call(C,1)||"",Element:q,"Execution Time":D})}clearTimeout(n.performance.timer);n.performance.timer=setTimeout(n.performance.display,500)},display:function(){var B=o.name+":",A=0;f=false;clearTimeout(n.performance.timer);c.each(j,function(C,D){A+=D["Execution Time"]});B+=" "+A+"ms";if(h){B+=" '"+h+"'"}if((console.group!==d||console.table!==d)&&j.length>0){console.groupCollapsed(B);if(console.table){console.table(j)}else{c.each(j,function(C,D){console.log(D.Name+": "+D["Execution Time"]+"ms")})}console.groupEnd()}j=[]}},invoke:function(F,B,D){var C=w,G,E,A;B=B||l;D=q||D;if(typeof F=="string"&&C!==d){F=F.split(/[\. ]/);G=F.length-1;c.each(F,function(J,I){var H=(J!=G)?I+F[J+1].charAt(0).toUpperCase()+F[J+1].slice(1):F;if(c.isPlainObject(C[H])&&(J!=G)){C=C[H]}else{if(C[H]!==d){E=C[H];return false}else{if(c.isPlainObject(C[I])&&(J!=G)){C=C[I]}else{if(C[I]!==d){E=C[I];return false}else{n.error(t.method,F);return false}}}}})}if(c.isFunction(E)){A=E.apply(D,B)}else{if(E!==d){A=E}}if(Array.isArray(g)){g.push(A)}else{if(g!==d){g=[g,A]}else{if(A!==d){g=A}}}return E}};if(e){if(w===d){n.initialize()}n.invoke(i)}else{if(w!==d){w.invoke("destroy")}n.initialize()}});return(g!==d)?g:this};c.fn.state.settings={name:"State",debug:false,verbose:false,namespace:"state",performance:true,onActivate:function(){},onDeactivate:function(){},onChange:function(){},activateTest:function(){return true},deactivateTest:function(){return true},automatic:true,sync:false,flashDuration:1000,filter:{text:".loading, .disabled",active:".disabled"},context:false,error:{beforeSend:"The before send function has cancelled state change",method:"The method you called is not defined."},metadata:{promise:"promise",storedText:"stored-text"},className:{active:"active",disabled:"disabled",error:"error",loading:"loading",success:"success",warning:"warning"},selector:{text:false},defaults:{input:{disabled:true,loading:true,active:true},button:{disabled:true,loading:true,active:true},progress:{active:true,success:true,warning:true,error:true}},states:{active:true,disabled:true,error:true,loading:true,success:true,warning:true},text:{disabled:false,flash:false,hover:false,active:false,inactive:false,activate:false,deactivate:false}}})(jQuery,window,document);