/*!
 * # Fomantic-UI - Progress
 * http://github.com/fomantic/Fomantic-UI/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;(function(c,b,a,d){c.isFunction=c.isFunction||function(e){return typeof e==="function"&&typeof e.nodeType!=="number"};b=(typeof b!="undefined"&&b.Math==Math)?b:(typeof self!="undefined"&&self.Math==Math)?self:Function("return this")();c.fn.progress=function(m){var k=c(this),h=k.selector||"",f=new Date().getTime(),j=[],i=arguments[0],e=(typeof i=="string"),l=[].slice.call(arguments,1),g;k.each(function(){var p=(c.isPlainObject(m))?c.extend(true,{},c.fn.progress.settings,m):c.extend({},c.fn.progress.settings),u=p.className,z=p.metadata,q=p.namespace,r=p.selector,v=p.error,C="."+q,t="module-"+q,y=c(this),x=c(this).find(r.bar),A=c(this).find(r.progress),w=c(this).find(r.label),s=this,B=y.data(t),D=false,n,o;o={helper:{sum:function(E){return Array.isArray(E)?E.reduce(function(G,F){return G+Number(F)},0):0},derivePrecision:function(F,I){var H=0;var E=1;var G=F/I;while(H<10){G=G*E;if(G>1){break}E=Math.pow(10,H++)}return E},forceArray:function(E){return Array.isArray(E)?E:!isNaN(E)?[E]:typeof E=="string"?E.split(","):[]}},initialize:function(){o.set.duration();o.set.transitionEvent();o.debug(s);o.read.metadata();o.read.settings();o.instantiate()},instantiate:function(){o.verbose("Storing instance of progress",o);B=o;y.data(t,o)},destroy:function(){o.verbose("Destroying previous progress for",y);clearInterval(B.interval);o.remove.state();y.removeData(t);B=d},reset:function(){o.remove.nextValue();o.update.progress(0)},complete:function(){if(o.percent===d||o.percent<100){o.remove.progressPoll();o.set.percent(100)}},read:{metadata:function(){var E={percent:o.helper.forceArray(y.data(z.percent)),total:y.data(z.total),value:o.helper.forceArray(y.data(z.value))};if(E.total){o.debug("Total value set from metadata",E.total);o.set.total(E.total)}if(E.value.length>0){o.debug("Current value set from metadata",E.value);o.set.value(E.value);o.set.progress(E.value)}if(E.percent.length>0){o.debug("Current percent value set from metadata",E.percent);o.set.percent(E.percent)}},settings:function(){if(p.total!==false){o.debug("Current total set in settings",p.total);o.set.total(p.total)}if(p.value!==false){o.debug("Current value set in settings",p.value);o.set.value(p.value);o.set.progress(o.value)}if(p.percent!==false){o.debug("Current percent set in settings",p.percent);o.set.percent(p.percent)}}},bind:{transitionEnd:function(F){var E=o.get.transitionEnd();x.one(E+C,function(G){clearTimeout(o.failSafeTimer);F.call(this,G)});o.failSafeTimer=setTimeout(function(){x.triggerHandler(E)},p.duration+p.failSafeDelay);o.verbose("Adding fail safe timer",o.timer)}},increment:function(F){var E,G;if(o.has.total()){E=o.get.value();F=F||1}else{E=o.get.percent();F=F||o.get.randomValue()}G=E+F;o.debug("Incrementing percentage by",E,G,F);G=o.get.normalizedValue(G);o.set.progress(G)},decrement:function(F){var G=o.get.total(),E,H;if(G){E=o.get.value();F=F||1;H=E-F;o.debug("Decrementing value by",F,E)}else{E=o.get.percent();F=F||o.get.randomValue();H=E-F;o.debug("Decrementing percentage by",F,E)}H=o.get.normalizedValue(H);o.set.progress(H)},has:{progressPoll:function(){return o.progressPoll},total:function(){return(o.get.total()!==false)}},get:{text:function(I,E){var K=E||0,H=o.get.value(K),G=o.total||0,F=(D)?o.get.displayPercent(K):o.get.percent(K),J=(o.total>0)?(G-H):(100-F);I=I||"";I=I.replace("{value}",H).replace("{total}",G).replace("{left}",J).replace("{percent}",F).replace("{bar}",p.text.bars[K]||"");o.verbose("Adding variables to progress bar text",I);return I},normalizedValue:function(E){if(E<0){o.debug("Value cannot decrement below 0");return 0}if(o.has.total()){if(E>o.total){o.debug("Value cannot increment above total",o.total);return o.total}}else{if(E>100){o.debug("Value cannot increment above 100 percent");return 100}}return E},updateInterval:function(){if(p.updateInterval=="auto"){return p.duration}return p.updateInterval},randomValue:function(){o.debug("Generating random increment percentage");return Math.floor((Math.random()*p.random.max)+p.random.min)},numericValue:function(E){return(typeof E==="string")?(E.replace(/[^\d.]/g,"")!=="")?+(E.replace(/[^\d.]/g,"")):false:E},transitionEnd:function(){var E=a.createElement("element"),F={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"},G;for(G in F){if(E.style[G]!==d){return F[G]}}},displayPercent:function(G){var J=c(x[G]),I=J.width(),E=y.width(),H=parseInt(J.css("min-width"),10),F=(I>H)?(I/E*100):o.percent;return(p.precision>0)?Math.round(F*(10*p.precision))/(10*p.precision):Math.round(F)},percent:function(E){return o.percent&&o.percent[E||0]||0},value:function(E){return o.nextValue||o.value&&o.value[E||0]||0},total:function(){return o.total||false}},create:{progressPoll:function(){o.progressPoll=setTimeout(function(){o.update.toNextValue();o.remove.progressPoll()},o.get.updateInterval())}},is:{complete:function(){return o.is.success()||o.is.warning()||o.is.error()},success:function(){return y.hasClass(u.success)},warning:function(){return y.hasClass(u.warning)},error:function(){return y.hasClass(u.error)},active:function(){return y.hasClass(u.active)},visible:function(){return y.is(":visible")}},remove:{progressPoll:function(){o.verbose("Removing progress poll timer");if(o.progressPoll){clearTimeout(o.progressPoll);delete o.progressPoll}},nextValue:function(){o.verbose("Removing progress value stored for next update");delete o.nextValue},state:function(){o.verbose("Removing stored state");delete o.total;delete o.percent;delete o.value},active:function(){o.verbose("Removing active state");y.removeClass(u.active)},success:function(){o.verbose("Removing success state");y.removeClass(u.success)},warning:function(){o.verbose("Removing warning state");y.removeClass(u.warning)},error:function(){o.verbose("Removing error state");y.removeClass(u.error)}},set:{barWidth:function(H){o.debug("set bar width with ",H);H=o.helper.forceArray(H);var K=-1;var F=-1;var I=o.helper.sum(H);var G=x.length;var J=G>1;var E=H.map(function(N,L){var M=(L===G-1&&I===0);var O=c(x[L]);if(N===0&&J&&!M){O.css("display","none")}else{if(J&&M){O.css("background","transparent")}if(K==-1){K=L}F=L;O.css({display:"block",width:N+"%"})}return parseInt(N,10)});H.forEach(function(M,L){var N=c(x[L]);N.css({borderTopLeftRadius:L==K?"":0,borderBottomLeftRadius:L==K?"":0,borderTopRightRadius:L==F?"":0,borderBottomRightRadius:L==F?"":0})});y.attr("data-percent",E)},duration:function(E){E=E||p.duration;E=(typeof E=="number")?E+"ms":E;o.verbose("Setting progress bar transition duration",E);x.css({"transition-duration":E})},percent:function(E){E=o.helper.forceArray(E).map(function(K){return(typeof K=="string")?+(K.replace("%","")):K});var H=o.has.total();var F=o.helper.sum(E);var G=E.length>1&&H;var J=o.helper.sum(o.helper.forceArray(o.value));if(G&&J>o.total){o.error(v.sumExceedsTotal,J,o.total)}else{if(!G&&F>100){o.error(v.tooHigh,F)}else{if(F<0){o.error(v.tooLow,F)}else{var I=p.precision>0?p.precision:G?o.helper.derivePrecision(Math.min.apply(null,o.value),o.total):d;E=E.map(function(K){return(I>0)?Math.round(K*(10*I))/(10*I):Math.round(K)});o.percent=E;if(!H){o.value=E.map(function(K){return(I>0)?Math.round((K/100)*o.total*(10*I))/(10*I):Math.round((K/100)*o.total*10)/10});if(p.limitValues){o.value=o.value.map(function(K){return(K>100)?100:(o.value<0)?0:o.value})}}o.set.barWidth(E);o.set.labelInterval();o.set.labels()}}}p.onChange.call(s,E,o.value,o.total)},labelInterval:function(){var E=function(){o.verbose("Bar finished animating, removing continuous label updates");clearInterval(o.interval);D=false;o.set.labels()};clearInterval(o.interval);o.bind.transitionEnd(E);D=true;o.interval=setInterval(function(){var F=c.contains(a.documentElement,s);if(!F){clearInterval(o.interval);D=false}o.set.labels()},p.framerate)},labels:function(){o.verbose("Setting both bar progress and outer label text");o.set.barLabel();o.set.state()},label:function(E){E=E||"";if(E){E=o.get.text(E);o.verbose("Setting label to text",E);w.text(E)}},state:function(E){E=(E!==d)?E:o.helper.sum(o.percent);if(E===100){if(p.autoSuccess&&x.length===1&&!(o.is.warning()||o.is.error()||o.is.success())){o.set.success();o.debug("Automatically triggering success at 100%")}else{o.verbose("Reached 100% removing active state");o.remove.active();o.remove.progressPoll()}}else{if(E>0){o.verbose("Adjusting active progress bar label",E);o.set.active()}else{o.remove.active();o.set.label(p.text.active)}}},barLabel:function(E){A.map(function(G,H){var F=c(H);if(E!==d){F.text(o.get.text(E,G))}else{if(p.label=="ratio"&&o.total){o.verbose("Adding ratio to bar label");F.text(o.get.text(p.text.ratio,G))}else{if(p.label=="percent"){o.verbose("Adding percentage to bar label");F.text(o.get.text(p.text.percent,G))}}}})},active:function(E){E=E||p.text.active;o.debug("Setting active state");if(p.showActivity&&!o.is.active()){y.addClass(u.active)}o.remove.warning();o.remove.error();o.remove.success();E=p.onLabelUpdate("active",E,o.value,o.total);if(E){o.set.label(E)}o.bind.transitionEnd(function(){p.onActive.call(s,o.value,o.total)})},success:function(E){E=E||p.text.success||p.text.active;o.debug("Setting success state");y.addClass(u.success);o.remove.active();o.remove.warning();o.remove.error();o.complete();if(p.text.success){E=p.onLabelUpdate("success",E,o.value,o.total);o.set.label(E)}else{E=p.onLabelUpdate("active",E,o.value,o.total);o.set.label(E)}o.bind.transitionEnd(function(){p.onSuccess.call(s,o.total)})},warning:function(E){E=E||p.text.warning;o.debug("Setting warning state");y.addClass(u.warning);o.remove.active();o.remove.success();o.remove.error();o.complete();E=p.onLabelUpdate("warning",E,o.value,o.total);if(E){o.set.label(E)}o.bind.transitionEnd(function(){p.onWarning.call(s,o.value,o.total)})},error:function(E){E=E||p.text.error;o.debug("Setting error state");y.addClass(u.error);o.remove.active();o.remove.success();o.remove.warning();o.complete();E=p.onLabelUpdate("error",E,o.value,o.total);if(E){o.set.label(E)}o.bind.transitionEnd(function(){p.onError.call(s,o.value,o.total)})},transitionEvent:function(){n=o.get.transitionEnd()},total:function(E){o.total=E},value:function(E){o.value=o.helper.forceArray(E)},progress:function(E){if(!o.has.progressPoll()){o.debug("First update in progress update interval, immediately updating",E);o.update.progress(E);o.create.progressPoll()}else{o.debug("Updated within interval, setting next update to use new value",E);o.set.nextValue(E)}},nextValue:function(E){o.nextValue=E}},update:{toNextValue:function(){var E=o.nextValue;if(E){o.debug("Update interval complete using last updated value",E);o.update.progress(E);o.remove.nextValue()}},progress:function(E){var F=o.has.total();if(F){o.set.value(E)}var G=o.helper.forceArray(E).map(function(I){var H;I=o.get.numericValue(I);if(I===false){o.error(v.nonNumeric,I)}I=o.get.normalizedValue(I);if(F){H=(I/o.total)*100;o.debug("Calculating percent complete from total",H)}else{H=I;o.debug("Setting value to exact percentage value",H)}return H});o.set.percent(G)}},setting:function(E,F){o.debug("Changing setting",E,F);if(c.isPlainObject(E)){c.extend(true,p,E)}else{if(F!==d){if(c.isPlainObject(p[E])){c.extend(true,p[E],F)}else{p[E]=F}}else{return p[E]}}},internal:function(E,F){if(c.isPlainObject(E)){c.extend(true,o,E)}else{if(F!==d){o[E]=F}else{return o[E]}}},debug:function(){if(!p.silent&&p.debug){if(p.performance){o.performance.log(arguments)}else{o.debug=Function.prototype.bind.call(console.info,console,p.name+":");o.debug.apply(console,arguments)}}},verbose:function(){if(!p.silent&&p.verbose&&p.debug){if(p.performance){o.performance.log(arguments)}else{o.verbose=Function.prototype.bind.call(console.info,console,p.name+":");o.verbose.apply(console,arguments)}}},error:function(){if(!p.silent){o.error=Function.prototype.bind.call(console.error,console,p.name+":");o.error.apply(console,arguments)}},performance:{log:function(G){var F,H,E;if(p.performance){F=new Date().getTime();E=f||F;H=F-E;f=F;j.push({Name:G[0],Arguments:[].slice.call(G,1)||"",Element:s,"Execution Time":H})}clearTimeout(o.performance.timer);o.performance.timer=setTimeout(o.performance.display,500)},display:function(){var F=p.name+":",E=0;f=false;clearTimeout(o.performance.timer);c.each(j,function(G,H){E+=H["Execution Time"]});F+=" "+E+"ms";if(h){F+=" '"+h+"'"}if((console.group!==d||console.table!==d)&&j.length>0){console.groupCollapsed(F);if(console.table){console.table(j)}else{c.each(j,function(G,H){console.log(H.Name+": "+H["Execution Time"]+"ms")})}console.groupEnd()}j=[]}},invoke:function(J,F,H){var G=B,K,I,E;F=F||l;H=s||H;if(typeof J=="string"&&G!==d){J=J.split(/[\. ]/);K=J.length-1;c.each(J,function(N,M){var L=(N!=K)?M+J[N+1].charAt(0).toUpperCase()+J[N+1].slice(1):J;if(c.isPlainObject(G[L])&&(N!=K)){G=G[L]}else{if(G[L]!==d){I=G[L];return false}else{if(c.isPlainObject(G[M])&&(N!=K)){G=G[M]}else{if(G[M]!==d){I=G[M];return false}else{o.error(v.method,J);return false}}}}})}if(c.isFunction(I)){E=I.apply(H,F)}else{if(I!==d){E=I}}if(Array.isArray(g)){g.push(E)}else{if(g!==d){g=[g,E]}else{if(E!==d){g=E}}}return I}};if(e){if(B===d){o.initialize()}o.invoke(i)}else{if(B!==d){B.invoke("destroy")}o.initialize()}});return(g!==d)?g:this};c.fn.progress.settings={name:"Progress",namespace:"progress",silent:false,debug:false,verbose:false,performance:true,random:{min:2,max:5},duration:300,updateInterval:"auto",autoSuccess:true,showActivity:true,limitValues:true,label:"percent",precision:0,framerate:(1000/30),percent:false,total:false,value:false,failSafeDelay:100,onLabelUpdate:function(g,h,f,e){return h},onChange:function(f,g,e){},onSuccess:function(e){},onActive:function(f,e){},onError:function(f,e){},onWarning:function(f,e){},error:{method:"The method you called is not defined.",nonNumeric:"Progress value is non numeric",tooHigh:"Value specified is above 100%",tooLow:"Value specified is below 0%",sumExceedsTotal:"Sum of multple values exceed total"},regExp:{variable:/\{\$*[A-z0-9]+\}/g},metadata:{percent:"percent",total:"total",value:"value"},selector:{bar:"> .bar",label:"> .label",progress:".bar > .progress"},text:{active:false,error:false,success:false,warning:false,percent:"{percent}%",ratio:"{value} of {total}",bars:[""]},className:{active:"active",error:"error",success:"success",warning:"warning"}}})(jQuery,window,document);