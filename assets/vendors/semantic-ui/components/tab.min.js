/*!
 * # Fomantic-UI - Tab
 * http://github.com/fomantic/Fomantic-UI/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;(function(c,b,a,d){c.isWindow=c.isWindow||function(e){return e!=null&&e===e.window};c.isFunction=c.isFunction||function(e){return typeof e==="function"&&typeof e.nodeType!=="number"};b=(typeof b!="undefined"&&b.Math==Math)?b:(typeof self!="undefined"&&self.Math==Math)?self:Function("return this")();c.fn.tab=function(n){var l=c.isFunction(this)?c(b):c(this),i=l.selector||"",g=new Date().getTime(),k=[],j=arguments[0],e=(typeof j=="string"),m=[].slice.call(arguments,1),f=false,h;l.each(function(){var F=(c.isPlainObject(n))?c.extend(true,{},c.fn.tab.settings,n):c.extend({},c.fn.tab.settings),s=F.className,x=F.metadata,D=F.selector,C=F.error,u=F.regExp,B="."+F.namespace,y="module-"+F.namespace,t=c(this),A,p,z={},w=true,o=0,r=this,H=t.data(y),E,G,q,v;q={initialize:function(){q.debug("Initializing tab menu item",t);q.fix.callbacks();q.determineTabs();q.debug("Determining tabs",F.context,p);if(F.auto){q.set.auto()}q.bind.events();if(F.history&&!f){q.initializeHistory();f=true}q.instantiate()},instantiate:function(){q.verbose("Storing instance of module",q);H=q;t.data(y,q)},destroy:function(){q.debug("Destroying tabs",t);t.removeData(y).off(B)},bind:{events:function(){if(!c.isWindow(r)){q.debug("Attaching tab activation events to element",t);t.on("click"+B,q.event.click)}}},determineTabs:function(){var I;if(F.context==="parent"){if(t.closest(D.ui).length>0){I=t.closest(D.ui);q.verbose("Using closest UI element as parent",I)}else{I=t}A=I.parent();q.verbose("Determined parent element for creating context",A)}else{if(F.context){A=c(F.context);q.verbose("Using selector for tab context",F.context,A)}else{A=c("body")}}if(F.childrenOnly){p=A.children(D.tabs);q.debug("Searching tab context children for tabs",A,p)}else{p=A.find(D.tabs);q.debug("Searching tab context for tabs",A,p)}},fix:{callbacks:function(){if(c.isPlainObject(n)&&(n.onTabLoad||n.onTabInit)){if(n.onTabLoad){n.onLoad=n.onTabLoad;delete n.onTabLoad;q.error(C.legacyLoad,n.onLoad)}if(n.onTabInit){n.onFirstLoad=n.onTabInit;delete n.onTabInit;q.error(C.legacyInit,n.onFirstLoad)}F=c.extend(true,{},c.fn.tab.settings,n)}}},initializeHistory:function(){q.debug("Initializing page state");if(c.address===d){q.error(C.state);return false}else{if(F.historyType=="state"){q.debug("Using HTML5 to manage state");if(F.path!==false){c.address.history(true).state(F.path)}else{q.error(C.path);return false}}c.address.bind("change",q.event.history.change)}},event:{click:function(J){var I=c(this).data(x.tab);if(I!==d){if(F.history){q.verbose("Updating page state",J);c.address.value(I)}else{q.verbose("Changing tab",J);q.changeTab(I)}J.preventDefault()}else{q.debug("No tab specified")}},history:{change:function(K){var I=K.pathNames.join("/")||q.get.initialPath(),J=F.templates.determineTitle(I)||false;q.performance.display();q.debug("History change event",I,K);v=K;if(I!==d){q.changeTab(I)}if(J){c.address.title(J)}}}},refresh:function(){if(E){q.debug("Refreshing tab",E);q.changeTab(E)}},cache:{read:function(I){return(I!==d)?z[I]:false},add:function(J,I){J=J||E;q.debug("Adding cached content for",J);z[J]=I},remove:function(I){I=I||E;q.debug("Removing cached content for",I);delete z[I]}},escape:{string:function(I){I=String(I);return I.replace(u.escape,"\\$&")}},set:{auto:function(){var I=(typeof F.path=="string")?F.path.replace(/\/$/,"")+"/{$tab}":"/{$tab}";q.verbose("Setting up automatic tab retrieval from server",I);if(c.isPlainObject(F.apiSettings)){F.apiSettings.url=I}else{F.apiSettings={url:I}}},loading:function(J){var K=q.get.tabElement(J),I=K.hasClass(s.loading);if(!I){q.verbose("Setting loading state for",K);K.addClass(s.loading).siblings(p).removeClass(s.active+" "+s.loading);if(K.length>0){F.onRequest.call(K[0],J)}}},state:function(I){c.address.value(I)}},changeTab:function(K){var I=(b.history&&b.history.pushState),J=(I&&F.ignoreFirstLoad&&w),L=(F.auto||c.isPlainObject(F.apiSettings)),M=(L&&!J)?q.utilities.pathToArray(K):q.get.defaultPathArray(K);K=q.utilities.arrayToPath(M);c.each(M,function(Q,P){var W=M.slice(0,Q+1),V=q.utilities.arrayToPath(W),O=q.is.tab(V),R=(Q+1==M.length),U=q.get.tabElement(V),X,T,N,S;q.verbose("Looking for tab",P);if(O){q.verbose("Tab was found",P);E=V;G=q.utilities.filterArray(M,W);if(R){S=true}else{T=M.slice(0,Q+2);N=q.utilities.arrayToPath(T);S=(!q.is.tab(N));if(S){q.verbose("Tab parameters found",T)}}if(S&&L){if(!J){q.activate.navigation(V);q.fetch.content(V,K)}else{q.debug("Ignoring remote content on first tab load",V);w=false;q.cache.add(K,U.html());q.activate.all(V);F.onFirstLoad.call(U[0],V,G,v);F.onLoad.call(U[0],V,G,v)}return false}else{q.debug("Opened local tab",V);q.activate.all(V);if(!q.cache.read(V)){q.cache.add(V,true);q.debug("First time tab loaded calling tab init");F.onFirstLoad.call(U[0],V,G,v)}F.onLoad.call(U[0],V,G,v)}}else{if(K.search("/")==-1&&K!==""){K=q.escape.string(K);X=c("#"+K+', a[name="'+K+'"]');V=X.closest("[data-tab]").data(x.tab);U=q.get.tabElement(V);if(X&&X.length>0&&V){q.debug("Anchor link used, opening parent tab",U,X);if(!U.hasClass(s.active)){setTimeout(function(){q.scrollTo(X)},0)}q.activate.all(V);if(!q.cache.read(V)){q.cache.add(V,true);q.debug("First time tab loaded calling tab init");F.onFirstLoad.call(U[0],V,G,v)}F.onLoad.call(U[0],V,G,v);return false}}else{q.error(C.missingTab,t,A,V);return false}}})},scrollTo:function(I){var J=(I&&I.length>0)?I.offset().top:false;if(J!==false){q.debug("Forcing scroll to an in-page link in a hidden tab",J,I);c(a).scrollTop(J)}},update:{content:function(I,J,L){var M=q.get.tabElement(I),K=M[0];L=(L!==d)?L:F.evaluateScripts;if(typeof F.cacheType=="string"&&F.cacheType.toLowerCase()=="dom"&&typeof J!=="string"){M.empty().append(c(J).clone(true))}else{if(L){q.debug("Updating HTML and evaluating inline scripts",I,J);M.html(J)}else{q.debug("Updating HTML",I,J);K.innerHTML=J}}}},fetch:{content:function(I,P){var M=q.get.tabElement(I),L={dataType:"html",encodeParameters:false,on:"now",cache:F.alwaysRefresh,headers:{"X-Remote":true},onSuccess:function(Q){if(F.cacheType=="response"){q.cache.add(P,Q)}q.update.content(I,Q);if(I==E){q.debug("Content loaded",I);q.activate.tab(I)}else{q.debug("Content loaded in background",I)}F.onFirstLoad.call(M[0],I,G,v);F.onLoad.call(M[0],I,G,v);if(F.loadOnce){q.cache.add(P,true)}else{if(typeof F.cacheType=="string"&&F.cacheType.toLowerCase()=="dom"&&M.children().length>0){setTimeout(function(){var R=M.children().clone(true);R=R.not("script");q.cache.add(P,R)},0)}else{q.cache.add(P,M.html())}}},urlData:{tab:P}},K=M.api("get request")||false,O=(K&&K.state()==="pending"),N,J;P=P||I;J=q.cache.read(P);if(F.cache&&J){q.activate.tab(I);q.debug("Adding cached content",P);if(!F.loadOnce){if(F.evaluateScripts=="once"){q.update.content(I,J,false)}else{q.update.content(I,J)}}F.onLoad.call(M[0],I,G,v)}else{if(O){q.set.loading(I);q.debug("Content is already loading",P)}else{if(c.api!==d){N=c.extend(true,{},F.apiSettings,L);q.debug("Retrieving remote content",P,N);q.set.loading(I);M.api(N)}else{q.error(C.api)}}}}},activate:{all:function(I){q.activate.tab(I);q.activate.navigation(I)},tab:function(I){var K=q.get.tabElement(I),L=(F.deactivate=="siblings")?K.siblings(p):p.not(K),J=K.hasClass(s.active);q.verbose("Showing tab content for",K);if(!J){K.addClass(s.active);L.removeClass(s.active+" "+s.loading);if(K.length>0){F.onVisible.call(K[0],I)}}},navigation:function(I){var L=q.get.navElement(I),K=(F.deactivate=="siblings")?L.siblings(l):l.not(L),J=L.hasClass(s.active);q.verbose("Activating tab navigation for",L,I);if(!J){L.addClass(s.active);K.removeClass(s.active+" "+s.loading)}}},deactivate:{all:function(){q.deactivate.navigation();q.deactivate.tabs()},navigation:function(){l.removeClass(s.active)},tabs:function(){p.removeClass(s.active+" "+s.loading)}},is:{tab:function(I){return(I!==d)?(q.get.tabElement(I).length>0):false}},get:{initialPath:function(){return l.eq(0).data(x.tab)||p.eq(0).data(x.tab)},path:function(){return c.address.value()},defaultPathArray:function(I){return q.utilities.pathToArray(q.get.defaultPath(I))},defaultPath:function(I){var K=l.filter("[data-"+x.tab+'^="'+q.escape.string(I)+'/"]').eq(0),J=K.data(x.tab)||false;if(J){q.debug("Found default tab",J);if(o<F.maxDepth){o++;return q.get.defaultPath(J)}q.error(C.recursion)}else{q.debug("No default tabs found for",I,p)}o=0;return I},navElement:function(I){I=I||E;return l.filter("[data-"+x.tab+'="'+q.escape.string(I)+'"]')},tabElement:function(I){var L,K,M,J;I=I||E;M=q.utilities.pathToArray(I);J=q.utilities.last(M);L=p.filter("[data-"+x.tab+'="'+q.escape.string(I)+'"]');K=p.filter("[data-"+x.tab+'="'+q.escape.string(J)+'"]');return(L.length>0)?L:K},tab:function(){return E}},utilities:{filterArray:function(J,I){return c.grep(J,function(K){return(c.inArray(K,I)==-1)})},last:function(I){return Array.isArray(I)?I[I.length-1]:false},pathToArray:function(I){if(I===d){I=E}return typeof I=="string"?I.split("/"):[I]},arrayToPath:function(I){return Array.isArray(I)?I.join("/"):false}},setting:function(I,J){q.debug("Changing setting",I,J);if(c.isPlainObject(I)){c.extend(true,F,I)}else{if(J!==d){if(c.isPlainObject(F[I])){c.extend(true,F[I],J)}else{F[I]=J}}else{return F[I]}}},internal:function(I,J){if(c.isPlainObject(I)){c.extend(true,q,I)}else{if(J!==d){q[I]=J}else{return q[I]}}},debug:function(){if(!F.silent&&F.debug){if(F.performance){q.performance.log(arguments)}else{q.debug=Function.prototype.bind.call(console.info,console,F.name+":");q.debug.apply(console,arguments)}}},verbose:function(){if(!F.silent&&F.verbose&&F.debug){if(F.performance){q.performance.log(arguments)}else{q.verbose=Function.prototype.bind.call(console.info,console,F.name+":");q.verbose.apply(console,arguments)}}},error:function(){if(!F.silent){q.error=Function.prototype.bind.call(console.error,console,F.name+":");q.error.apply(console,arguments)}},performance:{log:function(K){var J,L,I;if(F.performance){J=new Date().getTime();I=g||J;L=J-I;g=J;k.push({Name:K[0],Arguments:[].slice.call(K,1)||"",Element:r,"Execution Time":L})}clearTimeout(q.performance.timer);q.performance.timer=setTimeout(q.performance.display,500)},display:function(){var J=F.name+":",I=0;g=false;clearTimeout(q.performance.timer);c.each(k,function(K,L){I+=L["Execution Time"]});J+=" "+I+"ms";if(i){J+=" '"+i+"'"}if((console.group!==d||console.table!==d)&&k.length>0){console.groupCollapsed(J);if(console.table){console.table(k)}else{c.each(k,function(K,L){console.log(L.Name+": "+L["Execution Time"]+"ms")})}console.groupEnd()}k=[]}},invoke:function(N,J,L){var K=H,O,M,I;J=J||m;L=r||L;if(typeof N=="string"&&K!==d){N=N.split(/[\. ]/);O=N.length-1;c.each(N,function(R,Q){var P=(R!=O)?Q+N[R+1].charAt(0).toUpperCase()+N[R+1].slice(1):N;if(c.isPlainObject(K[P])&&(R!=O)){K=K[P]}else{if(K[P]!==d){M=K[P];return false}else{if(c.isPlainObject(K[Q])&&(R!=O)){K=K[Q]}else{if(K[Q]!==d){M=K[Q];return false}else{q.error(C.method,N);return false}}}}})}if(c.isFunction(M)){I=M.apply(L,J)}else{if(M!==d){I=M}}if(Array.isArray(h)){h.push(I)}else{if(h!==d){h=[h,I]}else{if(I!==d){h=I}}}return M}};if(e){if(H===d){q.initialize()}q.invoke(j)}else{if(H!==d){H.invoke("destroy")}q.initialize()}});return(h!==d)?h:this};c.tab=function(){c(b).tab.apply(this,arguments)};c.fn.tab.settings={name:"Tab",namespace:"tab",silent:false,debug:false,verbose:false,performance:true,auto:false,history:false,historyType:"hash",path:false,context:false,childrenOnly:false,maxDepth:25,deactivate:"siblings",alwaysRefresh:false,cache:true,loadOnce:false,cacheType:"response",ignoreFirstLoad:false,apiSettings:false,evaluateScripts:"once",onFirstLoad:function(e,f,g){},onLoad:function(e,f,g){},onVisible:function(e,f,g){},onRequest:function(e,f,g){},templates:{determineTitle:function(e){}},error:{api:"You attempted to load content without API module",method:"The method you called is not defined",missingTab:"Activated tab cannot be found. Tabs are case-sensitive.",noContent:"The tab you specified is missing a content url.",path:"History enabled, but no path was specified",recursion:"Max recursive depth reached",legacyInit:"onTabInit has been renamed to onFirstLoad in 2.0, please adjust your code.",legacyLoad:"onTabLoad has been renamed to onLoad in 2.0. Please adjust your code",state:"History requires Asual's Address library <https://github.com/asual/jquery-address>"},regExp:{escape:/[-[\]{}()*+?.,\\^$|#\s:=@]/g},metadata:{tab:"tab",loaded:"loaded",promise:"promise"},className:{loading:"loading",active:"active"},selector:{tabs:".ui.tab",ui:".ui"}}})(jQuery,window,document);