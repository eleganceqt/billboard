/*!
 * # Fomantic-UI - State
 * http://github.com/fomantic/Fomantic-UI/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;(function(h,e,f,g){h.isFunction=h.isFunction||function(a){return typeof a==="function"&&typeof a.nodeType!=="number"};e=(typeof e!="undefined"&&e.Math==Math)?e:(typeof self!="undefined"&&self.Math==Math)?self:Function("return this")();h.fn.state=function(a){var c=h(this),o=c.selector||"",q=new Date().getTime(),d=[],n=arguments[0],r=(typeof n=="string"),b=[].slice.call(arguments,1),p;c.each(function(){var l=(h.isPlainObject(a))?h.extend(true,{},h.fn.state.settings,a):h.extend({},h.fn.state.settings),G=l.error,E=l.metadata,H=l.className,k=l.namespace,B=l.states,C=l.text,A="."+k,i=k+"-module",F=h(this),j=this,D=F.data(i),m;m={initialize:function(){m.verbose("Initializing module");if(l.automatic){m.add.defaults()}if(l.context&&o!==""){h(l.context).on(o,"mouseenter"+A,m.change.text).on(o,"mouseleave"+A,m.reset.text).on(o,"click"+A,m.toggle.state)}else{F.on("mouseenter"+A,m.change.text).on("mouseleave"+A,m.reset.text).on("click"+A,m.toggle.state)}m.instantiate()},instantiate:function(){m.verbose("Storing instance of module",m);D=m;F.data(i,m)},destroy:function(){m.verbose("Destroying previous module",D);F.off(A).removeData(i)},refresh:function(){m.verbose("Refreshing selector cache");F=h(j)},add:{defaults:function(){var s=a&&h.isPlainObject(a.states)?a.states:{};h.each(l.defaults,function(t,u){if(m.is[t]!==g&&m.is[t]()){m.verbose("Adding default states",t,j);h.extend(l.states,u,s)}})}},is:{active:function(){return F.hasClass(H.active)},loading:function(){return F.hasClass(H.loading)},inactive:function(){return !(F.hasClass(H.active))},state:function(s){if(H[s]===g){return false}return F.hasClass(H[s])},enabled:function(){return !(F.is(l.filter.active))},disabled:function(){return(F.is(l.filter.active))},textEnabled:function(){return !(F.is(l.filter.text))},button:function(){return F.is(".button:not(a, .submit)")},input:function(){return F.is("input")},progress:function(){return F.is(".ui.progress")}},allow:function(s){m.debug("Now allowing state",s);B[s]=true},disallow:function(s){m.debug("No longer allowing",s);B[s]=false},allows:function(s){return B[s]||false},enable:function(){F.removeClass(H.disabled)},disable:function(){F.addClass(H.disabled)},setState:function(s){if(m.allows(s)){F.addClass(H[s])}},removeState:function(s){if(m.allows(s)){F.removeClass(H[s])}},toggle:{state:function(){var s,t;if(m.allows("active")&&m.is.enabled()){m.refresh();if(h.fn.api!==g){s=F.api("get request");t=F.api("was cancelled");if(t){m.debug("API Request cancelled by beforesend");l.activateTest=function(){return false};l.deactivateTest=function(){return false}}else{if(s){m.listenTo(s);return}}}m.change.state()}}},listenTo:function(s){m.debug("API request detected, waiting for state signal",s);if(s){if(C.loading){m.update.text(C.loading)}h.when(s).then(function(){if(s.state()=="resolved"){m.debug("API request succeeded");l.activateTest=function(){return true};l.deactivateTest=function(){return true}}else{m.debug("API request failed");l.activateTest=function(){return false};l.deactivateTest=function(){return false}}m.change.state()})}},change:{state:function(){m.debug("Determining state change direction");if(m.is.inactive()){m.activate()}else{m.deactivate()}if(l.sync){m.sync()}l.onChange.call(j)},text:function(){if(m.is.textEnabled()){if(m.is.disabled()){m.verbose("Changing text to disabled text",C.hover);m.update.text(C.disabled)}else{if(m.is.active()){if(C.hover){m.verbose("Changing text to hover text",C.hover);m.update.text(C.hover)}else{if(C.deactivate){m.verbose("Changing text to deactivating text",C.deactivate);m.update.text(C.deactivate)}}}else{if(C.hover){m.verbose("Changing text to hover text",C.hover);m.update.text(C.hover)}else{if(C.activate){m.verbose("Changing text to activating text",C.activate);m.update.text(C.activate)}}}}}}},activate:function(){if(l.activateTest.call(j)){m.debug("Setting state to active");F.addClass(H.active);m.update.text(C.active);l.onActivate.call(j)}},deactivate:function(){if(l.deactivateTest.call(j)){m.debug("Setting state to inactive");F.removeClass(H.active);m.update.text(C.inactive);l.onDeactivate.call(j)}},sync:function(){m.verbose("Syncing other buttons to current state");if(m.is.active()){c.not(F).state("activate")}else{c.not(F).state("deactivate")}},get:{text:function(){return(l.selector.text)?F.find(l.selector.text).text():F.html()},textFor:function(s){return C[s]||false}},flash:{text:function(u,v,t){var s=m.get.text();m.debug("Flashing text message",u,v);u=u||l.text.flash;v=v||l.flashDuration;t=t||function(){};m.update.text(u);setTimeout(function(){m.update.text(s);t.call(j)},v)}},reset:{text:function(){var s=C.active||F.data(E.storedText),t=C.inactive||F.data(E.storedText);if(m.is.textEnabled()){if(m.is.active()&&s){m.verbose("Resetting active text",s);m.update.text(s)}else{if(t){m.verbose("Resetting inactive text",s);m.update.text(t)}}}}},update:{text:function(t){var s=m.get.text();if(t&&t!==s){m.debug("Updating text",t);if(l.selector.text){F.data(E.storedText,t).find(l.selector.text).text(t)}else{F.data(E.storedText,t).html(t)}}else{m.debug("Text is already set, ignoring update",t)}}},setting:function(s,t){m.debug("Changing setting",s,t);if(h.isPlainObject(s)){h.extend(true,l,s)}else{if(t!==g){if(h.isPlainObject(l[s])){h.extend(true,l[s],t)}else{l[s]=t}}else{return l[s]}}},internal:function(s,t){if(h.isPlainObject(s)){h.extend(true,m,s)}else{if(t!==g){m[s]=t}else{return m[s]}}},debug:function(){if(!l.silent&&l.debug){if(l.performance){m.performance.log(arguments)}else{m.debug=Function.prototype.bind.call(console.info,console,l.name+":");m.debug.apply(console,arguments)}}},verbose:function(){if(!l.silent&&l.verbose&&l.debug){if(l.performance){m.performance.log(arguments)}else{m.verbose=Function.prototype.bind.call(console.info,console,l.name+":");m.verbose.apply(console,arguments)}}},error:function(){if(!l.silent){m.error=Function.prototype.bind.call(console.error,console,l.name+":");m.error.apply(console,arguments)}},performance:{log:function(u){var v,t,s;if(l.performance){v=new Date().getTime();s=q||v;t=v-s;q=v;d.push({Name:u[0],Arguments:[].slice.call(u,1)||"",Element:j,"Execution Time":t})}clearTimeout(m.performance.timer);m.performance.timer=setTimeout(m.performance.display,500)},display:function(){var t=l.name+":",s=0;q=false;clearTimeout(m.performance.timer);h.each(d,function(v,u){s+=u["Execution Time"]});t+=" "+s+"ms";if(o){t+=" '"+o+"'"}if((console.group!==g||console.table!==g)&&d.length>0){console.groupCollapsed(t);if(console.table){console.table(d)}else{h.each(d,function(v,u){console.log(u.Name+": "+u["Execution Time"]+"ms")})}console.groupEnd()}d=[]}},invoke:function(u,y,w){var x=D,t,v,s;y=y||b;w=j||w;if(typeof u=="string"&&x!==g){u=u.split(/[\. ]/);t=u.length-1;h.each(u,function(z,K){var L=(z!=t)?K+u[z+1].charAt(0).toUpperCase()+u[z+1].slice(1):u;if(h.isPlainObject(x[L])&&(z!=t)){x=x[L]}else{if(x[L]!==g){v=x[L];return false}else{if(h.isPlainObject(x[K])&&(z!=t)){x=x[K]}else{if(x[K]!==g){v=x[K];return false}else{m.error(G.method,u);return false}}}}})}if(h.isFunction(v)){s=v.apply(w,y)}else{if(v!==g){s=v}}if(Array.isArray(p)){p.push(s)}else{if(p!==g){p=[p,s]}else{if(s!==g){p=s}}}return v}};if(r){if(D===g){m.initialize()}m.invoke(n)}else{if(D!==g){D.invoke("destroy")}m.initialize()}});return(p!==g)?p:this};h.fn.state.settings={name:"State",debug:false,verbose:false,namespace:"state",performance:true,onActivate:function(){},onDeactivate:function(){},onChange:function(){},activateTest:function(){return true},deactivateTest:function(){return true},automatic:true,sync:false,flashDuration:1000,filter:{text:".loading, .disabled",active:".disabled"},context:false,error:{beforeSend:"The before send function has cancelled state change",method:"The method you called is not defined."},metadata:{promise:"promise",storedText:"stored-text"},className:{active:"active",disabled:"disabled",error:"error",loading:"loading",success:"success",warning:"warning"},selector:{text:false},defaults:{input:{disabled:true,loading:true,active:true},button:{disabled:true,loading:true,active:true},progress:{active:true,success:true,warning:true,error:true}},states:{active:true,disabled:true,error:true,loading:true,success:true,warning:true},text:{disabled:false,flash:false,hover:false,active:false,inactive:false,activate:false,deactivate:false}}})(jQuery,window,document);