/*!
 * # Fomantic-UI - Visibility
 * http://github.com/fomantic/Fomantic-UI/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;(function(h,e,f,g){h.isFunction=h.isFunction||function(a){return typeof a==="function"&&typeof a.nodeType!=="number"};e=(typeof e!="undefined"&&e.Math==Math)?e:(typeof self!="undefined"&&self.Math==Math)?self:Function("return this")();h.fn.visibility=function(a){var c=h(this),q=c.selector||"",s=new Date().getTime(),d=[],p=arguments[0],v=(typeof p=="string"),b=[].slice.call(arguments,1),r,t=c.length,u=0;c.each(function(){var o=(h.isPlainObject(a))?h.extend(true,{},h.fn.visibility.settings,a):h.extend({},h.fn.visibility.settings),N=o.className,k=o.namespace,L=o.error,l=o.metadata,M="."+k,i="module-"+k,R=h(e),H=h(this),O=h(o.context),n,m=H.data(i),K=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame||function(w){setTimeout(w,0)},P=this,J=false,j,I,Q;Q={initialize:function(){Q.debug("Initializing",o);Q.setup.cache();if(Q.should.trackChanges()){if(o.type=="image"){Q.setup.image()}if(o.type=="fixed"){Q.setup.fixed()}if(o.observeChanges){Q.observeChanges()}Q.bind.events()}Q.save.position();if(!Q.is.visible()){Q.error(L.visible,H)}if(o.initialCheck){Q.checkVisibility()}Q.instantiate()},instantiate:function(){Q.debug("Storing instance",Q);H.data(i,Q);m=Q},destroy:function(){Q.verbose("Destroying previous module");if(I){I.disconnect()}if(j){j.disconnect()}R.off("load"+M,Q.event.load).off("resize"+M,Q.event.resize);O.off("scroll"+M,Q.event.scroll).off("scrollchange"+M,Q.event.scrollchange);if(o.type=="fixed"){Q.resetFixed();Q.remove.placeholder()}H.off(M).removeData(i)},observeChanges:function(){if("MutationObserver" in e){j=new MutationObserver(Q.event.contextChanged);I=new MutationObserver(Q.event.changed);j.observe(f,{childList:true,subtree:true});I.observe(P,{childList:true,subtree:true});Q.debug("Setting up mutation observer",I)}},bind:{events:function(){Q.verbose("Binding visibility events to scroll and resize");if(o.refreshOnLoad){R.on("load"+M,Q.event.load)}R.on("resize"+M,Q.event.resize);O.off("scroll"+M).on("scroll"+M,Q.event.scroll).on("scrollchange"+M,Q.event.scrollchange)}},event:{changed:function(w){Q.verbose("DOM tree modified, updating visibility calculations");Q.timer=setTimeout(function(){Q.verbose("DOM tree modified, updating sticky menu");Q.refresh()},100)},contextChanged:function(w){[].forEach.call(w,function(x){if(x.removedNodes){[].forEach.call(x.removedNodes,function(y){if(y==P||h(y).find(P).length>0){Q.debug("Element removed from DOM, tearing down events");Q.destroy()}})}})},resize:function(){Q.debug("Window resized");if(o.refreshOnResize){K(Q.refresh)}},load:function(){Q.debug("Page finished loading");K(Q.refresh)},scroll:function(){if(o.throttle){clearTimeout(Q.timer);Q.timer=setTimeout(function(){O.triggerHandler("scrollchange"+M,[O.scrollTop()])},o.throttle)}else{K(function(){O.triggerHandler("scrollchange"+M,[O.scrollTop()])})}},scrollchange:function(w,x){Q.checkVisibility(x)}},precache:function(z,B){if(!(z instanceof Array)){z=[z]}var C=z.length,w=0,y=[],A=f.createElement("img"),x=function(){w++;if(w>=z.length){if(h.isFunction(B)){B()}}};while(C--){A=f.createElement("img");A.onload=x;A.onerror=x;A.src=z[C];y.push(A)}},enableCallbacks:function(){Q.debug("Allowing callbacks to occur");J=false},disableCallbacks:function(){Q.debug("Disabling all callbacks temporarily");J=true},should:{trackChanges:function(){if(v){Q.debug("One time query, no need to bind events");return false}Q.debug("Callbacks being attached");return true}},setup:{cache:function(){Q.cache={occurred:{},screen:{},element:{}}},image:function(){var w=H.data(l.src);if(w){Q.verbose("Lazy loading image",w);o.once=true;o.observeChanges=false;o.onOnScreen=function(){Q.debug("Image on screen",P);Q.precache(w,function(){Q.set.image(w,function(){u++;if(u==t){o.onAllLoaded.call(this)}o.onLoad.call(this)})})}}},fixed:function(){Q.debug("Setting up fixed");o.once=false;o.observeChanges=false;o.initialCheck=true;o.refreshOnLoad=true;if(!a.transition){o.transition=false}Q.create.placeholder();Q.debug("Added placeholder",n);o.onTopPassed=function(){Q.debug("Element passed, adding fixed position",H);Q.show.placeholder();Q.set.fixed();if(o.transition){if(h.fn.transition!==g){H.transition(o.transition,o.duration)}}};o.onTopPassedReverse=function(){Q.debug("Element returned to position, removing fixed",H);Q.hide.placeholder();Q.remove.fixed()}}},create:{placeholder:function(){Q.verbose("Creating fixed position placeholder");n=H.clone(false).css("display","none").addClass(N.placeholder).insertAfter(H)}},show:{placeholder:function(){Q.verbose("Showing placeholder");n.css("display","block").css("visibility","hidden")}},hide:{placeholder:function(){Q.verbose("Hiding placeholder");n.css("display","none").css("visibility","")}},set:{fixed:function(){Q.verbose("Setting element to fixed position");H.addClass(N.fixed).css({position:"fixed",top:o.offset+"px",left:"auto",zIndex:o.zIndex});o.onFixed.call(P)},image:function(x,w){H.attr("src",x);if(o.transition){if(h.fn.transition!==g){if(H.hasClass(N.visible)){Q.debug("Transition already occurred on this image, skipping animation");return}H.transition(o.transition,o.duration,w)}else{H.fadeIn(o.duration,w)}}else{H.show()}}},is:{onScreen:function(){var w=Q.get.elementCalculations();return w.onScreen},offScreen:function(){var w=Q.get.elementCalculations();return w.offScreen},visible:function(){if(Q.cache&&Q.cache.element){return !(Q.cache.element.width===0&&Q.cache.element.offset.top===0)}return false},verticallyScrollableContext:function(){var w=(O.get(0)!==e)?O.css("overflow-y"):false;return(w=="auto"||w=="scroll")},horizontallyScrollableContext:function(){var w=(O.get(0)!==e)?O.css("overflow-x"):false;return(w=="auto"||w=="scroll")}},refresh:function(){Q.debug("Refreshing constants (width/height)");if(o.type=="fixed"){Q.resetFixed()}Q.reset();Q.save.position();if(o.checkOnRefresh){Q.checkVisibility()}o.onRefresh.call(P)},resetFixed:function(){Q.remove.fixed();Q.remove.occurred()},reset:function(){Q.verbose("Resetting all cached values");if(h.isPlainObject(Q.cache)){Q.cache.screen={};Q.cache.element={}}},checkVisibility:function(w){Q.verbose("Checking visibility of element",Q.cache.element);if(!J&&Q.is.visible()){Q.save.scroll(w);Q.save.calculations();Q.passed();Q.passingReverse();Q.topVisibleReverse();Q.bottomVisibleReverse();Q.topPassedReverse();Q.bottomPassedReverse();Q.onScreen();Q.offScreen();Q.passing();Q.topVisible();Q.bottomVisible();Q.topPassed();Q.bottomPassed();if(o.onUpdate){o.onUpdate.call(P,Q.get.elementCalculations())}}},passed:function(x,w){var y=Q.get.elementCalculations();if(x&&w){o.onPassed[x]=w}else{if(x!==g){return(Q.get.pixelsPassed(x)>y.pixelsPassed)}else{if(y.passing){h.each(o.onPassed,function(A,z){if(y.bottomVisible||y.pixelsPassed>Q.get.pixelsPassed(A)){Q.execute(z,A)}else{if(!o.once){Q.remove.occurred(z)}}})}}}},onScreen:function(y){var z=Q.get.elementCalculations(),w=y||o.onOnScreen,x="onScreen";if(y){Q.debug("Adding callback for onScreen",y);o.onOnScreen=y}if(z.onScreen){Q.execute(w,x)}else{if(!o.once){Q.remove.occurred(x)}}if(y!==g){return z.onOnScreen}},offScreen:function(y){var z=Q.get.elementCalculations(),w=y||o.onOffScreen,x="offScreen";if(y){Q.debug("Adding callback for offScreen",y);o.onOffScreen=y}if(z.offScreen){Q.execute(w,x)}else{if(!o.once){Q.remove.occurred(x)}}if(y!==g){return z.onOffScreen}},passing:function(y){var z=Q.get.elementCalculations(),w=y||o.onPassing,x="passing";if(y){Q.debug("Adding callback for passing",y);o.onPassing=y}if(z.passing){Q.execute(w,x)}else{if(!o.once){Q.remove.occurred(x)}}if(y!==g){return z.passing}},topVisible:function(y){var z=Q.get.elementCalculations(),w=y||o.onTopVisible,x="topVisible";if(y){Q.debug("Adding callback for top visible",y);o.onTopVisible=y}if(z.topVisible){Q.execute(w,x)}else{if(!o.once){Q.remove.occurred(x)}}if(y===g){return z.topVisible}},bottomVisible:function(y){var z=Q.get.elementCalculations(),w=y||o.onBottomVisible,x="bottomVisible";if(y){Q.debug("Adding callback for bottom visible",y);o.onBottomVisible=y}if(z.bottomVisible){Q.execute(w,x)}else{if(!o.once){Q.remove.occurred(x)}}if(y===g){return z.bottomVisible}},topPassed:function(y){var z=Q.get.elementCalculations(),w=y||o.onTopPassed,x="topPassed";if(y){Q.debug("Adding callback for top passed",y);o.onTopPassed=y}if(z.topPassed){Q.execute(w,x)}else{if(!o.once){Q.remove.occurred(x)}}if(y===g){return z.topPassed}},bottomPassed:function(y){var z=Q.get.elementCalculations(),w=y||o.onBottomPassed,x="bottomPassed";if(y){Q.debug("Adding callback for bottom passed",y);o.onBottomPassed=y}if(z.bottomPassed){Q.execute(w,x)}else{if(!o.once){Q.remove.occurred(x)}}if(y===g){return z.bottomPassed}},passingReverse:function(y){var z=Q.get.elementCalculations(),w=y||o.onPassingReverse,x="passingReverse";if(y){Q.debug("Adding callback for passing reverse",y);o.onPassingReverse=y}if(!z.passing){if(Q.get.occurred("passing")){Q.execute(w,x)}}else{if(!o.once){Q.remove.occurred(x)}}if(y!==g){return !z.passing}},topVisibleReverse:function(y){var z=Q.get.elementCalculations(),w=y||o.onTopVisibleReverse,x="topVisibleReverse";if(y){Q.debug("Adding callback for top visible reverse",y);o.onTopVisibleReverse=y}if(!z.topVisible){if(Q.get.occurred("topVisible")){Q.execute(w,x)}}else{if(!o.once){Q.remove.occurred(x)}}if(y===g){return !z.topVisible}},bottomVisibleReverse:function(y){var z=Q.get.elementCalculations(),w=y||o.onBottomVisibleReverse,x="bottomVisibleReverse";if(y){Q.debug("Adding callback for bottom visible reverse",y);o.onBottomVisibleReverse=y}if(!z.bottomVisible){if(Q.get.occurred("bottomVisible")){Q.execute(w,x)}}else{if(!o.once){Q.remove.occurred(x)}}if(y===g){return !z.bottomVisible}},topPassedReverse:function(y){var z=Q.get.elementCalculations(),w=y||o.onTopPassedReverse,x="topPassedReverse";if(y){Q.debug("Adding callback for top passed reverse",y);o.onTopPassedReverse=y}if(!z.topPassed){if(Q.get.occurred("topPassed")){Q.execute(w,x)}}else{if(!o.once){Q.remove.occurred(x)}}if(y===g){return !z.onTopPassed}},bottomPassedReverse:function(y){var z=Q.get.elementCalculations(),w=y||o.onBottomPassedReverse,x="bottomPassedReverse";if(y){Q.debug("Adding callback for bottom passed reverse",y);o.onBottomPassedReverse=y}if(!z.bottomPassed){if(Q.get.occurred("bottomPassed")){Q.execute(w,x)}}else{if(!o.once){Q.remove.occurred(x)}}if(y===g){return !z.bottomPassed}},execute:function(w,x){var z=Q.get.elementCalculations(),y=Q.get.screenCalculations();w=w||false;if(w){if(o.continuous){Q.debug("Callback being called continuously",x,z);w.call(P,z,y)}else{if(!Q.get.occurred(x)){Q.debug("Conditions met",x,z);w.call(P,z,y)}}}Q.save.occurred(x)},remove:{fixed:function(){Q.debug("Removing fixed position");H.removeClass(N.fixed).css({position:"",top:"",left:"",zIndex:""});o.onUnfixed.call(P)},placeholder:function(){Q.debug("Removing placeholder content");if(n){n.remove()}},occurred:function(w){if(w){var x=Q.cache.occurred;if(x[w]!==g&&x[w]===true){Q.debug("Callback can now be called again",w);Q.cache.occurred[w]=false}}else{Q.cache.occurred={}}}},save:{calculations:function(){Q.verbose("Saving all calculations necessary to determine positioning");Q.save.direction();Q.save.screenCalculations();Q.save.elementCalculations()},occurred:function(w){if(w){if(Q.cache.occurred[w]===g||(Q.cache.occurred[w]!==true)){Q.verbose("Saving callback occurred",w);Q.cache.occurred[w]=true}}},scroll:function(w){w=w+o.offset||O.scrollTop()+o.offset;Q.cache.scroll=w},direction:function(){var y=Q.get.scroll(),x=Q.get.lastScroll(),w;if(y>x&&x){w="down"}else{if(y<x&&x){w="up"}else{w="static"}}Q.cache.direction=w;return Q.cache.direction},elementPosition:function(){var w=Q.cache.element,x=Q.get.screenSize();Q.verbose("Saving element position");w.fits=(w.height<x.height);w.offset=H.offset();w.width=H.outerWidth();w.height=H.outerHeight();if(Q.is.verticallyScrollableContext()){w.offset.top+=O.scrollTop()-O.offset().top}if(Q.is.horizontallyScrollableContext()){w.offset.left+=O.scrollLeft-O.offset().left}Q.cache.element=w;return w},elementCalculations:function(){var x=Q.get.screenCalculations(),w=Q.get.elementPosition();if(o.includeMargin){w.margin={};w.margin.top=parseInt(H.css("margin-top"),10);w.margin.bottom=parseInt(H.css("margin-bottom"),10);w.top=w.offset.top-w.margin.top;w.bottom=w.offset.top+w.height+w.margin.bottom}else{w.top=w.offset.top;w.bottom=w.offset.top+w.height}w.topPassed=(x.top>=w.top);w.bottomPassed=(x.top>=w.bottom);w.topVisible=(x.bottom>=w.top)&&!w.topPassed;w.bottomVisible=(x.bottom>=w.bottom)&&!w.bottomPassed;w.pixelsPassed=0;w.percentagePassed=0;w.onScreen=((w.topVisible||w.passing)&&!w.bottomPassed);w.passing=(w.topPassed&&!w.bottomPassed);w.offScreen=(!w.onScreen);if(w.passing){w.pixelsPassed=(x.top-w.top);w.percentagePassed=(x.top-w.top)/w.height}Q.cache.element=w;Q.verbose("Updated element calculations",w);return w},screenCalculations:function(){var w=Q.get.scroll();Q.save.direction();Q.cache.screen.top=w;Q.cache.screen.bottom=w+Q.cache.screen.height;return Q.cache.screen},screenSize:function(){Q.verbose("Saving window position");Q.cache.screen={height:O.height()}},position:function(){Q.save.screenSize();Q.save.elementPosition()}},get:{pixelsPassed:function(w){var x=Q.get.elementCalculations();if(w.search("%")>-1){return(x.height*(parseInt(w,10)/100))}return parseInt(w,10)},occurred:function(w){return(Q.cache.occurred!==g)?Q.cache.occurred[w]||false:false},direction:function(){if(Q.cache.direction===g){Q.save.direction()}return Q.cache.direction},elementPosition:function(){if(Q.cache.element===g){Q.save.elementPosition()}return Q.cache.element},elementCalculations:function(){if(Q.cache.element===g){Q.save.elementCalculations()}return Q.cache.element},screenCalculations:function(){if(Q.cache.screen===g){Q.save.screenCalculations()}return Q.cache.screen},screenSize:function(){if(Q.cache.screen===g){Q.save.screenSize()}return Q.cache.screen},scroll:function(){if(Q.cache.scroll===g){Q.save.scroll()}return Q.cache.scroll},lastScroll:function(){if(Q.cache.screen===g){Q.debug("First scroll event, no last scroll could be found");return false}return Q.cache.screen.top}},setting:function(x,w){if(h.isPlainObject(x)){h.extend(true,o,x)}else{if(w!==g){o[x]=w}else{return o[x]}}},internal:function(x,w){if(h.isPlainObject(x)){h.extend(true,Q,x)}else{if(w!==g){Q[x]=w}else{return Q[x]}}},debug:function(){if(!o.silent&&o.debug){if(o.performance){Q.performance.log(arguments)}else{Q.debug=Function.prototype.bind.call(console.info,console,o.name+":");Q.debug.apply(console,arguments)}}},verbose:function(){if(!o.silent&&o.verbose&&o.debug){if(o.performance){Q.performance.log(arguments)}else{Q.verbose=Function.prototype.bind.call(console.info,console,o.name+":");Q.verbose.apply(console,arguments)}}},error:function(){if(!o.silent){Q.error=Function.prototype.bind.call(console.error,console,o.name+":");Q.error.apply(console,arguments)}},performance:{log:function(x){var y,w,z;if(o.performance){y=new Date().getTime();z=s||y;w=y-z;s=y;d.push({Name:x[0],Arguments:[].slice.call(x,1)||"",Element:P,"Execution Time":w})}clearTimeout(Q.performance.timer);Q.performance.timer=setTimeout(Q.performance.display,500)},display:function(){var w=o.name+":",x=0;s=false;clearTimeout(Q.performance.timer);h.each(d,function(z,y){x+=y["Execution Time"]});w+=" "+x+"ms";if(q){w+=" '"+q+"'"}if((console.group!==g||console.table!==g)&&d.length>0){console.groupCollapsed(w);if(console.table){console.table(d)}else{h.each(d,function(z,y){console.log(y.Name+": "+y["Execution Time"]+"ms")})}console.groupEnd()}d=[]}},invoke:function(C,z,x){var y=m,B,w,A;z=z||b;x=P||x;if(typeof C=="string"&&y!==g){C=C.split(/[\. ]/);B=C.length-1;h.each(C,function(D,E){var F=(D!=B)?E+C[D+1].charAt(0).toUpperCase()+C[D+1].slice(1):C;if(h.isPlainObject(y[F])&&(D!=B)){y=y[F]}else{if(y[F]!==g){w=y[F];return false}else{if(h.isPlainObject(y[E])&&(D!=B)){y=y[E]}else{if(y[E]!==g){w=y[E];return false}else{Q.error(L.method,C);return false}}}}})}if(h.isFunction(w)){A=w.apply(x,z)}else{if(w!==g){A=w}}if(Array.isArray(r)){r.push(A)}else{if(r!==g){r=[r,A]}else{if(A!==g){r=A}}}return w}};if(v){if(m===g){Q.initialize()}m.save.scroll();m.save.calculations();Q.invoke(p)}else{if(m!==g){m.invoke("destroy")}Q.initialize()}});return(r!==g)?r:this};h.fn.visibility.settings={name:"Visibility",namespace:"visibility",debug:false,verbose:false,performance:true,observeChanges:true,initialCheck:true,refreshOnLoad:true,refreshOnResize:true,checkOnRefresh:true,once:true,continuous:false,offset:0,includeMargin:false,context:e,throttle:false,type:false,zIndex:"10",transition:"fade in",duration:1000,onPassed:{},onOnScreen:false,onOffScreen:false,onPassing:false,onTopVisible:false,onBottomVisible:false,onTopPassed:false,onBottomPassed:false,onPassingReverse:false,onTopVisibleReverse:false,onBottomVisibleReverse:false,onTopPassedReverse:false,onBottomPassedReverse:false,onLoad:function(){},onAllLoaded:function(){},onFixed:function(){},onUnfixed:function(){},onUpdate:false,onRefresh:function(){},metadata:{src:"src"},className:{fixed:"fixed",placeholder:"constraint",visible:"visible"},error:{method:"The method you called is not defined.",visible:"Element is hidden, you must call refresh after element becomes visible"}}})(jQuery,window,document);