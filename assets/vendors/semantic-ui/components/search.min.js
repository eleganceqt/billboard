/*!
 * # Fomantic-UI - Search
 * http://github.com/fomantic/Fomantic-UI/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;(function(c,b,a,d){c.isFunction=c.isFunction||function(e){return typeof e==="function"&&typeof e.nodeType!=="number"};b=(typeof b!="undefined"&&b.Math==Math)?b:(typeof self!="undefined"&&self.Math==Math)?self:Function("return this")();c.fn.search=function(m){var k=c(this),h=k.selector||"",f=new Date().getTime(),j=[],i=arguments[0],e=(typeof i=="string"),l=[].slice.call(arguments,1),g;c(this).each(function(){var F=(c.isPlainObject(m))?c.extend(true,{},c.fn.search.settings,m):c.extend({},c.fn.search.settings),p=F.className,u=F.metadata,s=F.regExp,z=F.fields,D=F.selector,B=F.error,v=F.namespace,A="."+v,x=v+"-module",r=c(this),C=r.find(D.prompt),E=r.find(D.searchButton),q=r.find(D.results),y=r.find(D.result),w=r.find(D.category),o=this,G=r.data(x),H=false,t=false,n;n={initialize:function(){n.verbose("Initializing module");n.get.settings();n.determine.searchFields();n.bind.events();n.set.type();n.create.results();n.instantiate()},instantiate:function(){n.verbose("Storing instance of module",n);G=n;r.data(x,n)},destroy:function(){n.verbose("Destroying instance");r.off(A).removeData(x)},refresh:function(){n.debug("Refreshing selector cache");C=r.find(D.prompt);E=r.find(D.searchButton);w=r.find(D.category);q=r.find(D.results);y=r.find(D.result)},refreshResults:function(){q=r.find(D.results);y=r.find(D.result)},bind:{events:function(){n.verbose("Binding events to search");if(F.automatic){r.on(n.get.inputEvent()+A,D.prompt,n.event.input);C.attr("autocomplete","off")}r.on("focus"+A,D.prompt,n.event.focus).on("blur"+A,D.prompt,n.event.blur).on("keydown"+A,D.prompt,n.handleKeyboard).on("click"+A,D.searchButton,n.query).on("mousedown"+A,D.results,n.event.result.mousedown).on("mouseup"+A,D.results,n.event.result.mouseup).on("click"+A,D.result,n.event.result.click)}},determine:{searchFields:function(){if(m&&m.searchFields!==d){F.searchFields=m.searchFields}}},event:{input:function(){if(F.searchDelay){clearTimeout(n.timer);n.timer=setTimeout(function(){if(n.is.focused()){n.query()}},F.searchDelay)}else{n.query()}},focus:function(){n.set.focus();if(F.searchOnFocus&&n.has.minimumCharacters()){n.query(function(){if(n.can.show()){n.showResults()}})}},blur:function(I){var J=(a.activeElement===this),K=function(){n.cancel.query();n.remove.focus();n.timer=setTimeout(n.hideResults,F.hideDelay)};if(J){return}t=false;if(n.resultsClicked){n.debug("Determining if user action caused search to close");r.one("click.close"+A,D.results,function(L){if(n.is.inMessage(L)||H){C.focus();return}H=false;if(!n.is.animating()&&!n.is.hidden()){K()}})}else{n.debug("Input blurred without user action, closing results");K()}},result:{mousedown:function(){n.resultsClicked=true},mouseup:function(){n.resultsClicked=false},click:function(I){n.debug("Search result selected");var L=c(this),O=L.find(D.title).eq(0),N=L.is("a[href]")?L:L.find("a[href]").eq(0),J=N.attr("href")||false,M=N.attr("target")||false,P=(O.length>0)?O.text():false,K=n.get.results(),Q=L.data(u.result)||n.get.result(P,K);if(P){n.set.value(P)}if(c.isFunction(F.onSelect)){if(F.onSelect.call(o,Q,K)===false){n.debug("Custom onSelect callback cancelled default select action");H=true;return}}n.hideResults();if(J){n.verbose("Opening search link found in result",N);if(M=="_blank"||I.ctrlKey){b.open(J)}else{b.location.href=(J)}}}}},handleKeyboard:function(I){var L=r.find(D.result),J=r.find(D.category),N=L.filter("."+p.active),M=L.index(N),O=L.length,K=N.length>0,R=I.which,Q={backspace:8,enter:13,escape:27,upArrow:38,downArrow:40},P;if(R==Q.escape){n.verbose("Escape key pressed, blurring search field");n.hideResults();t=true}if(n.is.visible()){if(R==Q.enter){n.verbose("Enter key pressed, selecting active result");if(L.filter("."+p.active).length>0){n.event.result.click.call(L.filter("."+p.active),I);I.preventDefault();return false}}else{if(R==Q.upArrow&&K){n.verbose("Up key pressed, changing active result");P=(M-1<0)?M:M-1;J.removeClass(p.active);L.removeClass(p.active).eq(P).addClass(p.active).closest(J).addClass(p.active);I.preventDefault()}else{if(R==Q.downArrow){n.verbose("Down key pressed, changing active result");P=(M+1>=O)?M:M+1;J.removeClass(p.active);L.removeClass(p.active).eq(P).addClass(p.active).closest(J).addClass(p.active);I.preventDefault()}}}}else{if(R==Q.enter){n.verbose("Enter key pressed, executing query");n.query();n.set.buttonPressed();C.one("keyup",n.remove.buttonFocus)}}},setup:{api:function(I,K){var J={debug:F.debug,on:false,cache:F.cache,action:"search",urlData:{query:I},onSuccess:function(L){n.parse.response.call(o,L,I);K()},onFailure:function(){n.displayMessage(B.serverError);K()},onAbort:function(L){},onError:n.error};c.extend(true,J,F.apiSettings);n.verbose("Setting up API request",J);r.api(J)}},can:{useAPI:function(){return c.fn.api!==d},show:function(){return n.is.focused()&&!n.is.visible()&&!n.is.empty()},transition:function(){return F.transition&&c.fn.transition!==d&&r.transition("is supported")}},is:{animating:function(){return q.hasClass(p.animating)},hidden:function(){return q.hasClass(p.hidden)},inMessage:function(K){if(!K.target){return}var J=c(K.target),I=c.contains(a.documentElement,K.target);return(I&&J.closest(D.message).length>0)},empty:function(){return(q.html()==="")},visible:function(){return(q.filter(":visible").length>0)},focused:function(){return(C.filter(":focus").length>0)}},get:{settings:function(){if(c.isPlainObject(m)&&m.searchFullText){F.fullTextSearch=m.searchFullText;n.error(F.error.oldSearchSyntax,o)}if(F.ignoreDiacritics&&!String.prototype.normalize){F.ignoreDiacritics=false;n.error(B.noNormalize,o)}},inputEvent:function(){var I=C[0],J=(I!==d&&I.oninput!==d)?"input":(I!==d&&I.onpropertychange!==d)?"propertychange":"keyup";return J},value:function(){return C.val()},results:function(){var I=r.data(u.results);return I},result:function(K,J){var I=false;K=(K!==d)?K:n.get.value();J=(J!==d)?J:n.get.results();if(F.type==="category"){n.debug("Finding result that matches",K);c.each(J,function(L,M){if(Array.isArray(M.results)){I=n.search.object(K,M.results)[0];if(I){return false}}})}else{n.debug("Finding result in results object",K);I=n.search.object(K,J)[0]}return I||false}},select:{firstResult:function(){n.verbose("Selecting first result");y.first().addClass(p.active)}},set:{focus:function(){r.addClass(p.focus)},loading:function(){r.addClass(p.loading)},value:function(I){n.verbose("Setting search input value",I);C.val(I)},type:function(I){I=I||F.type;if(F.type=="category"){r.addClass(F.type)}},buttonPressed:function(){E.addClass(p.pressed)}},remove:{loading:function(){r.removeClass(p.loading)},focus:function(){r.removeClass(p.focus)},buttonPressed:function(){E.removeClass(p.pressed)},diacritics:function(I){return F.ignoreDiacritics?I.normalize("NFD").replace(/[\u0300-\u036f]/g,""):I}},query:function(K){K=c.isFunction(K)?K:function(){};var J=n.get.value(),I=n.read.cache(J);K=K||function(){};if(n.has.minimumCharacters()){if(I){n.debug("Reading result from cache",J);n.save.results(I.results);n.addResults(I.html);n.inject.id(I.results);K()}else{n.debug("Querying for",J);if(c.isPlainObject(F.source)||Array.isArray(F.source)){n.search.local(J);K()}else{if(n.can.useAPI()){n.search.remote(J,K)}else{n.error(B.source);K()}}}F.onSearchQuery.call(o,J)}else{n.hideResults()}},search:{local:function(I){var J=n.search.object(I,F.source),K;n.set.loading();n.save.results(J);n.debug("Returned full local search results",J);if(F.maxResults>0){n.debug("Using specified max results",J);J=J.slice(0,F.maxResults)}if(F.type=="category"){J=n.create.categoryResults(J)}K=n.generateResults({results:J});n.remove.loading();n.addResults(K);n.inject.id(J);n.write.cache(I,{html:K,results:J})},remote:function(I,J){J=c.isFunction(J)?J:function(){};if(r.api("is loading")){r.api("abort")}n.setup.api(I,J);r.api("query")},object:function(K,I,M){K=n.remove.diacritics(String(K));var L=[],O=[],P=[],N=K.replace(s.escape,"\\$&"),Q=new RegExp(s.beginsWith+N,"i"),J=function(V,S){var R=(c.inArray(S,L)==-1),U=(c.inArray(S,P)==-1),T=(c.inArray(S,O)==-1);if(R&&U&&T){V.push(S)}};I=I||F.source;M=(M!==d)?M:F.searchFields;if(!Array.isArray(M)){M=[M]}if(I===d||I===false){n.error(B.source);return[]}c.each(M,function(R,S){c.each(I,function(T,U){var V=(typeof U[S]=="string")||(typeof U[S]=="number");if(V){var W;if(typeof U[S]==="string"){W=n.remove.diacritics(U[S])}else{W=U[S].toString()}if(W.search(Q)!==-1){J(L,U)}else{if(F.fullTextSearch==="exact"&&n.exactSearch(K,W)){J(O,U)}else{if(F.fullTextSearch==true&&n.fuzzySearch(K,W)){J(P,U)}}}}})});c.merge(O,P);c.merge(L,O);return L}},exactSearch:function(J,I){J=J.toLowerCase();I=I.toLowerCase();return I.indexOf(J)>-1},fuzzySearch:function(M,K){var O=K.length,J=M.length;if(typeof M!=="string"){return false}M=M.toLowerCase();K=K.toLowerCase();if(J>O){return false}if(J===O){return(M===K)}search:for(var N=0,I=0;N<J;N++){var L=M.charCodeAt(N);while(I<O){if(K.charCodeAt(I++)===L){continue search}}return false}return true},parse:{response:function(J,I){if(Array.isArray(J)){var K={};K[z.results]=J;J=K}var L=n.generateResults(J);n.verbose("Parsing server response",J);if(J!==d){if(I!==d&&J[z.results]!==d){n.addResults(L);n.inject.id(J[z.results]);n.write.cache(I,{html:L,results:J[z.results]});n.save.results(J[z.results])}}}},cancel:{query:function(){if(n.can.useAPI()){r.api("abort")}}},has:{minimumCharacters:function(){var I=n.get.value(),J=I.length;return(J>=F.minCharacters)},results:function(){if(q.length===0){return false}var I=q.html();return I!=""}},clear:{cache:function(J){var I=r.data(u.cache);if(!J){n.debug("Clearing cache",J);r.removeData(u.cache)}else{if(J&&I&&I[J]){n.debug("Removing value from cache",J);delete I[J];r.data(u.cache,I)}}}},read:{cache:function(J){var I=r.data(u.cache);if(F.cache){n.verbose("Checking cache for generated html for query",J);return(typeof I=="object")&&(I[J]!==d)?I[J]:false}return false}},create:{categoryResults:function(I){var J={};c.each(I,function(L,K){if(!K.category){return}if(J[K.category]===d){n.verbose("Creating new category of results",K.category);J[K.category]={name:K.category,results:[K]}}else{J[K.category].results.push(K)}});return J},id:function(I,K){var M=(I+1),J,L;if(K!==d){J=String.fromCharCode(97+K);L=J+M;n.verbose("Creating category result id",L)}else{L=M;n.verbose("Creating result id",L)}return L},results:function(){if(q.length===0){q=c("<div />").addClass(p.results).appendTo(r)}}},inject:{result:function(J,I,L){n.verbose("Injecting result into results");var K=(L!==d)?q.children().eq(L).children(D.results).first().children(D.result).eq(I):q.children(D.result).eq(I);n.verbose("Injecting results metadata",K);K.data(u.result,J)},id:function(J){n.debug("Injecting unique ids into results");var K=0,I=0;if(F.type==="category"){c.each(J,function(L,M){if(M.results.length>0){I=0;c.each(M.results,function(O,N){if(N.id===d){N.id=n.create.id(I,K)}n.inject.result(N,I,K);I++});K++}})}else{c.each(J,function(M,L){if(L.id===d){L.id=n.create.id(I)}n.inject.result(L,I);I++})}return J}},save:{results:function(I){n.verbose("Saving current search results to metadata",I);r.data(u.results,I)}},write:{cache:function(J,K){var I=(r.data(u.cache)!==d)?r.data(u.cache):{};if(F.cache){n.verbose("Writing generated html to cache",J,K);I[J]=K;r.data(u.cache,I)}}},addResults:function(I){if(c.isFunction(F.onResultsAdd)){if(F.onResultsAdd.call(q,I)===false){n.debug("onResultsAdd callback cancelled default action");return false}}if(I){q.html(I);n.refreshResults();if(F.selectFirstResult){n.select.firstResult()}n.showResults()}else{n.hideResults(function(){q.empty()})}},showResults:function(I){I=c.isFunction(I)?I:function(){};if(t){return}if(!n.is.visible()&&n.has.results()){if(n.can.transition()){n.debug("Showing results with css animations");q.transition({animation:F.transition+" in",debug:F.debug,verbose:F.verbose,duration:F.duration,onComplete:function(){I()},queue:true})}else{n.debug("Showing results with javascript");q.stop().fadeIn(F.duration,F.easing)}F.onResultsOpen.call(q)}},hideResults:function(I){I=c.isFunction(I)?I:function(){};if(n.is.visible()){if(n.can.transition()){n.debug("Hiding results with css animations");q.transition({animation:F.transition+" out",debug:F.debug,verbose:F.verbose,duration:F.duration,onComplete:function(){I()},queue:true})}else{n.debug("Hiding results with javascript");q.stop().fadeOut(F.duration,F.easing)}F.onResultsClose.call(q)}},generateResults:function(I){n.debug("Generating html from response",I);var M=F.templates[F.type],L=(c.isPlainObject(I[z.results])&&!c.isEmptyObject(I[z.results])),K=(Array.isArray(I[z.results])&&I[z.results].length>0),J="";if(L||K){if(F.maxResults>0){if(L){if(F.type=="standard"){n.error(B.maxResults)}}else{I[z.results]=I[z.results].slice(0,F.maxResults)}}if(c.isFunction(M)){J=M(I,z,F.preserveHTML)}else{n.error(B.noTemplate,false)}}else{if(F.showNoResults){J=n.displayMessage(B.noResults,"empty",B.noResultsHeader)}}F.onResults.call(o,I);return J},displayMessage:function(J,I,K){I=I||"standard";n.debug("Displaying message",J,I,K);n.addResults(F.templates.message(J,I,K));return F.templates.message(J,I,K)},setting:function(I,J){if(c.isPlainObject(I)){c.extend(true,F,I)}else{if(J!==d){F[I]=J}else{return F[I]}}},internal:function(I,J){if(c.isPlainObject(I)){c.extend(true,n,I)}else{if(J!==d){n[I]=J}else{return n[I]}}},debug:function(){if(!F.silent&&F.debug){if(F.performance){n.performance.log(arguments)}else{n.debug=Function.prototype.bind.call(console.info,console,F.name+":");n.debug.apply(console,arguments)}}},verbose:function(){if(!F.silent&&F.verbose&&F.debug){if(F.performance){n.performance.log(arguments)}else{n.verbose=Function.prototype.bind.call(console.info,console,F.name+":");n.verbose.apply(console,arguments)}}},error:function(){if(!F.silent){n.error=Function.prototype.bind.call(console.error,console,F.name+":");n.error.apply(console,arguments)}},performance:{log:function(K){var J,L,I;if(F.performance){J=new Date().getTime();I=f||J;L=J-I;f=J;j.push({Name:K[0],Arguments:[].slice.call(K,1)||"",Element:o,"Execution Time":L})}clearTimeout(n.performance.timer);n.performance.timer=setTimeout(n.performance.display,500)},display:function(){var J=F.name+":",I=0;f=false;clearTimeout(n.performance.timer);c.each(j,function(K,L){I+=L["Execution Time"]});J+=" "+I+"ms";if(h){J+=" '"+h+"'"}if(k.length>1){J+=" ("+k.length+")"}if((console.group!==d||console.table!==d)&&j.length>0){console.groupCollapsed(J);if(console.table){console.table(j)}else{c.each(j,function(K,L){console.log(L.Name+": "+L["Execution Time"]+"ms")})}console.groupEnd()}j=[]}},invoke:function(N,J,L){var K=G,O,M,I;J=J||l;L=o||L;if(typeof N=="string"&&K!==d){N=N.split(/[\. ]/);O=N.length-1;c.each(N,function(R,Q){var P=(R!=O)?Q+N[R+1].charAt(0).toUpperCase()+N[R+1].slice(1):N;if(c.isPlainObject(K[P])&&(R!=O)){K=K[P]}else{if(K[P]!==d){M=K[P];return false}else{if(c.isPlainObject(K[Q])&&(R!=O)){K=K[Q]}else{if(K[Q]!==d){M=K[Q];return false}else{return false}}}}})}if(c.isFunction(M)){I=M.apply(L,J)}else{if(M!==d){I=M}}if(Array.isArray(g)){g.push(I)}else{if(g!==d){g=[g,I]}else{if(I!==d){g=I}}}return M}};if(e){if(G===d){n.initialize()}n.invoke(i)}else{if(G!==d){G.invoke("destroy")}n.initialize()}});return(g!==d)?g:this};c.fn.search.settings={name:"Search",namespace:"search",silent:false,debug:false,verbose:false,performance:true,type:"standard",minCharacters:1,selectFirstResult:false,apiSettings:false,source:false,searchOnFocus:true,searchFields:["id","title","description"],displayField:"",fullTextSearch:"exact",ignoreDiacritics:false,automatic:true,hideDelay:0,searchDelay:200,maxResults:7,cache:true,showNoResults:true,preserveHTML:true,transition:"scale",duration:200,easing:"easeOutExpo",onSelect:false,onResultsAdd:false,onSearchQuery:function(e){},onResults:function(e){},onResultsOpen:function(){},onResultsClose:function(){},className:{animating:"animating",active:"active",empty:"empty",focus:"focus",hidden:"hidden",loading:"loading",results:"results",pressed:"down"},error:{source:"Cannot search. No source used, and Semantic API module was not included",noResultsHeader:"No Results",noResults:"Your search returned no results",logging:"Error in debug logging, exiting.",noEndpoint:"No search endpoint was specified",noTemplate:"A valid template name was not specified.",oldSearchSyntax:"searchFullText setting has been renamed fullTextSearch for consistency, please adjust your settings.",serverError:"There was an issue querying the server.",maxResults:"Results must be an array to use maxResults setting",method:"The method you called is not defined.",noNormalize:'"ignoreDiacritics" setting will be ignored. Browser does not support String().normalize(). You may consider including <https://cdn.jsdelivr.net/npm/unorm@1.4.1/lib/unorm.min.js> as a polyfill.'},metadata:{cache:"cache",results:"results",result:"result"},regExp:{escape:/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,beginsWith:"(?:s|^)"},fields:{categories:"results",categoryName:"name",categoryResults:"results",description:"description",image:"image",price:"price",results:"results",title:"title",url:"url",action:"action",actionText:"text",actionURL:"url"},selector:{prompt:".prompt",searchButton:".search.button",results:".results",message:".results > .message",category:".category",result:".result",title:".title, .name"},templates:{escape:function(g,f){if(f){return g}var i=/[&<>"'`]/g,j=/[&<>"'`]/,h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},e=function(k){return h[k]};if(j.test(g)){return g.replace(i,e)}return g},message:function(g,f,h){var e="";if(g!==d&&f!==d){e+='<div class="message '+f+'">';if(h){e+='<div class="header">'+h+"</div>"}e+=' <div class="description">'+g+"</div>";e+="</div>"}return e},category:function(g,e,f){var h="",i=c.fn.search.settings.templates.escape;if(g[e.categoryResults]!==d){c.each(g[e.categoryResults],function(j,k){if(k[e.results]!==d&&k.results.length>0){h+='<div class="category">';if(k[e.categoryName]!==d){h+='<div class="name">'+i(k[e.categoryName],f)+"</div>"}h+='<div class="results">';c.each(k.results,function(m,l){if(l[e.url]){h+='<a class="result" href="'+l[e.url].replace(/"/g,"")+'">'}else{h+='<a class="result">'}if(l[e.image]!==d){h+='<div class="image"> <img src="'+l[e.image].replace(/"/g,"")+'"></div>'}h+='<div class="content">';if(l[e.price]!==d){h+='<div class="price">'+i(l[e.price],f)+"</div>"}if(l[e.title]!==d){h+='<div class="title">'+i(l[e.title],f)+"</div>"}if(l[e.description]!==d){h+='<div class="description">'+i(l[e.description],f)+"</div>"}h+="</div>";h+="</a>"});h+="</div>";h+="</div>"}});if(g[e.action]){if(e.actionURL===false){h+='<div class="action">'+i(g[e.action][e.actionText],f)+"</div>"}else{h+='<a href="'+g[e.action][e.actionURL].replace(/"/g,"")+'" class="action">'+i(g[e.action][e.actionText],f)+"</a>"}}return h}return false},standard:function(g,e,f){var h="",i=c.fn.search.settings.templates.escape;if(g[e.results]!==d){c.each(g[e.results],function(k,j){if(j[e.url]){h+='<a class="result" href="'+j[e.url].replace(/"/g,"")+'">'}else{h+='<a class="result">'}if(j[e.image]!==d){h+='<div class="image"> <img src="'+j[e.image].replace(/"/g,"")+'"></div>'}h+='<div class="content">';if(j[e.price]!==d){h+='<div class="price">'+i(j[e.price],f)+"</div>"}if(j[e.title]!==d){h+='<div class="title">'+i(j[e.title],f)+"</div>"}if(j[e.description]!==d){h+='<div class="description">'+i(j[e.description],f)+"</div>"}h+="</div>";h+="</a>"});if(g[e.action]){if(e.actionURL===false){h+='<div class="action">'+i(g[e.action][e.actionText],f)+"</div>"}else{h+='<a href="'+g[e.action][e.actionURL].replace(/"/g,"")+'" class="action">'+i(g[e.action][e.actionText],f)+"</a>"}}return h}return false}}}})(jQuery,window,document);