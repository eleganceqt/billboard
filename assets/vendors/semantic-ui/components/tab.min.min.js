/*!
 * # Fomantic-UI - Tab
 * http://github.com/fomantic/Fomantic-UI/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;(function(h,e,f,g){h.isWindow=h.isWindow||function(a){return a!=null&&a===a.window};h.isFunction=h.isFunction||function(a){return typeof a==="function"&&typeof a.nodeType!=="number"};e=(typeof e!="undefined"&&e.Math==Math)?e:(typeof self!="undefined"&&self.Math==Math)?self:Function("return this")();h.fn.tab=function(a){var c=h.isFunction(this)?h(e):h(this),p=c.selector||"",r=new Date().getTime(),d=[],o=arguments[0],t=(typeof o=="string"),b=[].slice.call(arguments,1),s=false,q;c.each(function(){var J=(h.isPlainObject(a))?h.extend(true,{},h.fn.tab.settings,a):h.extend({},h.fn.tab.settings),N=J.className,k=J.metadata,O=J.selector,P=J.error,K=J.regExp,S="."+J.namespace,j="module-"+J.namespace,M=h(this),T,U,i={},m=true,V=0,Q=this,l=M.data(j),L,I,R,n;R={initialize:function(){R.debug("Initializing tab menu item",M);R.fix.callbacks();R.determineTabs();R.debug("Determining tabs",J.context,U);if(J.auto){R.set.auto()}R.bind.events();if(J.history&&!s){R.initializeHistory();s=true}R.instantiate()},instantiate:function(){R.verbose("Storing instance of module",R);l=R;M.data(j,R)},destroy:function(){R.debug("Destroying tabs",M);M.removeData(j).off(S)},bind:{events:function(){if(!h.isWindow(Q)){R.debug("Attaching tab activation events to element",M);M.on("click"+S,R.event.click)}}},determineTabs:function(){var u;if(J.context==="parent"){if(M.closest(O.ui).length>0){u=M.closest(O.ui);R.verbose("Using closest UI element as parent",u)}else{u=M}T=u.parent();R.verbose("Determined parent element for creating context",T)}else{if(J.context){T=h(J.context);R.verbose("Using selector for tab context",J.context,T)}else{T=h("body")}}if(J.childrenOnly){U=T.children(O.tabs);R.debug("Searching tab context children for tabs",T,U)}else{U=T.find(O.tabs);R.debug("Searching tab context for tabs",T,U)}},fix:{callbacks:function(){if(h.isPlainObject(a)&&(a.onTabLoad||a.onTabInit)){if(a.onTabLoad){a.onLoad=a.onTabLoad;delete a.onTabLoad;R.error(P.legacyLoad,a.onLoad)}if(a.onTabInit){a.onFirstLoad=a.onTabInit;delete a.onTabInit;R.error(P.legacyInit,a.onFirstLoad)}J=h.extend(true,{},h.fn.tab.settings,a)}}},initializeHistory:function(){R.debug("Initializing page state");if(h.address===g){R.error(P.state);return false}else{if(J.historyType=="state"){R.debug("Using HTML5 to manage state");if(J.path!==false){h.address.history(true).state(J.path)}else{R.error(P.path);return false}}h.address.bind("change",R.event.history.change)}},event:{click:function(u){var v=h(this).data(k.tab);if(v!==g){if(J.history){R.verbose("Updating page state",u);h.address.value(v)}else{R.verbose("Changing tab",u);R.changeTab(v)}u.preventDefault()}else{R.debug("No tab specified")}},history:{change:function(u){var w=u.pathNames.join("/")||R.get.initialPath(),v=J.templates.determineTitle(w)||false;R.performance.display();R.debug("History change event",w,u);n=u;if(w!==g){R.changeTab(w)}if(v){h.address.title(v)}}}},refresh:function(){if(L){R.debug("Refreshing tab",L);R.changeTab(L)}},cache:{read:function(u){return(u!==g)?i[u]:false},add:function(u,v){u=u||L;R.debug("Adding cached content for",u);i[u]=v},remove:function(u){u=u||L;R.debug("Removing cached content for",u);delete i[u]}},escape:{string:function(u){u=String(u);return u.replace(K.escape,"\\$&")}},set:{auto:function(){var u=(typeof J.path=="string")?J.path.replace(/\/$/,"")+"/{$tab}":"/{$tab}";R.verbose("Setting up automatic tab retrieval from server",u);if(h.isPlainObject(J.apiSettings)){J.apiSettings.url=u}else{J.apiSettings={url:u}}},loading:function(v){var u=R.get.tabElement(v),w=u.hasClass(N.loading);if(!w){R.verbose("Setting loading state for",u);u.addClass(N.loading).siblings(U).removeClass(N.active+" "+N.loading);if(u.length>0){J.onRequest.call(u[0],v)}}},state:function(u){h.address.value(u)}},changeTab:function(v){var x=(e.history&&e.history.pushState),w=(x&&J.ignoreFirstLoad&&m),u=(J.auto||h.isPlainObject(J.apiSettings)),y=(u&&!w)?R.utilities.pathToArray(v):R.get.defaultPathArray(v);v=R.utilities.arrayToPath(y);h.each(y,function(G,H){var A=y.slice(0,G+1),B=R.utilities.arrayToPath(A),Y=R.is.tab(B),F=(G+1==y.length),C=R.get.tabElement(B),z,D,Z,E;R.verbose("Looking for tab",H);if(Y){R.verbose("Tab was found",H);L=B;I=R.utilities.filterArray(y,A);if(F){E=true}else{D=y.slice(0,G+2);Z=R.utilities.arrayToPath(D);E=(!R.is.tab(Z));if(E){R.verbose("Tab parameters found",D)}}if(E&&u){if(!w){R.activate.navigation(B);R.fetch.content(B,v)}else{R.debug("Ignoring remote content on first tab load",B);m=false;R.cache.add(v,C.html());R.activate.all(B);J.onFirstLoad.call(C[0],B,I,n);J.onLoad.call(C[0],B,I,n)}return false}else{R.debug("Opened local tab",B);R.activate.all(B);if(!R.cache.read(B)){R.cache.add(B,true);R.debug("First time tab loaded calling tab init");J.onFirstLoad.call(C[0],B,I,n)}J.onLoad.call(C[0],B,I,n)}}else{if(v.search("/")==-1&&v!==""){v=R.escape.string(v);z=h("#"+v+', a[name="'+v+'"]');B=z.closest("[data-tab]").data(k.tab);C=R.get.tabElement(B);if(z&&z.length>0&&B){R.debug("Anchor link used, opening parent tab",C,z);if(!C.hasClass(N.active)){setTimeout(function(){R.scrollTo(z)},0)}R.activate.all(B);if(!R.cache.read(B)){R.cache.add(B,true);R.debug("First time tab loaded calling tab init");J.onFirstLoad.call(C[0],B,I,n)}J.onLoad.call(C[0],B,I,n);return false}}else{R.error(P.missingTab,M,T,B);return false}}})},scrollTo:function(v){var u=(v&&v.length>0)?v.offset().top:false;if(u!==false){R.debug("Forcing scroll to an in-page link in a hidden tab",u,v);h(f).scrollTop(u)}},update:{content:function(x,w,u){var y=R.get.tabElement(x),v=y[0];u=(u!==g)?u:J.evaluateScripts;if(typeof J.cacheType=="string"&&J.cacheType.toLowerCase()=="dom"&&typeof w!=="string"){y.empty().append(h(w).clone(true))}else{if(u){R.debug("Updating HTML and evaluating inline scripts",x,w);y.html(w)}else{R.debug("Updating HTML",x,w);v.innerHTML=w}}}},fetch:{content:function(x,y){var B=R.get.tabElement(x),u={dataType:"html",encodeParameters:false,on:"now",cache:J.alwaysRefresh,headers:{"X-Remote":true},onSuccess:function(C){if(J.cacheType=="response"){R.cache.add(y,C)}R.update.content(x,C);if(x==L){R.debug("Content loaded",x);R.activate.tab(x)}else{R.debug("Content loaded in background",x)}J.onFirstLoad.call(B[0],x,I,n);J.onLoad.call(B[0],x,I,n);if(J.loadOnce){R.cache.add(y,true)}else{if(typeof J.cacheType=="string"&&J.cacheType.toLowerCase()=="dom"&&B.children().length>0){setTimeout(function(){var D=B.children().clone(true);D=D.not("script");R.cache.add(y,D)},0)}else{R.cache.add(y,B.html())}}},urlData:{tab:y}},v=B.api("get request")||false,z=(v&&v.state()==="pending"),A,w;y=y||x;w=R.cache.read(y);if(J.cache&&w){R.activate.tab(x);R.debug("Adding cached content",y);if(!J.loadOnce){if(J.evaluateScripts=="once"){R.update.content(x,w,false)}else{R.update.content(x,w)}}J.onLoad.call(B[0],x,I,n)}else{if(z){R.set.loading(x);R.debug("Content is already loading",y)}else{if(h.api!==g){A=h.extend(true,{},J.apiSettings,u);R.debug("Retrieving remote content",y,A);R.set.loading(x);B.api(A)}else{R.error(P.api)}}}}},activate:{all:function(u){R.activate.tab(u);R.activate.navigation(u)},tab:function(x){var v=R.get.tabElement(x),u=(J.deactivate=="siblings")?v.siblings(U):U.not(v),w=v.hasClass(N.active);R.verbose("Showing tab content for",v);if(!w){v.addClass(N.active);u.removeClass(N.active+" "+N.loading);if(v.length>0){J.onVisible.call(v[0],x)}}},navigation:function(x){var u=R.get.navElement(x),v=(J.deactivate=="siblings")?u.siblings(c):c.not(u),w=u.hasClass(N.active);R.verbose("Activating tab navigation for",u,x);if(!w){u.addClass(N.active);v.removeClass(N.active+" "+N.loading)}}},deactivate:{all:function(){R.deactivate.navigation();R.deactivate.tabs()},navigation:function(){c.removeClass(N.active)},tabs:function(){U.removeClass(N.active+" "+N.loading)}},is:{tab:function(u){return(u!==g)?(R.get.tabElement(u).length>0):false}},get:{initialPath:function(){return c.eq(0).data(k.tab)||U.eq(0).data(k.tab)},path:function(){return h.address.value()},defaultPathArray:function(u){return R.utilities.pathToArray(R.get.defaultPath(u))},defaultPath:function(w){var u=c.filter("[data-"+k.tab+'^="'+R.escape.string(w)+'/"]').eq(0),v=u.data(k.tab)||false;if(v){R.debug("Found default tab",v);if(V<J.maxDepth){V++;return R.get.defaultPath(v)}R.error(P.recursion)}else{R.debug("No default tabs found for",w,U)}V=0;return w},navElement:function(u){u=u||L;return c.filter("[data-"+k.tab+'="'+R.escape.string(u)+'"]')},tabElement:function(x){var u,v,y,w;x=x||L;y=R.utilities.pathToArray(x);w=R.utilities.last(y);u=U.filter("[data-"+k.tab+'="'+R.escape.string(x)+'"]');v=U.filter("[data-"+k.tab+'="'+R.escape.string(w)+'"]');return(u.length>0)?u:v},tab:function(){return L}},utilities:{filterArray:function(u,v){return h.grep(u,function(w){return(h.inArray(w,v)==-1)})},last:function(u){return Array.isArray(u)?u[u.length-1]:false},pathToArray:function(u){if(u===g){u=L}return typeof u=="string"?u.split("/"):[u]},arrayToPath:function(u){return Array.isArray(u)?u.join("/"):false}},setting:function(v,u){R.debug("Changing setting",v,u);if(h.isPlainObject(v)){h.extend(true,J,v)}else{if(u!==g){if(h.isPlainObject(J[v])){h.extend(true,J[v],u)}else{J[v]=u}}else{return J[v]}}},internal:function(v,u){if(h.isPlainObject(v)){h.extend(true,R,v)}else{if(u!==g){R[v]=u}else{return R[v]}}},debug:function(){if(!J.silent&&J.debug){if(J.performance){R.performance.log(arguments)}else{R.debug=Function.prototype.bind.call(console.info,console,J.name+":");R.debug.apply(console,arguments)}}},verbose:function(){if(!J.silent&&J.verbose&&J.debug){if(J.performance){R.performance.log(arguments)}else{R.verbose=Function.prototype.bind.call(console.info,console,J.name+":");R.verbose.apply(console,arguments)}}},error:function(){if(!J.silent){R.error=Function.prototype.bind.call(console.error,console,J.name+":");R.error.apply(console,arguments)}},performance:{log:function(v){var w,u,x;if(J.performance){w=new Date().getTime();x=r||w;u=w-x;r=w;d.push({Name:v[0],Arguments:[].slice.call(v,1)||"",Element:Q,"Execution Time":u})}clearTimeout(R.performance.timer);R.performance.timer=setTimeout(R.performance.display,500)},display:function(){var u=J.name+":",v=0;r=false;clearTimeout(R.performance.timer);h.each(d,function(x,w){v+=w["Execution Time"]});u+=" "+v+"ms";if(p){u+=" '"+p+"'"}if((console.group!==g||console.table!==g)&&d.length>0){console.groupCollapsed(u);if(console.table){console.table(d)}else{h.each(d,function(x,w){console.log(w.Name+": "+w["Execution Time"]+"ms")})}console.groupEnd()}d=[]}},invoke:function(z,w,u){var v=l,y,A,x;w=w||b;u=Q||u;if(typeof z=="string"&&v!==g){z=z.split(/[\. ]/);y=z.length-1;h.each(z,function(B,C){var D=(B!=y)?C+z[B+1].charAt(0).toUpperCase()+z[B+1].slice(1):z;if(h.isPlainObject(v[D])&&(B!=y)){v=v[D]}else{if(v[D]!==g){A=v[D];return false}else{if(h.isPlainObject(v[C])&&(B!=y)){v=v[C]}else{if(v[C]!==g){A=v[C];return false}else{R.error(P.method,z);return false}}}}})}if(h.isFunction(A)){x=A.apply(u,w)}else{if(A!==g){x=A}}if(Array.isArray(q)){q.push(x)}else{if(q!==g){q=[q,x]}else{if(x!==g){q=x}}}return A}};if(t){if(l===g){R.initialize()}R.invoke(o)}else{if(l!==g){l.invoke("destroy")}R.initialize()}});return(q!==g)?q:this};h.tab=function(){h(e).tab.apply(this,arguments)};h.fn.tab.settings={name:"Tab",namespace:"tab",silent:false,debug:false,verbose:false,performance:true,auto:false,history:false,historyType:"hash",path:false,context:false,childrenOnly:false,maxDepth:25,deactivate:"siblings",alwaysRefresh:false,cache:true,loadOnce:false,cacheType:"response",ignoreFirstLoad:false,apiSettings:false,evaluateScripts:"once",onFirstLoad:function(c,b,a){},onLoad:function(c,b,a){},onVisible:function(c,b,a){},onRequest:function(c,b,a){},templates:{determineTitle:function(a){}},error:{api:"You attempted to load content without API module",method:"The method you called is not defined",missingTab:"Activated tab cannot be found. Tabs are case-sensitive.",noContent:"The tab you specified is missing a content url.",path:"History enabled, but no path was specified",recursion:"Max recursive depth reached",legacyInit:"onTabInit has been renamed to onFirstLoad in 2.0, please adjust your code.",legacyLoad:"onTabLoad has been renamed to onLoad in 2.0. Please adjust your code",state:"History requires Asual's Address library <https://github.com/asual/jquery-address>"},regExp:{escape:/[-[\]{}()*+?.,\\^$|#\s:=@]/g},metadata:{tab:"tab",loaded:"loaded",promise:"promise"},className:{loading:"loading",active:"active"},selector:{tabs:".ui.tab",ui:".ui"}}})(jQuery,window,document);