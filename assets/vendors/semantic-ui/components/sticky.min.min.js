/*!
 * # Fomantic-UI - Sticky
 * http://github.com/fomantic/Fomantic-UI/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;(function(h,e,f,g){h.isFunction=h.isFunction||function(a){return typeof a==="function"&&typeof a.nodeType!=="number"};e=(typeof e!="undefined"&&e.Math==Math)?e:(typeof self!="undefined"&&self.Math==Math)?self:Function("return this")();h.fn.sticky=function(a){var c=h(this),o=c.selector||"",q=new Date().getTime(),d=[],n=arguments[0],r=(typeof n=="string"),b=[].slice.call(arguments,1),p;c.each(function(){var E=(h.isPlainObject(a))?h.extend(true,{},h.fn.sticky.settings,a):h.extend({},h.fn.sticky.settings),J=E.className,l=E.namespace,I=E.error,j="."+l,N="module-"+l,G=h(this),F=h(e),i=h(E.scrollContext),k,M,m=G.data(N),K=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame||function(s){setTimeout(s,0)},O=this,P,L,H;H={initialize:function(){H.determineContainer();H.determineContext();H.verbose("Initializing sticky",E,k);H.save.positions();H.checkErrors();H.bind.events();if(E.observeChanges){H.observeChanges()}H.instantiate()},instantiate:function(){H.verbose("Storing instance of module",H);m=H;G.data(N,H)},destroy:function(){H.verbose("Destroying previous instance");H.reset();if(P){P.disconnect()}if(L){L.disconnect()}F.off("load"+j,H.event.load).off("resize"+j,H.event.resize);i.off("scrollchange"+j,H.event.scrollchange);G.removeData(N)},observeChanges:function(){if("MutationObserver" in e){P=new MutationObserver(H.event.documentChanged);L=new MutationObserver(H.event.changed);P.observe(f,{childList:true,subtree:true});L.observe(O,{childList:true,subtree:true});L.observe(M[0],{childList:true,subtree:true});H.debug("Setting up mutation observer",L)}},determineContainer:function(){if(E.container){k=h(E.container)}else{k=G.offsetParent()}},determineContext:function(){if(E.context){M=h(E.context)}else{M=k}if(M.length===0){H.error(I.invalidContext,E.context,G);return}},checkErrors:function(){if(H.is.hidden()){H.error(I.visible,G)}if(H.cache.element.height>H.cache.context.height){H.reset();H.error(I.elementSize,G);return}},bind:{events:function(){F.on("load"+j,H.event.load).on("resize"+j,H.event.resize);i.off("scroll"+j).on("scroll"+j,H.event.scroll).on("scrollchange"+j,H.event.scrollchange)}},event:{changed:function(s){clearTimeout(H.timer);H.timer=setTimeout(function(){H.verbose("DOM tree modified, updating sticky menu",s);H.refresh()},100)},documentChanged:function(s){[].forEach.call(s,function(t){if(t.removedNodes){[].forEach.call(t.removedNodes,function(u){if(u==O||h(u).find(O).length>0){H.debug("Element removed from DOM, tearing down events");H.destroy()}})}})},load:function(){H.verbose("Page contents finished loading");K(H.refresh)},resize:function(){H.verbose("Window resized");K(H.refresh)},scroll:function(){K(function(){i.triggerHandler("scrollchange"+j,i.scrollTop())})},scrollchange:function(s,t){H.stick(t);E.onScroll.call(O)}},refresh:function(s){H.reset();if(!E.context){H.determineContext()}if(s){H.determineContainer()}H.save.positions();H.stick();E.onReposition.call(O)},supports:{sticky:function(){var s=h("<div/>");s.addClass(J.supported);return(s.css("position").match("sticky"))}},save:{lastScroll:function(s){H.lastScroll=s},elementScroll:function(s){H.elementScroll=s},positions:function(){var s={height:i.height()},t={margin:{top:parseInt(G.css("margin-top"),10),bottom:parseInt(G.css("margin-bottom"),10)},offset:G.offset(),width:G.outerWidth(),height:G.outerHeight()},u={offset:M.offset(),height:M.outerHeight()};if(!H.is.standardScroll()){H.debug("Non-standard scroll. Removing scroll offset from element offset");s.top=i.scrollTop();s.left=i.scrollLeft();t.offset.top+=s.top;u.offset.top+=s.top;t.offset.left+=s.left;u.offset.left+=s.left}H.cache={fits:((t.height+E.offset)<=s.height),sameHeight:(t.height==u.height),scrollContext:{height:s.height},element:{margin:t.margin,top:t.offset.top-t.margin.top,left:t.offset.left,width:t.width,height:t.height,bottom:t.offset.top+t.height},context:{top:u.offset.top,height:u.height,bottom:u.offset.top+u.height}};H.set.containerSize();H.stick();H.debug("Caching element positions",H.cache)}},get:{direction:function(t){var s="down";t=t||i.scrollTop();if(H.lastScroll!==g){if(H.lastScroll<t){s="down"}else{if(H.lastScroll>t){s="up"}}}return s},scrollChange:function(s){s=s||i.scrollTop();return(H.lastScroll)?(s-H.lastScroll):0},currentElementScroll:function(){if(H.elementScroll){return H.elementScroll}return(H.is.top())?Math.abs(parseInt(G.css("top"),10))||0:Math.abs(parseInt(G.css("bottom"),10))||0},elementScroll:function(y){y=y||i.scrollTop();var x=H.cache.element,t=H.cache.scrollContext,s=H.get.scrollChange(y),v=(x.height-t.height+E.offset),w=H.get.currentElementScroll(),u=(w+s);if(H.cache.fits||u<0){w=0}else{if(u>v){w=v}else{w=u}}return w}},remove:{lastScroll:function(){delete H.lastScroll},elementScroll:function(s){delete H.elementScroll},minimumSize:function(){k.css("min-height","")},offset:function(){G.css("margin-top","")}},set:{offset:function(){H.verbose("Setting offset on element",E.offset);G.css("margin-top",E.offset)},containerSize:function(){var s=k.get(0).tagName;if(s==="HTML"||s=="body"){H.determineContainer()}else{if(Math.abs(k.outerHeight()-H.cache.context.height)>E.jitter){H.debug("Context has padding, specifying exact height for container",H.cache.context.height);k.css({height:H.cache.context.height})}}},minimumSize:function(){var s=H.cache.element;k.css("min-height",s.height)},scroll:function(s){H.debug("Setting scroll on element",s);if(H.elementScroll==s){return}if(H.is.top()){G.css("bottom","").css("top",-s)}if(H.is.bottom()){G.css("top","").css("bottom",s)}},size:function(){if(H.cache.element.height!==0&&H.cache.element.width!==0){O.style.setProperty("width",H.cache.element.width+"px","important");O.style.setProperty("height",H.cache.element.height+"px","important")}}},is:{standardScroll:function(){return(i[0]==e)},top:function(){return G.hasClass(J.top)},bottom:function(){return G.hasClass(J.bottom)},initialPosition:function(){return(!H.is.fixed()&&!H.is.bound())},hidden:function(){return(!G.is(":visible"))},bound:function(){return G.hasClass(J.bound)},fixed:function(){return G.hasClass(J.fixed)}},stick:function(t){var u=t||i.scrollTop(),D=H.cache,s=D.fits,v=D.sameHeight,y=D.element,A=D.scrollContext,C=D.context,z=(H.is.bottom()&&E.pushing)?E.bottomOffset:E.offset,t={top:u+z,bottom:u+z+A.height},x=(s)?0:H.get.elementScroll(t.top),B=!s,w=(y.height!==0);if(w&&!v){if(H.is.initialPosition()){if(t.top>=C.bottom){H.debug("Initial element position is bottom of container");H.bindBottom()}else{if(t.top>y.top){if((y.height+t.top-x)>=C.bottom){H.debug("Initial element position is bottom of container");H.bindBottom()}else{H.debug("Initial element position is fixed");H.fixTop()}}}}else{if(H.is.fixed()){if(H.is.top()){if(t.top<=y.top){H.debug("Fixed element reached top of container");H.setInitialPosition()}else{if((y.height+t.top-x)>=C.bottom){H.debug("Fixed element reached bottom of container");H.bindBottom()}else{if(B){H.set.scroll(x);H.save.lastScroll(t.top);H.save.elementScroll(x)}}}}else{if(H.is.bottom()){if((t.bottom-y.height)<=y.top){H.debug("Bottom fixed rail has reached top of container");H.setInitialPosition()}else{if(t.bottom>=C.bottom){H.debug("Bottom fixed rail has reached bottom of container");H.bindBottom()}else{if(B){H.set.scroll(x);H.save.lastScroll(t.top);H.save.elementScroll(x)}}}}}}else{if(H.is.bottom()){if(t.top<=y.top){H.debug("Jumped from bottom fixed to top fixed, most likely used home/end button");H.setInitialPosition()}else{if(E.pushing){if(H.is.bound()&&t.bottom<=C.bottom){H.debug("Fixing bottom attached element to bottom of browser.");H.fixBottom()}}else{if(H.is.bound()&&(t.top<=C.bottom-y.height)){H.debug("Fixing bottom attached element to top of browser.");H.fixTop()}}}}}}}},bindTop:function(){H.debug("Binding element to top of parent container");H.remove.offset();G.css({left:"",top:"",marginBottom:""}).removeClass(J.fixed).removeClass(J.bottom).addClass(J.bound).addClass(J.top);E.onTop.call(O);E.onUnstick.call(O)},bindBottom:function(){H.debug("Binding element to bottom of parent container");H.remove.offset();G.css({left:"",top:""}).removeClass(J.fixed).removeClass(J.top).addClass(J.bound).addClass(J.bottom);E.onBottom.call(O);E.onUnstick.call(O)},setInitialPosition:function(){H.debug("Returning to initial position");H.unfix();H.unbind()},fixTop:function(){H.debug("Fixing element to top of page");if(E.setSize){H.set.size()}H.set.minimumSize();H.set.offset();G.css({left:H.cache.element.left,bottom:"",marginBottom:""}).removeClass(J.bound).removeClass(J.bottom).addClass(J.fixed).addClass(J.top);E.onStick.call(O)},fixBottom:function(){H.debug("Sticking element to bottom of page");if(E.setSize){H.set.size()}H.set.minimumSize();H.set.offset();G.css({left:H.cache.element.left,bottom:"",marginBottom:""}).removeClass(J.bound).removeClass(J.top).addClass(J.fixed).addClass(J.bottom);E.onStick.call(O)},unbind:function(){if(H.is.bound()){H.debug("Removing container bound position on element");H.remove.offset();G.removeClass(J.bound).removeClass(J.top).removeClass(J.bottom)}},unfix:function(){if(H.is.fixed()){H.debug("Removing fixed position on element");H.remove.minimumSize();H.remove.offset();G.removeClass(J.fixed).removeClass(J.top).removeClass(J.bottom);E.onUnstick.call(O)}},reset:function(){H.debug("Resetting elements position");H.unbind();H.unfix();H.resetCSS();H.remove.offset();H.remove.lastScroll()},resetCSS:function(){G.css({width:"",height:""});k.css({height:""})},setting:function(t,s){if(h.isPlainObject(t)){h.extend(true,E,t)}else{if(s!==g){E[t]=s}else{return E[t]}}},internal:function(t,s){if(h.isPlainObject(t)){h.extend(true,H,t)}else{if(s!==g){H[t]=s}else{return H[t]}}},debug:function(){if(!E.silent&&E.debug){if(E.performance){H.performance.log(arguments)}else{H.debug=Function.prototype.bind.call(console.info,console,E.name+":");H.debug.apply(console,arguments)}}},verbose:function(){if(!E.silent&&E.verbose&&E.debug){if(E.performance){H.performance.log(arguments)}else{H.verbose=Function.prototype.bind.call(console.info,console,E.name+":");H.verbose.apply(console,arguments)}}},error:function(){if(!E.silent){H.error=Function.prototype.bind.call(console.error,console,E.name+":");H.error.apply(console,arguments)}},performance:{log:function(t){var u,s,v;if(E.performance){u=new Date().getTime();v=q||u;s=u-v;q=u;d.push({Name:t[0],Arguments:[].slice.call(t,1)||"",Element:O,"Execution Time":s})}clearTimeout(H.performance.timer);H.performance.timer=setTimeout(H.performance.display,0)},display:function(){var s=E.name+":",t=0;q=false;clearTimeout(H.performance.timer);h.each(d,function(v,u){t+=u["Execution Time"]});s+=" "+t+"ms";if(o){s+=" '"+o+"'"}if((console.group!==g||console.table!==g)&&d.length>0){console.groupCollapsed(s);if(console.table){console.table(d)}else{h.each(d,function(v,u){console.log(u.Name+": "+u["Execution Time"]+"ms")})}console.groupEnd()}d=[]}},invoke:function(t,x,v){var w=m,s,u,y;x=x||b;v=O||v;if(typeof t=="string"&&w!==g){t=t.split(/[\. ]/);s=t.length-1;h.each(t,function(A,B){var z=(A!=s)?B+t[A+1].charAt(0).toUpperCase()+t[A+1].slice(1):t;if(h.isPlainObject(w[z])&&(A!=s)){w=w[z]}else{if(w[z]!==g){u=w[z];return false}else{if(h.isPlainObject(w[B])&&(A!=s)){w=w[B]}else{if(w[B]!==g){u=w[B];return false}else{return false}}}}})}if(h.isFunction(u)){y=u.apply(v,x)}else{if(u!==g){y=u}}if(Array.isArray(p)){p.push(y)}else{if(p!==g){p=[p,y]}else{if(y!==g){p=y}}}return u}};if(r){if(m===g){H.initialize()}H.invoke(n)}else{if(m!==g){m.invoke("destroy")}H.initialize()}});return(p!==g)?p:this};h.fn.sticky.settings={name:"Sticky",namespace:"sticky",silent:false,debug:false,verbose:true,performance:true,pushing:false,context:false,container:false,scrollContext:e,offset:0,bottomOffset:0,jitter:5,setSize:true,observeChanges:false,onReposition:function(){},onScroll:function(){},onStick:function(){},onUnstick:function(){},onTop:function(){},onBottom:function(){},error:{container:"Sticky element must be inside a relative container",visible:"Element is hidden, you must call refresh after element becomes visible. Use silent setting to surpress this warning in production.",method:"The method you called is not defined.",invalidContext:"Context specified does not exist",elementSize:"Sticky element is larger than its container, cannot create sticky."},className:{bound:"bound",fixed:"fixed",supported:"native",top:"top",bottom:"bottom"}}})(jQuery,window,document);