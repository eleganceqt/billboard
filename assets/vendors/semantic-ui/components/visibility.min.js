/*!
 * # Fomantic-UI - Visibility
 * http://github.com/fomantic/Fomantic-UI/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;(function(c,b,a,d){c.isFunction=c.isFunction||function(e){return typeof e==="function"&&typeof e.nodeType!=="number"};b=(typeof b!="undefined"&&b.Math==Math)?b:(typeof self!="undefined"&&self.Math==Math)?self:Function("return this")();c.fn.visibility=function(o){var m=c(this),j=m.selector||"",h=new Date().getTime(),l=[],k=arguments[0],e=(typeof k=="string"),n=[].slice.call(arguments,1),i,g=m.length,f=0;m.each(function(){var F=(c.isPlainObject(o))?c.extend(true,{},c.fn.visibility.settings,o):c.extend({},c.fn.visibility.settings),r=F.className,x=F.namespace,D=F.error,w=F.metadata,C="."+x,z="module-"+x,A=c(b),u=c(this),B=c(F.context),v,G=u.data(z),s=b.requestAnimationFrame||b.mozRequestAnimationFrame||b.webkitRequestAnimationFrame||b.msRequestAnimationFrame||function(H){setTimeout(H,0)},q=this,t=false,y,E,p;p={initialize:function(){p.debug("Initializing",F);p.setup.cache();if(p.should.trackChanges()){if(F.type=="image"){p.setup.image()}if(F.type=="fixed"){p.setup.fixed()}if(F.observeChanges){p.observeChanges()}p.bind.events()}p.save.position();if(!p.is.visible()){p.error(D.visible,u)}if(F.initialCheck){p.checkVisibility()}p.instantiate()},instantiate:function(){p.debug("Storing instance",p);u.data(z,p);G=p},destroy:function(){p.verbose("Destroying previous module");if(E){E.disconnect()}if(y){y.disconnect()}A.off("load"+C,p.event.load).off("resize"+C,p.event.resize);B.off("scroll"+C,p.event.scroll).off("scrollchange"+C,p.event.scrollchange);if(F.type=="fixed"){p.resetFixed();p.remove.placeholder()}u.off(C).removeData(z)},observeChanges:function(){if("MutationObserver" in b){y=new MutationObserver(p.event.contextChanged);E=new MutationObserver(p.event.changed);y.observe(a,{childList:true,subtree:true});E.observe(q,{childList:true,subtree:true});p.debug("Setting up mutation observer",E)}},bind:{events:function(){p.verbose("Binding visibility events to scroll and resize");if(F.refreshOnLoad){A.on("load"+C,p.event.load)}A.on("resize"+C,p.event.resize);B.off("scroll"+C).on("scroll"+C,p.event.scroll).on("scrollchange"+C,p.event.scrollchange)}},event:{changed:function(H){p.verbose("DOM tree modified, updating visibility calculations");p.timer=setTimeout(function(){p.verbose("DOM tree modified, updating sticky menu");p.refresh()},100)},contextChanged:function(H){[].forEach.call(H,function(I){if(I.removedNodes){[].forEach.call(I.removedNodes,function(J){if(J==q||c(J).find(q).length>0){p.debug("Element removed from DOM, tearing down events");p.destroy()}})}})},resize:function(){p.debug("Window resized");if(F.refreshOnResize){s(p.refresh)}},load:function(){p.debug("Page finished loading");s(p.refresh)},scroll:function(){if(F.throttle){clearTimeout(p.timer);p.timer=setTimeout(function(){B.triggerHandler("scrollchange"+C,[B.scrollTop()])},F.throttle)}else{s(function(){B.triggerHandler("scrollchange"+C,[B.scrollTop()])})}},scrollchange:function(I,H){p.checkVisibility(H)}},precache:function(I,N){if(!(I instanceof Array)){I=[I]}var M=I.length,L=0,J=[],H=a.createElement("img"),K=function(){L++;if(L>=I.length){if(c.isFunction(N)){N()}}};while(M--){H=a.createElement("img");H.onload=K;H.onerror=K;H.src=I[M];J.push(H)}},enableCallbacks:function(){p.debug("Allowing callbacks to occur");t=false},disableCallbacks:function(){p.debug("Disabling all callbacks temporarily");t=true},should:{trackChanges:function(){if(e){p.debug("One time query, no need to bind events");return false}p.debug("Callbacks being attached");return true}},setup:{cache:function(){p.cache={occurred:{},screen:{},element:{}}},image:function(){var H=u.data(w.src);if(H){p.verbose("Lazy loading image",H);F.once=true;F.observeChanges=false;F.onOnScreen=function(){p.debug("Image on screen",q);p.precache(H,function(){p.set.image(H,function(){f++;if(f==g){F.onAllLoaded.call(this)}F.onLoad.call(this)})})}}},fixed:function(){p.debug("Setting up fixed");F.once=false;F.observeChanges=false;F.initialCheck=true;F.refreshOnLoad=true;if(!o.transition){F.transition=false}p.create.placeholder();p.debug("Added placeholder",v);F.onTopPassed=function(){p.debug("Element passed, adding fixed position",u);p.show.placeholder();p.set.fixed();if(F.transition){if(c.fn.transition!==d){u.transition(F.transition,F.duration)}}};F.onTopPassedReverse=function(){p.debug("Element returned to position, removing fixed",u);p.hide.placeholder();p.remove.fixed()}}},create:{placeholder:function(){p.verbose("Creating fixed position placeholder");v=u.clone(false).css("display","none").addClass(r.placeholder).insertAfter(u)}},show:{placeholder:function(){p.verbose("Showing placeholder");v.css("display","block").css("visibility","hidden")}},hide:{placeholder:function(){p.verbose("Hiding placeholder");v.css("display","none").css("visibility","")}},set:{fixed:function(){p.verbose("Setting element to fixed position");u.addClass(r.fixed).css({position:"fixed",top:F.offset+"px",left:"auto",zIndex:F.zIndex});F.onFixed.call(q)},image:function(H,I){u.attr("src",H);if(F.transition){if(c.fn.transition!==d){if(u.hasClass(r.visible)){p.debug("Transition already occurred on this image, skipping animation");return}u.transition(F.transition,F.duration,I)}else{u.fadeIn(F.duration,I)}}else{u.show()}}},is:{onScreen:function(){var H=p.get.elementCalculations();return H.onScreen},offScreen:function(){var H=p.get.elementCalculations();return H.offScreen},visible:function(){if(p.cache&&p.cache.element){return !(p.cache.element.width===0&&p.cache.element.offset.top===0)}return false},verticallyScrollableContext:function(){var H=(B.get(0)!==b)?B.css("overflow-y"):false;return(H=="auto"||H=="scroll")},horizontallyScrollableContext:function(){var H=(B.get(0)!==b)?B.css("overflow-x"):false;return(H=="auto"||H=="scroll")}},refresh:function(){p.debug("Refreshing constants (width/height)");if(F.type=="fixed"){p.resetFixed()}p.reset();p.save.position();if(F.checkOnRefresh){p.checkVisibility()}F.onRefresh.call(q)},resetFixed:function(){p.remove.fixed();p.remove.occurred()},reset:function(){p.verbose("Resetting all cached values");if(c.isPlainObject(p.cache)){p.cache.screen={};p.cache.element={}}},checkVisibility:function(H){p.verbose("Checking visibility of element",p.cache.element);if(!t&&p.is.visible()){p.save.scroll(H);p.save.calculations();p.passed();p.passingReverse();p.topVisibleReverse();p.bottomVisibleReverse();p.topPassedReverse();p.bottomPassedReverse();p.onScreen();p.offScreen();p.passing();p.topVisible();p.bottomVisible();p.topPassed();p.bottomPassed();if(F.onUpdate){F.onUpdate.call(q,p.get.elementCalculations())}}},passed:function(I,J){var H=p.get.elementCalculations();if(I&&J){F.onPassed[I]=J}else{if(I!==d){return(p.get.pixelsPassed(I)>H.pixelsPassed)}else{if(H.passing){c.each(F.onPassed,function(K,L){if(H.bottomVisible||H.pixelsPassed>p.get.pixelsPassed(K)){p.execute(L,K)}else{if(!F.once){p.remove.occurred(L)}}})}}}},onScreen:function(I){var H=p.get.elementCalculations(),K=I||F.onOnScreen,J="onScreen";if(I){p.debug("Adding callback for onScreen",I);F.onOnScreen=I}if(H.onScreen){p.execute(K,J)}else{if(!F.once){p.remove.occurred(J)}}if(I!==d){return H.onOnScreen}},offScreen:function(I){var H=p.get.elementCalculations(),K=I||F.onOffScreen,J="offScreen";if(I){p.debug("Adding callback for offScreen",I);F.onOffScreen=I}if(H.offScreen){p.execute(K,J)}else{if(!F.once){p.remove.occurred(J)}}if(I!==d){return H.onOffScreen}},passing:function(I){var H=p.get.elementCalculations(),K=I||F.onPassing,J="passing";if(I){p.debug("Adding callback for passing",I);F.onPassing=I}if(H.passing){p.execute(K,J)}else{if(!F.once){p.remove.occurred(J)}}if(I!==d){return H.passing}},topVisible:function(I){var H=p.get.elementCalculations(),K=I||F.onTopVisible,J="topVisible";if(I){p.debug("Adding callback for top visible",I);F.onTopVisible=I}if(H.topVisible){p.execute(K,J)}else{if(!F.once){p.remove.occurred(J)}}if(I===d){return H.topVisible}},bottomVisible:function(I){var H=p.get.elementCalculations(),K=I||F.onBottomVisible,J="bottomVisible";if(I){p.debug("Adding callback for bottom visible",I);F.onBottomVisible=I}if(H.bottomVisible){p.execute(K,J)}else{if(!F.once){p.remove.occurred(J)}}if(I===d){return H.bottomVisible}},topPassed:function(I){var H=p.get.elementCalculations(),K=I||F.onTopPassed,J="topPassed";if(I){p.debug("Adding callback for top passed",I);F.onTopPassed=I}if(H.topPassed){p.execute(K,J)}else{if(!F.once){p.remove.occurred(J)}}if(I===d){return H.topPassed}},bottomPassed:function(I){var H=p.get.elementCalculations(),K=I||F.onBottomPassed,J="bottomPassed";if(I){p.debug("Adding callback for bottom passed",I);F.onBottomPassed=I}if(H.bottomPassed){p.execute(K,J)}else{if(!F.once){p.remove.occurred(J)}}if(I===d){return H.bottomPassed}},passingReverse:function(I){var H=p.get.elementCalculations(),K=I||F.onPassingReverse,J="passingReverse";if(I){p.debug("Adding callback for passing reverse",I);F.onPassingReverse=I}if(!H.passing){if(p.get.occurred("passing")){p.execute(K,J)}}else{if(!F.once){p.remove.occurred(J)}}if(I!==d){return !H.passing}},topVisibleReverse:function(I){var H=p.get.elementCalculations(),K=I||F.onTopVisibleReverse,J="topVisibleReverse";if(I){p.debug("Adding callback for top visible reverse",I);F.onTopVisibleReverse=I}if(!H.topVisible){if(p.get.occurred("topVisible")){p.execute(K,J)}}else{if(!F.once){p.remove.occurred(J)}}if(I===d){return !H.topVisible}},bottomVisibleReverse:function(I){var H=p.get.elementCalculations(),K=I||F.onBottomVisibleReverse,J="bottomVisibleReverse";if(I){p.debug("Adding callback for bottom visible reverse",I);F.onBottomVisibleReverse=I}if(!H.bottomVisible){if(p.get.occurred("bottomVisible")){p.execute(K,J)}}else{if(!F.once){p.remove.occurred(J)}}if(I===d){return !H.bottomVisible}},topPassedReverse:function(I){var H=p.get.elementCalculations(),K=I||F.onTopPassedReverse,J="topPassedReverse";if(I){p.debug("Adding callback for top passed reverse",I);F.onTopPassedReverse=I}if(!H.topPassed){if(p.get.occurred("topPassed")){p.execute(K,J)}}else{if(!F.once){p.remove.occurred(J)}}if(I===d){return !H.onTopPassed}},bottomPassedReverse:function(I){var H=p.get.elementCalculations(),K=I||F.onBottomPassedReverse,J="bottomPassedReverse";if(I){p.debug("Adding callback for bottom passed reverse",I);F.onBottomPassedReverse=I}if(!H.bottomPassed){if(p.get.occurred("bottomPassed")){p.execute(K,J)}}else{if(!F.once){p.remove.occurred(J)}}if(I===d){return !H.bottomPassed}},execute:function(K,J){var H=p.get.elementCalculations(),I=p.get.screenCalculations();K=K||false;if(K){if(F.continuous){p.debug("Callback being called continuously",J,H);K.call(q,H,I)}else{if(!p.get.occurred(J)){p.debug("Conditions met",J,H);K.call(q,H,I)}}}p.save.occurred(J)},remove:{fixed:function(){p.debug("Removing fixed position");u.removeClass(r.fixed).css({position:"",top:"",left:"",zIndex:""});F.onUnfixed.call(q)},placeholder:function(){p.debug("Removing placeholder content");if(v){v.remove()}},occurred:function(I){if(I){var H=p.cache.occurred;if(H[I]!==d&&H[I]===true){p.debug("Callback can now be called again",I);p.cache.occurred[I]=false}}else{p.cache.occurred={}}}},save:{calculations:function(){p.verbose("Saving all calculations necessary to determine positioning");p.save.direction();p.save.screenCalculations();p.save.elementCalculations()},occurred:function(H){if(H){if(p.cache.occurred[H]===d||(p.cache.occurred[H]!==true)){p.verbose("Saving callback occurred",H);p.cache.occurred[H]=true}}},scroll:function(H){H=H+F.offset||B.scrollTop()+F.offset;p.cache.scroll=H},direction:function(){var H=p.get.scroll(),I=p.get.lastScroll(),J;if(H>I&&I){J="down"}else{if(H<I&&I){J="up"}else{J="static"}}p.cache.direction=J;return p.cache.direction},elementPosition:function(){var I=p.cache.element,H=p.get.screenSize();p.verbose("Saving element position");I.fits=(I.height<H.height);I.offset=u.offset();I.width=u.outerWidth();I.height=u.outerHeight();if(p.is.verticallyScrollableContext()){I.offset.top+=B.scrollTop()-B.offset().top}if(p.is.horizontallyScrollableContext()){I.offset.left+=B.scrollLeft-B.offset().left}p.cache.element=I;return I},elementCalculations:function(){var H=p.get.screenCalculations(),I=p.get.elementPosition();if(F.includeMargin){I.margin={};I.margin.top=parseInt(u.css("margin-top"),10);I.margin.bottom=parseInt(u.css("margin-bottom"),10);I.top=I.offset.top-I.margin.top;I.bottom=I.offset.top+I.height+I.margin.bottom}else{I.top=I.offset.top;I.bottom=I.offset.top+I.height}I.topPassed=(H.top>=I.top);I.bottomPassed=(H.top>=I.bottom);I.topVisible=(H.bottom>=I.top)&&!I.topPassed;I.bottomVisible=(H.bottom>=I.bottom)&&!I.bottomPassed;I.pixelsPassed=0;I.percentagePassed=0;I.onScreen=((I.topVisible||I.passing)&&!I.bottomPassed);I.passing=(I.topPassed&&!I.bottomPassed);I.offScreen=(!I.onScreen);if(I.passing){I.pixelsPassed=(H.top-I.top);I.percentagePassed=(H.top-I.top)/I.height}p.cache.element=I;p.verbose("Updated element calculations",I);return I},screenCalculations:function(){var H=p.get.scroll();p.save.direction();p.cache.screen.top=H;p.cache.screen.bottom=H+p.cache.screen.height;return p.cache.screen},screenSize:function(){p.verbose("Saving window position");p.cache.screen={height:B.height()}},position:function(){p.save.screenSize();p.save.elementPosition()}},get:{pixelsPassed:function(I){var H=p.get.elementCalculations();if(I.search("%")>-1){return(H.height*(parseInt(I,10)/100))}return parseInt(I,10)},occurred:function(H){return(p.cache.occurred!==d)?p.cache.occurred[H]||false:false},direction:function(){if(p.cache.direction===d){p.save.direction()}return p.cache.direction},elementPosition:function(){if(p.cache.element===d){p.save.elementPosition()}return p.cache.element},elementCalculations:function(){if(p.cache.element===d){p.save.elementCalculations()}return p.cache.element},screenCalculations:function(){if(p.cache.screen===d){p.save.screenCalculations()}return p.cache.screen},screenSize:function(){if(p.cache.screen===d){p.save.screenSize()}return p.cache.screen},scroll:function(){if(p.cache.scroll===d){p.save.scroll()}return p.cache.scroll},lastScroll:function(){if(p.cache.screen===d){p.debug("First scroll event, no last scroll could be found");return false}return p.cache.screen.top}},setting:function(H,I){if(c.isPlainObject(H)){c.extend(true,F,H)}else{if(I!==d){F[H]=I}else{return F[H]}}},internal:function(H,I){if(c.isPlainObject(H)){c.extend(true,p,H)}else{if(I!==d){p[H]=I}else{return p[H]}}},debug:function(){if(!F.silent&&F.debug){if(F.performance){p.performance.log(arguments)}else{p.debug=Function.prototype.bind.call(console.info,console,F.name+":");p.debug.apply(console,arguments)}}},verbose:function(){if(!F.silent&&F.verbose&&F.debug){if(F.performance){p.performance.log(arguments)}else{p.verbose=Function.prototype.bind.call(console.info,console,F.name+":");p.verbose.apply(console,arguments)}}},error:function(){if(!F.silent){p.error=Function.prototype.bind.call(console.error,console,F.name+":");p.error.apply(console,arguments)}},performance:{log:function(J){var I,K,H;if(F.performance){I=new Date().getTime();H=h||I;K=I-H;h=I;l.push({Name:J[0],Arguments:[].slice.call(J,1)||"",Element:q,"Execution Time":K})}clearTimeout(p.performance.timer);p.performance.timer=setTimeout(p.performance.display,500)},display:function(){var I=F.name+":",H=0;h=false;clearTimeout(p.performance.timer);c.each(l,function(J,K){H+=K["Execution Time"]});I+=" "+H+"ms";if(j){I+=" '"+j+"'"}if((console.group!==d||console.table!==d)&&l.length>0){console.groupCollapsed(I);if(console.table){console.table(l)}else{c.each(l,function(J,K){console.log(K.Name+": "+K["Execution Time"]+"ms")})}console.groupEnd()}l=[]}},invoke:function(M,I,K){var J=G,N,L,H;I=I||n;K=q||K;if(typeof M=="string"&&J!==d){M=M.split(/[\. ]/);N=M.length-1;c.each(M,function(Q,P){var O=(Q!=N)?P+M[Q+1].charAt(0).toUpperCase()+M[Q+1].slice(1):M;if(c.isPlainObject(J[O])&&(Q!=N)){J=J[O]}else{if(J[O]!==d){L=J[O];return false}else{if(c.isPlainObject(J[P])&&(Q!=N)){J=J[P]}else{if(J[P]!==d){L=J[P];return false}else{p.error(D.method,M);return false}}}}})}if(c.isFunction(L)){H=L.apply(K,I)}else{if(L!==d){H=L}}if(Array.isArray(i)){i.push(H)}else{if(i!==d){i=[i,H]}else{if(H!==d){i=H}}}return L}};if(e){if(G===d){p.initialize()}G.save.scroll();G.save.calculations();p.invoke(k)}else{if(G!==d){G.invoke("destroy")}p.initialize()}});return(i!==d)?i:this};c.fn.visibility.settings={name:"Visibility",namespace:"visibility",debug:false,verbose:false,performance:true,observeChanges:true,initialCheck:true,refreshOnLoad:true,refreshOnResize:true,checkOnRefresh:true,once:true,continuous:false,offset:0,includeMargin:false,context:b,throttle:false,type:false,zIndex:"10",transition:"fade in",duration:1000,onPassed:{},onOnScreen:false,onOffScreen:false,onPassing:false,onTopVisible:false,onBottomVisible:false,onTopPassed:false,onBottomPassed:false,onPassingReverse:false,onTopVisibleReverse:false,onBottomVisibleReverse:false,onTopPassedReverse:false,onBottomPassedReverse:false,onLoad:function(){},onAllLoaded:function(){},onFixed:function(){},onUnfixed:function(){},onUpdate:false,onRefresh:function(){},metadata:{src:"src"},className:{fixed:"fixed",placeholder:"constraint",visible:"visible"},error:{method:"The method you called is not defined.",visible:"Element is hidden, you must call refresh after element becomes visible"}}})(jQuery,window,document);