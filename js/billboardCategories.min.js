(function(c,b,a){c(function(){const d={$wrapper:c("#categories-wrapper"),dom:{},selector:{wrapper:{addCategoryItem:".addCategoryItem"},extra:{notLoading:":not(.loading)"}},event:{click:{onCategoryAdd:function(e){let that=this;console.log(that);let $item=c(e.currentTarget);$item.addClass("loading").find(".icon").removeClass("plus circle").addClass("loading spinner");c.ajax({url:that.fullUrl("categories/fetchModal/"),data:{parent_id:0},method:"POST",async:true,cache:false,processData:true,dataType:"json",beforeSend:function(g,f){},error:function(f,h,g){},success:function(f,h,g){if(f.status==="ok"){that.buildUpModal(f.data.content)}if(f.status==="fail"){}},complete:function(f,g){$item.removeClass("loading").find(".icon").removeClass("loading spinner").addClass("plus circle")}})}}},appBackendUrl:"/webasyst/billboard/",initialize:function(){this.initializeSemanticUI();this.addEventListeners()},initializeSemanticUI:function(){},addEventListeners:function(){this.onDraggable();this.onDroppable();this.$wrapper.on("click",this.selector.wrapper.addCategoryItem+this.selector.extra.notLoading,c.proxy(this.event.click.onCategoryAdd,this))},onSortable:function(){let that=this;let $sortableItem=c(".sortable-list");let componentSettings={axis:"y",items:"> .item:not(.droppable)",tolerance:"pointer",revert:true,containment:"parent",helper:function(f,e){e.children().each(function(g,h){let $children=c(h);$children.width($children.width())});return e},start:function(e,f){let placeholderHeight=f.item.outerHeight();f.placeholder.height(placeholderHeight);c('<div class="sortable-item-placeholder" data-height="'+placeholderHeight+'"></div>').insertAfter(f.placeholder)},stop:function(e,f){c(".sortable-item-placeholder").remove();let $list=c(f.item).closest(".sortable-list");let serialized=$list.sortable("serialize",{key:"sort[]",attribute:"data-file-id",expression:/(.+)/});that.handleItemsSort(serialized)}};$sortableItem.sortable(componentSettings).disableSelection()},onDraggable:function(){c(".draggable-list .item:not(.not-draggable)").draggable({axis:"y",refreshPositions:true,revert:"invalid",revertDuration:150,handle:".folder.icon",cursorAt:{left:500},distance:3,drag:function(e,f){let $this=c(this)},start:function(e,f){c(".item-droppable").css({"background-color":"rgba(0,0,0,.05)"})},stop:function(){c(".item-droppable").css({"background-color":"transparent"})}})},onDroppable:function(){c(".draggable-list .item-droppable").droppable({greedy:true,tolerance:"pointer",drop:function(e,f){console.log(c(this),f.draggable);let $this=c(this);let $item=c(f.draggable).css({left:"auto",right:"auto",top:"auto",bottom:"auto"}).detach();$this.after($item);$this.css({background:"transparent"})},out:function(e,f){let $this=c(this);$this.css({"background-color":"rgba(0,0,0,.06)"})},over:function(e,f){let $this=c(this);$this.css({background:"rgba(33,186,69, 0.2)"})}})},onDraggable2:function(){var g=c("#wa-app .sidebar:first");var f=g.position();var e={width:g.width(),height:g.height()};c(".s-collection-list li.dr").liveDraggable({containment:"parent",refreshPositions:true,revert:"invalid",helper:function(){var h=c(this);var i=h.parents(".s-collection-list:first").find("ul:first");var j=h.clone().addClass("ui-draggable dr-helper").css({position:"absolute"}).prependTo(i);j.find("a:first").append('<i class="icon10 no-bw" style="margin-left: 0; margin-right: 0; display:none;"></i>');return j},cursor:"move",cursorAt:{left:5},opacity:0.75,zIndex:9999,distance:5,start:function(h,i){a.ondragstart=function(){return false}},stop:function(){a.ondragstart=null}})},onDroppable2:function(){this.initDropBetweenCollections();this.initDropInsideCollections()},initDropBetweenCollections:function(){c(".s-collection-list li.drag-newposition").liveDroppable({greedy:true,tolerance:"pointer",over:function(f,g){var e=c(this);if(g.draggable.attr("data-type")!=e.attr("data-type")){return false}e.addClass("active").parent().parent().addClass("drag-active")},out:function(f,g){var e=c(this);if(g.draggable.attr("data-type")!=e.attr("data-type")){return false}e.removeClass("active").parent().parent().removeClass("drag-active")},deactivate:function(f,g){var e=c(this);if(g.draggable.attr("data-type")!=e.attr("data-type")){return false}if(e.is(":animated")||e.hasClass("dragging")){e.stop().animate({height:"2px"},300,null,function(){e.removeClass("dragging")})}e.removeClass("active").parent().parent().removeClass("drag-active")},drop:function(e,r){var t=c(this);var h=r.draggable;var q=h.attr("data-type");if(q!=t.attr("data-type")){return false}var n=function(w){var v=w.split("-");v.shift();return v.join("-")};var f=n(h.attr("id"));var k=t.prev("li");var u=h.next();var p=h.prev();if(k.length&&k.attr("id")=="category-"+f&&!k.hasClass("dr-helper")){return false}if(this==h.next().get(0)){return false}var l=h.parent("ul");var j=l.children("li.dr[id!=category-"+f+"]").length;var i=parseInt(n(l.parent().attr("id")),10)||0;t.after(u).after(h);var s=h.parent().parent();if(s.is("li.dr")||s.is(".s-collection-list")){var o=0;if(!s.is(".s-collection-list")){o=parseInt(n(s.attr("id")),10)||0}var m=h.nextAll("li.dr:first");var g=null;if(m.length){g=n(m.attr("id"))||null}if(!j&&i!==o){l.parent("li").children("i").hide();l.hide()}}}})},initDropInsideCollections:function(){c(".s-collection-list .item").liveDroppable({tolerance:"pointer",greedy:true,out:function(f,g){var h=g.draggable;var e=c(this).parent();if(!h.hasClass("product")&&e.attr("data-type")!=h.attr("data-type")){return false}if(h.hasClass("product")){g.helper.find("span").show().end().find("i").hide()}e.removeClass("drag-newparent")},over:function(e,n){var i=n.draggable;var o=c(this).parent();var m=i.attr("data-type");if(!i.hasClass("product")&&m!=o.attr("data-type")){return false}if(m!="set"){o.addClass("drag-newparent")}if(i.hasClass("product")){if(o.hasClass("dynamic")){n.helper.find("span").hide().end().find("i").show()}else{n.helper.find("span").show().end().find("i").hide()}return false}if(!i.hasClass("dynamic")&&o.hasClass("dynamic")){n.helper.find("i.no-bw").show();return false}else{n.helper.find("i.no-bw").hide()}var j='.dr[id!="'+i.attr("id")+'"]';var f=c();var g=function(p,q){if(!q.length){return p}p=p.add(q.nextUntil(j).filter("li.drag-newposition"));if(q.nextAll(j).length>0){return p}return g(p,q.parent().closest("li"))};var l=o.prevAll(j+":first");if(l.length>0){var k=l.find(j);if(k.length>0){f=g(f,k.last())}else{f=g(f,l)}}else{f=f.add(o.prevUntil(j).filter("li.drag-newposition"))}if(o.children("ul").children(j).length>0){f=f.add(o.children("ul").children("li.drag-newposition:first"))}else{f=g(f,o)}var h=c(".drag-newposition:animated, .drag-newposition.dragging").not(f);h.stop().animate({height:"2px"},300,null,function(){h.removeClass("dragging")});f.stop().animate({height:"10px"},300,null,function(){f.addClass("dragging")})},drop:function(r,l){var n=l.draggable;var k=c(this).parent();var h=n.attr("data-type");if(!n.hasClass("product")){if(h=="set"){return false}if(k.attr("id")==n.attr("id")){return false}if(h!=k.attr("data-type")){return false}}k.removeClass("drag-newparent");if(n.hasClass("product")){if(k.hasClass("dynamic")){return false}var t=c("#product-list");var w={};if(t.find(".s-select-all").is(":checked")){w.whole_list=true}else{var g=t.find(".product.selected");w.product_ids=g.map(function(){return c(this).attr("data-product-id")}).toArray()}c.product_dragndrop.trigger("add_to_list",c.extend(w,{collection_param:k.attr("id").replace("-","_id="),success:function(x){if(w.whole_list){t.find(".s-select-all").trigger("select",false)}else{if(w.product_ids&&w.product_ids.length){g.trigger("select",false)}}if(x.data){k.find(">.counters .count:not(.subtree)").text(x.data.count);k.find(">.counters .subtree").text(x.data.total_count)}}}));return false}else{if(!n.hasClass("dynamic")&&k.hasClass("dynamic")){return false}}var o=n.attr("id").split("-")[1];if(k.attr("id")=="category-"+o){return false}if(n.hasClass("product")){var q=c("#product-list").find(".product.selected");q.trigger("select",false);return false}var p=parseInt(k.attr("id").split("-")[1],10)||0;var v=null;var m=n.next();var u=n.prev();var s=false;if(k.hasClass("drag-newposition")){v=k.parent("ul")}else{if(k.children("ul").length){v=k.children("ul")}else{if(!k.find(">i.collapse-handler-ajax").length){v=c('<ul class="menu-v with-icons dr unapproved"><li class="drag-newposition unapproved" data-type="'+h+'"></li></ul>').appendTo(k);v.find(".drag-newposition").mouseover();c('<i class="icon16 darr overhanging collapse-handler-ajax unapproved" id="'+h+"-"+p+'-handler"></i>').insertBefore(k.children("a"));s=true}}}var f=n.parent("ul");var j=f.children("li.dr[id!=category-"+o+"]").length;var e=parseInt(f.parent().attr("id").split("-")[1],10)||0;if(v){v.append(n).append(m)}if(!j&&e!==p){f.parent("li").children("i").hide();f.hide()}var i=k;if(i.is("li.dr")){c.product_dragndrop.trigger("move_list",{id:o,type:h,parent_id:p,success:function(x){if(!j&&e!==p){f.parent("li").children("i").remove();f.remove();c.categories_tree.setCollapsed(e)}if(!v){n.remove();m.remove();k.trigger("update_counters",x.data.count||{})}else{c(".s-collection-list .unapproved").removeClass("unapproved");if(s){c.categories_tree.setExpanded(p)}else{k.trigger("count_subtree")}}},error:function(x){if(x&&console){console.log(typeof x.errors!=="undefined"?x.errors:x)}u.after(n).after(m);if(!j){f.parent("li").children("i").show();f.show()}c(".s-collection-list .unapproved").remove()}})}}})},handleItemsSort:function(e){let that=this;c.ajax({url:"#",method:"POST",data:e,async:true,cache:false,dataType:"json",error:function(f,h,g){},success:function(f,h,g){if(f.status==="ok"){}if(f.status==="fail"){}},complete:function(f,g){}})},buildUpModal:function(e){let that=this;let $modal=that.$wrapper.find(".modal-placeholder").html(e).find(".ui.modal");$modal.modal({autofocus:false,centered:true,restoreFocus:false,observeChanges:false,keyboardShortcuts:false,closable:false,duration:350,onHidden:function(){$modal.remove()}}).modal("show")},prepareModal:function(e){},fullUrl:function(e){return this.appBackendUrl+e}};d.initialize()})}(jQuery,window,document));